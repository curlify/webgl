!function(){console.log("initialize curlify",document.currentScript,document.currentScript.nodeParent),document.currentScript.curlify={modules:{},localVars:{},extract:function(obj,objId){var code=[];for(var i in obj)if(obj.hasOwnProperty(i))try{eval("var "+i),code.push("var "+i+"="+objId+'["'+i+'"]')}catch(e){}return code.join(";")},module:function(t,e){null!=this.modules[t]&&console.log("WARNING: overwriting module",t),null==e&&console.log("ERROR: setting null code as module '"+t+"'"),this.modules[t]=e},getModule:function(t){return this.modules[t]},clearModuleBuffersAndPrograms:function(){console.log("clearModuleBuffersAndPrograms()");for(var t in this.modules){var e=this.modules[t];console.log("checking",e.id),null!=e.default_program&&(console.log("clearing module program",e.id),e.default_program.glProgram=null),null!=e.buffer&&(console.log("clearing module buffer",e.id),e.buffer=null)}}},document.currentScript.curlify.localVars.sensors={acceleration:null,rotation:null,orientation:null},document.currentScript.curlify.localVars.zipfile=null,document.currentScript.curlify.localVars.layoutWidth=null,document.currentScript.curlify.localVars.layoutHeight=null,document.currentScript.curlify.localVars.layoutOffset={x:0,y:0},document.currentScript.curlify.localVars.layoutScale={x:1,y:1},document.currentScript.curlify.localVars.gl=null,document.currentScript.curlify.localVars.camera=null,document.currentScript.curlify.localVars.viewWidth=null,document.currentScript.curlify.localVars.viewHeight=null,document.currentScript.curlify.localVars.screenWidth=null,document.currentScript.curlify.localVars.screenHeight=null}(),function(){var t=document.currentScript.curlify,e=function(){console.log("initialize glutils module");var t=function(t){window.console&&(window.console.error?window.console.error(t):window.console.log&&window.console.log(t))},e=function(e,i,r,n){var o=n||t,a=e.createShader(r);e.shaderSource(a,i),e.compileShader(a);var s=e.getShaderParameter(a,e.COMPILE_STATUS);return s?a:(lastError=e.getShaderInfoLog(a),o("*** Error compiling shader '"+a+"':"+lastError),e.deleteShader(a),null)};return{loadProgram:function(e,i,r,n){for(var o={},a=e.createProgram(),s=0;s<i.length;++s)e.attachShader(a,i[s]);e.linkProgram(a);var l=e.getProgramParameter(a,e.LINK_STATUS);if(!l)return lastError=e.getProgramInfoLog(a),t("Error in program linking:"+lastError),e.deleteProgram(a),null;if(r)for(var s=0;s<r.length;++s){var u=r[s]+"_handle";o[u]=e.getAttribLocation(a,r[s])}if(n)for(var s=0;s<n.length;++s){var u=n[s]+"_handle";o[u]=e.getUniformLocation(a,n[s])}return o.program=a,o},createShader:function(t,i,r,n){var o,a=i.text;if(!r)if("x-shader/x-vertex"==i.type)o=t.VERTEX_SHADER;else if("x-shader/x-fragment"==i.type)o=t.FRAGMENT_SHADER;else if(o!=t.VERTEX_SHADER&&o!=t.FRAGMENT_SHADER)throw"*** Error: unknown shader type";return e(t,a,r?r:o,n)}}}();t.module("glutils",e)}(),function(){var t=document.currentScript.curlify,e=function(){return console.log("initialize sys module"),{timestamp:function(){return(new Date).getTime()},ismobile:{Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return e.ismobile.Android()||e.ismobile.BlackBerry()||e.ismobile.iOS()||e.ismobile.Opera()||e.ismobile.Windows()}}}}();t.module("sys",e)}(),function(){var t=document.currentScript.curlify,e=function(){console.log("initialize fps module");var e=t.getModule("sys"),i=0,r=0;return{updateFps:function(){if(100==i){i=0;var t=e.timestamp(),n=1e5/(t-r);console.log("FPS : "+n),r=t}i+=1}}}();t.module("fps",e)}(),function(){var t=document.currentScript.curlify,e=function(){console.log("initialize animator module");var r=t.getModule("sys"),n={time:!0,ease:!0,start:!0,onComplete:!0};return{"new":function(){return{animations:[],animate:function(t,i){null==i.ease&&(i.ease=e.linear),null==i.start&&(i.start=0);var o={};for(var a in i){{i[a]}null==n[a]&&(null==t[a]?console.log("ERROR: Animated property cannot be initially nil : "+a):o[a]=t[a])}this.animations.push({target:t,start:r.timestamp()+i.start,deadline:r.timestamp()+i.start+i.time,config:i,init:o})},step:function(){var t=[],e=r.timestamp();for(var n in this.animations){var o=this.animations[n],a=(o.deadline,0);1==o.paused&&(e=o.pausetimestamp),e<o.deadline?a=1-(o.deadline-e)/o.config.time:e<o.start?a=0:(a=1,t.push(n)),a=Math.max(a,1e-5);for(var n in o.init)initial=o.init[n],o.target[n]=o.config.ease(initial,o.config[n],a)}for(i=t.length-1;i>=0;i--){var s=this.animations[t[i]].config.onComplete;this.animations.splice(t[i],1),null!=s&&s()}},pause:function(){for(var t in this.animations)this.animations[t].paused=!0,this.animations[t].pausetimestamp=r.timestamp()},resume:function(){for(var t in this.animations)this.animations[t].paused=!1,this.animations[t].deadline=this.animations[t].deadline+(r.timestamp()-self.animations[t].pausetimestamp)},stop:function(){for(var t in this.animations)this.animations[t].init={},this.animations[t].config.onComplete=null;this.animations=[]}}}}}();e.linear=function(t,e,i){return t+(e-t)*i},e.inQuad=function(t,e,i){return t+(e-t)*i*i},e.outQuad=function(t,e,i){return t+-(e-t)*i*(i-2)},e.inOutQuad=function(t,e,i){return.5>i?(i=2*i,t+(e-t)/2*i*i):(i=2*(i-.5),t-(e-t)/2*(i*(i-2)-1))},e.inCubic=function(t,e,i){return t+(e-t)*i*i*i},e.outCubic=function(t,e,i){return i-=1,t+(e-t)*(i*i*i+1)},e.inOutCubic=function(t,e,i){return.5>i?(i=2*i,t+(e-t)/2*i*i*i):(i=2*(i-.5)-1,t+(e-t)/2*(i*i*i+2))},e.inQuart=function(t,e,i){return t+(e-t)*i*i*i*i},e.outQuart=function(t,e,i){return i-=1,t-(e-t)*(i*i*i*i-1)},e.inOutQuart=function(t,e,i){return.5>i?(i=2*i,t+(e-t)/2*i*i*i*i):(i=2*(i-.5)-1,t-(e-t)/2*(i*i*i*i-2))},e.inSine=function(t,e,i){return t+(e-t)*(1-Math.cos(i*Math.pi/2))},e.outSine=function(t,e,i){return t+(e-t)*Math.sin(i*Math.pi/2)},e.inOutSine=function(t,e,i){return t-(e-t)/2*(Math.cos(Math.pi*i)-1)},e.inExpo=function(t,e,i){return i-=1,t+(e-t)*Math.pow(2,10*i)},e.outExpo=function(t,e,i){return t+(e-t)*(1-Math.pow(2,-10*i))},e.inOutExpo=function(t,e,i){return.5>i?(i=2*i-1,t+(e-t)/2*Math.pow(2,10*i)):(i=2*(i-.5),t+(e-t)/2*(2-Math.pow(2,-10*i)))},e.inCirc=function(t,e,i){return t+(e-t)*(1-Math.sqrt(1-i*i))},e.outCirc=function(t,e,i){return i-=1,t+(e-t)*Math.sqrt(1-i*i)},e.inOutCirc=function(t,e,i){return.5>i?(i=2*i,t+(e-t)/2*(1-Math.sqrt(1-i*i))):(i=2*(i-.5)-1,t+(e-t)/2*(1+Math.sqrt(1-i*i)))},e.inElastic=function(t,e,i){return i-=1,t-(e-t)*Math.pow(2,10*i)*Math.sin(6*(i-.0777777)*Math.pi)},e.outElastic=function(t,e,i){return t+(e-t)*(Math.pow(2,-10*i)*Math.sin(6*(i-.0777777)*Math.pi)+1)},t.module("animator",e)}(),function(){var t=document.currentScript.curlify,e=function(){console.log("initialize scene module");var e=t.getModule("animator"),i=[],r=[],n=e["new"](),o=null;return{render:function(){if(n.step(),n.animations.length>0){var t=i[i.length-2];t.stepTree(),t.drawTree()}var e=i[i.length-1];if(null!=e){e.stepTree(),e.drawTree();for(var o=0;o<r.length;o++)!new function(){var t=r[o];t.renderFbo()};r=[]}},openScene:function(t,e,r){var o=i[i.length-1];i.push(t),null!=e&&n.animate(t,e),null!=o&&null!=r&&n.animate(o,r)},closeScene:function(t,e){var r=i[i.length-1],o=i[i.length-2];if(null!=t){var a=t.onComplete,s=function(){null!=a&&a(),i.splice(i.length-1,1),console.log("remove scene from stack",r.identifier,i.length)};t.onComplete=s,n.animate(r,t)}else i.splice(i.length-1,1);null!=o&&null!=e&&n.animate(o,e)},removeAllScenes:function(){i=[],r=[],n.stop(),o=null},isAnimating:function(){return n.animations.length>0?!0:!1},getPointerUser:function(){return o?o:i[i.length-1]},getpointerStealer:function(){return o},stealPointers:function(t){console.log("stealPointers",t);var e=o?o:i[i.length-1];o=t,e.resetpress()},resetPointerStealer:function(){o=null},addFboUpdate:function(t){r.push(t)}}}();t.module("scene",e)}(),function(){var curlify=document.currentScript.curlify,object=function(){console.log("initialize object module");var scene=curlify.getModule("scene"),animator=curlify.getModule("animator"),sys=curlify.getModule("sys");return{"new":function(ident,width,height){return eval(curlify.extract(curlify.localVars,"curlify.localVars")),{identifier:null==ident?"object identifier":ident,position:{x:0,y:0,z:0},rotate:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},size:{width:null==width?screenWidth:width,height:null==height?screenHeight:height},children:[],active:!0,visible:!0,alpha:1,blend:!0,drawbackside:!1,depthtest:!1,projectionMatrix:camera.projectionMatrix,viewMatrix:camera.viewMatrix,modelMatrix:mat4.identity(mat4.create()),modelViewMatrix:mat4.identity(mat4.create()),translateScale:camera.translateScale,identityMatrix:mat4.identity(mat4.create()),anim:animator["new"](),timervalue:0,lastdraw:0,laststep:0,add:function(t){return t.parent=this,this.children.push(t),t},updateModelMatrix:function(){var t=this.modelMatrix;if(mat4.copy(t,this.identityMatrix),0!=this.position.x||0!=this.position.y||0!=this.position.z){var e=screenWidth/(2*this.translateScale);mat4.translate(t,t,vec3.clone([this.position.x/e,-this.position.y/e,this.position.z/e]))}0!=this.rotate.z&&mat4.rotateZ(t,t,-this.rotate.z),0!=this.rotate.y&&mat4.rotateY(t,t,-this.rotate.y),0!=this.rotate.x&&mat4.rotateX(t,t,-this.rotate.x),(1!=this.scale.x||1!=this.scale.y||1!=this.scale.z)&&mat4.scale(t,t,vec3.clone([this.scale.x,this.scale.y,this.scale.z])),this.modelMatrix=t},update:function(){var t=this.viewMatrix;null!=this.parent&&null!=this.parent.modelViewMatrix&&(t=this.parent.modelViewMatrix),this.viewMatrix=t,this.updateModelMatrix(),this.children.length>0&&(mat4.copy(this.modelViewMatrix,this.viewMatrix),mat4.multiply(this.modelViewMatrix,this.modelViewMatrix,this.modelMatrix)),this.depthtest?gl.enable(gl.DEPTH_TEST):gl.disable(gl.DEPTH_TEST),0==this.blend?gl.disable(gl.BLEND):(gl.enable(gl.BLEND),gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA)),1==this.drawbackside?gl.disable(gl.CULL_FACE):(gl.enable(gl.CULL_FACE),gl.cullFace(gl.FRONT))},stepTree:function(){var t=Math.max(1,Math.min(sys.timestamp()-this.laststep,60));this.laststep=sys.timestamp(),this.anim.step(),null!=this.preStep&&this.preStep(),null!=this.step&&this.step(t);for(var e=0;e<this.children.length;e++)this.children[e].stepTree();null!=this.postStep&&this.postStep()},drawTree:function(){Math.min(sys.timestamp()-this.lastdraw,60);if(this.lastdraw=sys.timestamp(),0!=this.visible){if(this.update(),null!=this.preDraw&&this.preDraw(),null!=this.draw&&this.draw(),this.reverseDrawOrder)for(var t=this.children.length-1;t>=0;t--)this.children[t].drawTree();else for(var t=0;t<this.children.length;t++)this.children[t].drawTree();null!=this.postDraw&&this.postDraw()}},press:function(t,e){var i=!1;if(null!=this.relativePress){var r=t-screenWidth/2-this.absolutex(),n=e-screenHeight/2-this.absolutey();i=this.relativePress(r,n)}null!=this.absolutePress&&(i=this.absolutePress(t,e));for(var o=this.children.length-1;o>=0;o--)this.children[o].active&&(i=this.children[o].press(t,e));return i},drag:function(t,e){var i=!1;if(null!=this.relativeDrag){var r=t-screenWidth/2-this.absolutex(),n=e-screenHeight/2-this.absolutey();i=this.relativeDrag(r,n)}null!=this.absoluteDrag&&(i=this.absoluteDrag(t,e));for(var o=this.children.length-1;o>=0;o--)this.children[o].active&&(i=this.children[o].drag(t,e));return i},release:function(t,e){var i=!1;if(null!=this.relativeRelease){var r=t-screenWidth/2-this.absolutex(),n=e-screenHeight/2-this.absolutey();i=this.relativeRelease(r,n)}null!=this.absoluteRelease&&(i=this.absoluteRelease(t,e));for(var o=this.children.length-1;o>=0;o--)this.children[o].active&&(i=this.children[o].release(t,e));return i},resetpress:function(){if(1==this.active){for(var t=this.children.length-1;t>=0;t--)this.children[t].resetpress();this!=scene.getpointerStealer()&&null!=this.pointerReset&&this.pointerReset()}},x:function(){return this.position.x},y:function(){return this.position.y},width:function(){return this.size.width*this.scale.x},height:function(){return this.size.height*this.scale.y},top:function(){return this.position.y-this.height()/2},bottom:function(){return this.position.y+this.height()/2},left:function(){return this.position.x-this.width()/2},right:function(){return this.position.x+this.width()/2},absolutex:function(){var t=0;return null!=this.parent&&(t=this.parent.absolutex()),t+this.x()},absolutey:function(){var t=0;return null!=this.parent&&(t=this.parent.absolutey()),t+this.y()},absolutescalex:function(){var t=1;return null!=this.parent&&(t=this.parent.absolutescalex()),t*this.scale.x},absolutescaley:function(){var t=1;return null!=this.parent&&(t=this.parent.absolutescaley()),t*this.scale.y},absolutealpha:function(){var t=1;return null!=this.parent&&(t=this.parent.absolutealpha()),t*this.alpha},activate:function(){this.active=!0,null!=this.postActivate&&this.postActivate()},deactivate:function(){this.active=!1,null!=this.postDeactivate&&this.postDeactivate()}}}}}();curlify.module("object",object)}(),function(){var t=document.currentScript.curlify,e=function(){console.log("initialize quad module");var i=t.getModule("glutils"),r=t.getModule("object");return{buffer:null,default_program:{glProgram:null,getProgram:function(){return null==this.glProgram&&this.loadProgram(),this.glProgram},loadProgram:function(){var e={text:"              attribute vec2 a_position;              attribute vec2 a_tex_coordinate;                            uniform mat4 u_projection;              uniform mat4 u_view;              uniform mat4 u_model;                            varying vec2 v_tex_coord;                            void main() {                gl_Position = u_projection*u_view*u_model*vec4(a_position, 0.0, 1.0);                v_tex_coord = a_tex_coordinate;              }            ",type:"x-shader/x-vertex"},r={text:"              precision mediump float;                            varying vec2      v_tex_coord;                            uniform sampler2D u_texture;              uniform float     u_alpha;                            void main() {                vec4 color = texture2D(u_texture, v_tex_coord);                gl_FragColor = color * u_alpha;              }            ",type:"x-shader/x-fragment"},n=t.localVars.gl,o=i.createShader(n,e),a=i.createShader(n,r);this.glProgram=i.loadProgram(n,[o,a],["a_position","a_tex_coordinate"],["u_texture","u_alpha","u_model","u_view","u_projection"])}},"new":function(i,n,o){var a=t.localVars.gl,s=t.localVars.screenWidth;null==this.buffer&&(this.buffer=a.createBuffer(),this.buffer.itemSize=2,this.buffer.numItems=4,a.bindBuffer(a.ARRAY_BUFFER,this.buffer),vertices=[-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1],a.bufferData(a.ARRAY_BUFFER,new Float32Array(vertices),a.STATIC_DRAW));var l=r["new"](i,n,o);return l.glProgram=this.default_program.getProgram(),l.quadModelMatrix=mat4.identity(mat4.create()),l.updateModelMatrix=function(){var t=this.modelMatrix;if(mat4.copy(t,this.identityMatrix),0!=this.position.x||0!=this.position.y||0!=this.position.z){var e=s/(2*this.translateScale);mat4.translate(t,t,vec3.clone([this.position.x/e,-this.position.y/e,this.position.z/e]))}0!=this.rotate.z&&mat4.rotateZ(t,t,-this.rotate.z),0!=this.rotate.y&&mat4.rotateY(t,t,-this.rotate.y),0!=this.rotate.x&&mat4.rotateX(t,t,-this.rotate.x),(1!=this.scale.x||1!=this.scale.y||1!=this.scale.z)&&mat4.scale(t,t,vec3.clone([this.scale.x,this.scale.y,this.scale.z])),this.modelMatrix=t,mat4.copy(this.quadModelMatrix,this.modelMatrix);var i=s/this.translateScale;mat4.scale(this.quadModelMatrix,this.quadModelMatrix,vec3.clone([this.size.width/i,-this.size.height/i,1]))},l.draw=function(){if(null!=l.texture){a.useProgram(this.glProgram.program),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,l.texture),a.uniform1i(this.glProgram.u_texture_handle,0),a.uniform1f(this.glProgram.u_alpha_handle,this.absolutealpha()),a.uniformMatrix4fv(this.glProgram.u_projection_handle,!1,this.projectionMatrix),a.uniformMatrix4fv(this.glProgram.u_view_handle,!1,this.viewMatrix),a.uniformMatrix4fv(this.glProgram.u_model_handle,!1,this.quadModelMatrix);var t=this.buffer?this.buffer:e.buffer;a.bindBuffer(a.ARRAY_BUFFER,t),a.enableVertexAttribArray(this.glProgram.a_position_handle),a.enableVertexAttribArray(this.glProgram.a_tex_coordinate_handle),a.vertexAttribPointer(this.glProgram.a_position_handle,t.itemSize,a.FLOAT,!1,16,0),a.vertexAttribPointer(this.glProgram.a_tex_coordinate_handle,t.itemSize,a.FLOAT,!1,16,8),a.drawArrays(a.TRIANGLE_STRIP,0,t.numItems)}},l}}}();t.module("quad",e)}(),function(){var t=document.currentScript.curlify,e=t.getModule("object"),i=t.getModule("quad"),r=function(){return console.log("initialize plane module"),{"new":function(r,n,o,a,s){for(var l=t.localVars.gl,u=t.localVars.screenWidth,c=(t.localVars.screenHeight,e["new"](r,a,s)),h=n+1,d=o+1,f=c.size.height/c.size.width,g=[],m=0;d>m;m++)for(var p=(-1+2*m/o)*f,v=m/o,x=0;h>x;x++){var y=-1+2*x/n,_=x/n;g.push(y,p,_,v)}c.buffer=l.createBuffer(),c.buffer.itemSize=2,c.buffer.numItems=4,l.bindBuffer(l.ARRAY_BUFFER,c.buffer),l.bufferData(l.ARRAY_BUFFER,new Float32Array(g),l.STATIC_DRAW);for(var w=[],b=0,E=0;o>E;E++)for(var M=0;n>M;M++)w.push(E*h+M),w.push(E*h+M+1),w.push((E+1)*h+M),w.push(E*h+M+1),w.push((E+1)*h+M+1),w.push((E+1)*h+M),b+=6;return c.indices=l.createBuffer(),c.indices.indexCount=w.length,l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,c.indices),l.bufferData(l.ELEMENT_ARRAY_BUFFER,new Uint16Array(w),l.STATIC_DRAW),c.glProgram=i.default_program.getProgram(),c.quadModelMatrix=mat4.identity(mat4.create()),c.updateModelMatrix=function(){var t=this.modelMatrix;if(mat4.copy(t,this.identityMatrix),0!=this.position.x||0!=this.position.y||0!=this.position.z){var e=u/(2*this.translateScale);mat4.translate(t,t,vec3.clone([this.position.x/e,-this.position.y/e,this.position.z/e]))}0!=this.rotate.z&&mat4.rotateZ(t,t,-this.rotate.z),0!=this.rotate.y&&mat4.rotateY(t,t,-this.rotate.y),0!=this.rotate.x&&mat4.rotateX(t,t,-this.rotate.x),(1!=this.scale.x||1!=this.scale.y||1!=this.scale.z)&&mat4.scale(t,t,vec3.clone([this.scale.x,this.scale.y,this.scale.z])),this.modelMatrix=t,mat4.copy(this.quadModelMatrix,this.modelMatrix);var i=u/this.translateScale;mat4.scale(this.quadModelMatrix,this.quadModelMatrix,vec3.clone([this.size.width/i,-this.size.height/i*1/f,1]))},c.draw=function(){null!=c.texture&&(l.useProgram(this.glProgram.program),l.activeTexture(l.TEXTURE0),l.bindTexture(l.TEXTURE_2D,c.texture),l.uniform1i(this.glProgram.u_texture_handle,0),l.uniform1f(this.glProgram.u_alpha_handle,this.absolutealpha()),l.uniformMatrix4fv(this.glProgram.u_projection_handle,!1,this.projectionMatrix),l.uniformMatrix4fv(this.glProgram.u_view_handle,!1,this.viewMatrix),l.uniformMatrix4fv(this.glProgram.u_model_handle,!1,this.quadModelMatrix),l.bindBuffer(l.ARRAY_BUFFER,this.buffer),l.enableVertexAttribArray(this.glProgram.a_position_handle),l.enableVertexAttribArray(this.glProgram.a_tex_coordinate_handle),l.vertexAttribPointer(this.glProgram.a_position_handle,this.buffer.itemSize,l.FLOAT,!1,16,0),l.vertexAttribPointer(this.glProgram.a_tex_coordinate_handle,this.buffer.itemSize,l.FLOAT,!1,16,8),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,this.indices),l.drawElements(l.TRIANGLES,this.indices.indexCount,l.UNSIGNED_SHORT,0))},c}}}();t.module("plane",r)}(),function(){var t=document.currentScript.curlify,e=function(){var e=t.getModule("quad");return{"new":function(t,i,r){var n=e["new"](t,i,r);return n.focused=!1,n.hit=function(t,e){return t<-this.width()/2||t>this.width()/2||e<-this.height()/2||e>this.height()/2?!1:!0},n.relativePress=function(t,e){return this.hit(t,e)?(null!=this.focus&&this.focus(t,e),this.focused=!0,!0):!1},n.relativeDrag=function(t,e){return 1!=this.focused?!1:(1!=this.hit(t,e)?(null!=this.defocus&&this.defocus(t,e),this.focused=!1):null!=this.focusdrag&&this.focusdrag(t,e),!0)},n.relativeRelease=function(t,e){return 1!=this.focused?!1:(null!=this.click&&this.click(t,e),null!=this.defocus&&this.defocus(t,e),this.focused=!1,!0)},n.pointerReset=function(){null!=this.defocus&&this.defocus(0,0),this.focused=!1},n}}}();t.module("focusable",e)}(),function(){var t=document.currentScript.curlify,e=function(){console.log("initialize rectangle module");var e=t.getModule("glutils"),i=t.getModule("quad");return{default_program:{glProgram:null,getProgram:function(){return null==this.glProgram&&this.loadProgram(),this.glProgram},loadProgram:function(){var i={text:"              attribute vec2 a_position;                            uniform mat4 u_projection;              uniform mat4 u_view;              uniform mat4 u_model;                            void main() {                gl_Position = u_projection*u_view*u_model*vec4(a_position, 0.0, 1.0);              }",type:"x-shader/x-vertex"},r={text:"              precision mediump float;                            uniform float     u_red;              uniform float     u_green;              uniform float     u_blue;              uniform float     u_alpha;                            void main() {                gl_FragColor = vec4( u_red, u_green, u_blue, 1.0 ) * u_alpha;              }",type:"x-shader/x-fragment"},n=t.localVars.gl,o=e.createShader(n,i),a=e.createShader(n,r);this.glProgram=e.loadProgram(n,[o,a],["a_position"],["u_red","u_green","u_blue","u_alpha","u_model","u_view","u_projection"])}},"new":function(e,r,n){var o=t.localVars.gl,a=i["new"]("rectangle",e,r);return a.glProgram=this.default_program.getProgram(),a.color=null==n?{red:0,green:0,blue:0}:n,a.draw=function(){o.useProgram(this.glProgram.program),o.uniform1f(this.glProgram.u_red_handle,this.color.red),o.uniform1f(this.glProgram.u_green_handle,this.color.green),o.uniform1f(this.glProgram.u_blue_handle,this.color.blue),o.uniform1f(this.glProgram.u_alpha_handle,this.absolutealpha()),o.uniformMatrix4fv(this.glProgram.u_projection_handle,!1,this.projectionMatrix),o.uniformMatrix4fv(this.glProgram.u_view_handle,!1,this.viewMatrix),o.uniformMatrix4fv(this.glProgram.u_model_handle,!1,this.quadModelMatrix);var t=this.buffer?this.buffer:i.buffer;o.bindBuffer(o.ARRAY_BUFFER,t),o.enableVertexAttribArray(this.glProgram.a_position_handle),o.vertexAttribPointer(this.glProgram.a_position_handle,t.itemSize,o.FLOAT,!1,16,0),o.drawArrays(o.TRIANGLE_STRIP,0,t.numItems)},a}}}();t.module("rectangle",e)}(),function(){var t=document.currentScript.curlify,e=function(){console.log("initialize image module");var i=t.getModule("quad");return{loadImage:function(e){var i=t.localVars.zipfile,r=null;if("string"!=typeof e)return console.log("ERROR: image.loadImage source is not of type string",e),null;if(r=new Image,null!=i){var n=i.file(e);console.log("image.source zip",n,e,i),r.src="data:image/jpg;base64,"+JSZip.base64.encode(n.asBinary())}else r.crossOrigin="anonymous",r.src=e;return r},"new":function(r,n){var o=t.localVars.gl,a=n?n:i["new"]("image : "+r);return a.size.width=null,a.size.height=null,r instanceof HTMLElement?(a.texture=o.createTexture(),o.bindTexture(o.TEXTURE_2D,a.texture),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,r),null==a.size.width&&(a.size.width=r.width),null==a.size.height&&(a.size.height=r.height),a.loaded=!0,null!=a.onload&&a.onload()):r instanceof Object?null!=r.texture||null!=r.size?(a.texture=r.texture,a.image=r.image,null==a.size.width&&(a.size.width=r.size.width),null==a.size.height&&(a.size.height=r.size.height),a.loaded=!0,null!=a.onload&&a.onload()):console.log("ERROR: image.new from unknown Object",r):"string"==typeof r?(a.image=e.loadImage(r),a.image.onload=function(){return null==e?void console.log("image == null!"):(a.texture=o.createTexture(),o.bindTexture(o.TEXTURE_2D,a.texture),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,a.image),null==a.size.width&&(a.size.width=a.image.width),null==a.size.height&&(a.size.height=a.image.height),a.loaded=!0,void(null!=a.onload&&a.onload()))},a.image.onerror=function(){console.log("texture load failed",r)}):console.log("ERROR: image.new from unknown object",r),a}}}();t.module("image",e)}(),function(){var t=document.currentScript.curlify,e=t.getModule("glutils"),i=t.getModule("image"),r=t.getModule("quad"),n=function(){return console.log("initialize masked_image module"),{default_program:{program:null,getProgram:function(){return null==this.glProgram&&this.loadProgram(),this.glProgram},loadProgram:function(){var i={text:"            attribute vec2 a_position;             attribute vec2 a_tex_coordinate;                         uniform mat4 u_projection;             uniform mat4 u_view;             uniform mat4 u_model;                         varying vec2 v_tex_coord;                         void main() {               gl_Position = u_projection*u_view*u_model*vec4(a_position, 0.0, 1.0);               v_tex_coord = a_tex_coordinate;             }             ",type:"x-shader/x-vertex"},r={text:"            precision mediump float;                         varying vec2      v_tex_coord;                         uniform sampler2D u_texture;             uniform sampler2D u_mask_texture;             uniform float     u_alpha;                         void main() {                             vec4 color = texture2D(u_texture, v_tex_coord);               vec4 mask_color = texture2D(u_mask_texture, v_tex_coord);                             gl_FragColor = color * mask_color.a * u_alpha;             }             ",type:"x-shader/x-fragment"},n=t.localVars.gl,o=e.createShader(n,i),a=e.createShader(n,r);this.glProgram=e.loadProgram(n,[o,a],["a_position","a_tex_coordinate"],["u_texture","u_mask_texture","u_alpha","u_model","u_view","u_projection"])}},"new":function(e,n){var o=t.localVars.gl,a=i["new"](e);return a.identifier="masked_image : "+e+" : "+n,console.log(a.identifier),a.mask=n,a.glProgram=this.default_program.getProgram(),a.draw=function(){if(1==a.loaded){o.useProgram(this.glProgram.program),o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,a.texture),o.uniform1i(this.glProgram.u_texture_handle,0),o.activeTexture(o.TEXTURE1),o.bindTexture(o.TEXTURE_2D,a.mask.texture),o.uniform1i(this.glProgram.u_mask_texture_handle,1),o.uniform1f(this.glProgram.u_alpha_handle,this.absolutealpha()),o.uniformMatrix4fv(this.glProgram.u_projection_handle,!1,this.projectionMatrix),o.uniformMatrix4fv(this.glProgram.u_view_handle,!1,this.viewMatrix),o.uniformMatrix4fv(this.glProgram.u_model_handle,!1,this.quadModelMatrix);var t=this.buffer?this.buffer:r.buffer;o.bindBuffer(o.ARRAY_BUFFER,t),o.enableVertexAttribArray(this.glProgram.a_position_handle),o.enableVertexAttribArray(this.glProgram.a_tex_coordinate_handle),o.vertexAttribPointer(this.glProgram.a_position_handle,t.itemSize,o.FLOAT,!1,16,0),o.vertexAttribPointer(this.glProgram.a_tex_coordinate_handle,t.itemSize,o.FLOAT,!1,16,8),o.drawArrays(o.TRIANGLE_STRIP,0,t.numItems)}},a}}}();t.module("masked_image",n)}(),function(){var t=document.currentScript.curlify,e=function(){console.log("initialize fbo_object module");var e=t.getModule("glutils"),i=t.getModule("scene"),r=t.getModule("quad"),n=t.getModule("sys");return{default_program:{glProgram:null,getProgram:function(){return null==this.glProgram&&this.loadProgram(),this.glProgram},loadProgram:function(){var i={text:"              attribute vec2 a_position;              attribute vec2 a_tex_coordinate;                            uniform mat4 u_projection;              uniform mat4 u_view;              uniform mat4 u_model;                            varying vec2 v_tex_coord;                            void main() {                gl_Position = u_projection*u_view*u_model*vec4(a_position, 0.0, 1.0);                v_tex_coord = vec2(a_tex_coordinate.x,1.0-a_tex_coordinate.y);              }              ",type:"x-shader/x-vertex"},r={text:"              precision mediump float;                            varying vec2      v_tex_coord;                            uniform sampler2D u_texture;              uniform float     u_alpha;                            void main() {                vec4 color = texture2D(u_texture, v_tex_coord);                gl_FragColor = color * u_alpha;              }            ",type:"x-shader/x-fragment"},n=t.localVars.gl,o=e.createShader(n,i),a=e.createShader(n,r);this.glProgram=e.loadProgram(n,[o,a],["a_position","a_tex_coordinate"],["u_texture","u_alpha","u_model","u_view","u_projection"])}},"new":function(e,o,a,s){var l=t.localVars.gl,u=r["new"]("fbo_object : "+e,o,a);u.glProgram=this.default_program.getProgram(),console.log("fbo_object.new(",u.dentifier,u.size.width,u.size.height,")"),u.dobypassFbo=!1,u.lastUpdated=-99999,u.updateInterval=0,u.framebuffer=l.createFramebuffer(),u.framebuffer.width=u.size.width,u.framebuffer.height=u.size.height,l.bindFramebuffer(l.FRAMEBUFFER,u.framebuffer),u.texture=l.createTexture(),l.bindTexture(l.TEXTURE_2D,u.texture),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.LINEAR),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.LINEAR);var c=s?l.RGB:l.RGBA;return l.texImage2D(l.TEXTURE_2D,0,c,u.framebuffer.width,u.framebuffer.height,0,c,l.UNSIGNED_BYTE,null),l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,u.texture,0),l.bindTexture(l.TEXTURE_2D,null),l.bindFramebuffer(l.FRAMEBUFFER,null),u.preStep=function(){var t=n.timestamp()-this.lastUpdated;this.fboUpdatesDisabled||this.dobypassFbo||t>=this.updateInterval&&u.updateFbo()},u.updateFbo=function(){i.addFboUpdate(u)},u.renderFbo=function(){l.bindTexture(l.TEXTURE_2D,null);var e=l.getParameter(l.FRAMEBUFFER_BINDING),i=t.localVars.screenWidth,r=t.localVars.screenHeight,o=t.localVars.layoutWidth,a=t.localVars.layoutHeight,s={x:t.localVars.layoutOffset.x,y:t.localVars.layoutOffset.y};l.viewport(0,0,u.size.width,u.size.height),l.bindFramebuffer(l.FRAMEBUFFER,u.framebuffer),l.clearColor(0,0,0,0),l.clear(l.COLOR_BUFFER_BIT|l.DEPTH_BUFFER_BIT),t.localVars.screenWidth=u.size.width,t.localVars.screenHeight=u.size.height,t.localVars.layoutWidth=u.size.width,t.localVars.layoutHeight=u.size.height,t.localVars.layoutOffset={x:0,y:0};for(var c=0;c<u.children.length;c++)u.children[c].parent=null,u.children[c].viewMatrix=t.localVars.camera.viewMatrix,u.children[c].drawTree();t.localVars.screenWidth=i,t.localVars.screenHeight=r,t.localVars.layoutWidth=o,t.localVars.layoutHeight=a,t.localVars.layoutOffset=s,l.viewport(t.localVars.layoutOffset.x,t.localVars.layoutOffset.y,t.localVars.layoutWidth,t.localVars.layoutHeight),l.bindFramebuffer(l.FRAMEBUFFER,e),u.lastUpdated=n.timestamp()},u.drawTree=function(){Math.min(n.timestamp()-this.lastdraw,60);if(this.lastdraw=n.timestamp(),0!=this.visible){if(this.update(),this.dobypassFbo)for(var t=0;t<this.children.length;t++)this.children[t].parent=this,this.children[t].viewMatrix=this.modelViewMatrix,this.children[t].drawTree();else null!=this.draw&&this.draw();null!=this.postDraw&&this.postDraw()}},u.draw=function(){l.useProgram(this.glProgram.program),l.activeTexture(l.TEXTURE0),l.bindTexture(l.TEXTURE_2D,u.texture),l.uniform1i(this.glProgram.u_texture_handle,0),l.uniform1f(this.glProgram.u_alpha_handle,this.absolutealpha()),l.uniformMatrix4fv(this.glProgram.u_projection_handle,!1,this.projectionMatrix),l.uniformMatrix4fv(this.glProgram.u_view_handle,!1,this.viewMatrix),l.uniformMatrix4fv(this.glProgram.u_model_handle,!1,this.quadModelMatrix);
var t=this.buffer?this.buffer:r.buffer;l.bindBuffer(l.ARRAY_BUFFER,t),l.enableVertexAttribArray(this.glProgram.a_position_handle),l.enableVertexAttribArray(this.glProgram.a_tex_coordinate_handle),l.vertexAttribPointer(this.glProgram.a_position_handle,t.itemSize,l.FLOAT,!1,16,0),l.vertexAttribPointer(this.glProgram.a_tex_coordinate_handle,t.itemSize,l.FLOAT,!1,16,8),l.drawArrays(l.TRIANGLE_STRIP,0,t.numItems)},u}}}();t.module("fbo_object",e)}(),function(){var t=document.currentScript.curlify,e=function(){console.log("initialize button module");{var e=t.getModule("image");t.getModule("focusable")}return{"new":function(t){var i=e["new"](t);return i.focused=!1,i.identifier="button : "+t,i.hit=function(t,e){return t<-this.width()/2||t>this.width()/2||e<-this.height()/2||e>this.height()/2?!1:!0},i.relativePress=function(t,e){return this.hit(t,e)?(null!=this.focus&&this.focus(t,e),this.focused=!0,!0):!1},i.relativeDrag=function(t,e){return 1!=this.focused?!1:(1!=this.hit(t,e)?(null!=this.defocus&&this.defocus(t,e),this.focused=!1):null!=this.focusdrag&&this.focusdrag(t,e),!0)},i.relativeRelease=function(t,e){return 1!=this.focused?!1:(null!=this.click&&this.click(t,e),null!=this.defocus&&this.defocus(t,e),this.focused=!1,!0)},i.pointerReset=function(){null!=this.defocus&&this.defocus(0,0),this.focused=!1},i}}}();t.module("button",e)}(),function(){var t=document.currentScript.curlify,e=t.getModule("object"),i=t.getModule("focusable"),r=t.getModule("image"),n=function(t,e,n,o,a){n=n?n:t.frames.length,o=o?o:0;for(var s=a?a:i["new"]("spritesheet "+t.name),l=o;o+n>l;l++){var u=s.add(r["new"](t.frames[l]));u.visible=!1,u.active=!1}return s.size.width=t.spritewidth,s.size.height=t.spriteheight,s.frame=s.children[0],s.frametimervalue=0,s.frametime=35,s.restart=function(t){s.frametimervalue=0;var i=s.restart;0==e&&(i=null);var r=s.loopdelay&&!t?s.loopdelay:0;s.anim.animate(s,{frametimervalue:s.children.length,start:r,time:s.frametime*s.children.length,onComplete:i})},s.preStep=function(){s.frame.visible=!1;var t=Math.floor(s.frametimervalue);t>s.children.length-1||(s.frame=s.children[t],s.frame.visible=!0)},s.start=function(){return s.anim.animations.length>0&&s.anim.animations[0].paused?void s.anim.resume():void s.restart()},s.stop=function(){s.anim.pause()},s.unload=function(){s.anim.stop()},0!=e&&s.restart(!0),s},o=function(){return{newSheet:function(t,e,i){var n={spritewidth:0,spriteheight:0,frames:[]};if(t instanceof Array){var o=e,a=i,s=document.createElement("canvas");s.width=o,s.height=a;for(var l=s.getContext("2d"),u=0,c=0;c<t.length;c++)!new function(){var e=r.loadImage(t[c]);e.onload=function(){l.drawImage(e,0,0),n.frames.push(r["new"](s)),l.clearRect(0,0,s.width,s.height),u+=1,u==t.length&&null!=n.onload&&n.onload()}};n.spritewidth=o,n.spriteheight=a,n.name="array "+t.length}else{var h=r.loadImage(t);h.onload=function(){var o=h.width/e,a=h.height/i,s=document.createElement("canvas");s.width=o,s.height=a;for(var l=s.getContext("2d"),u=0;i>u;u++)for(var c=0;e>c;c++)l.drawImage(h,-c*o,-u*a),n.frames.push(r["new"](s)),l.clearRect(0,0,s.width,s.height);n.spritewidth=o,n.spriteheight=a,n.name=t,null!=n.onload&&n.onload()}}return n},newFromSheet:function(t,e,i,r,o){return n(t,e,i,r,o)},"new":function(t,i,r,o,a,s){var l=this.newSheet(t,i,r),u=e["new"]("sprite loader");return u.sheet=l,l.onload=function(){n(l,o,a,s,u),null!=u.onload&&u.onload()},u}}}();t.module("sprite",o)}(),function(){var t=document.currentScript.curlify,e=function(){console.log("initialize carousel module");var e=t.getModule("object"),i=t.getModule("focusable"),r=t.getModule("animator"),n=t.getModule("scene"),o=t.getModule("sys");return{"new":function(a,s,l){var u=t.localVars.screenWidth,c=t.localVars.screenHeight,h=i["new"](a,s,l),d={name:"coverflow",show:[],hide:[]};d.show.push({target:"position.x",startposition:1*u,endposition:0,func:r.linear}),d.show.push({target:"rotate.y",startposition:.8*Math.PI,endposition:0,func:r.linear}),d.show.push({target:"scale.x",startposition:.6,endposition:1,func:r.linear}),d.show.push({target:"scale.y",startposition:.6,endposition:1,func:r.linear}),d.hide.push({target:"position.x",startposition:0,endposition:1*-u,func:r.linear}),d.hide.push({target:"rotate.y",startposition:0,endposition:.8*-Math.PI,func:r.linear}),d.hide.push({target:"scale.x",startposition:1,endposition:.6,func:r.linear}),d.hide.push({target:"scale.y",startposition:1,endposition:.6,func:r.linear}),h.contentsize={width:h.size.width,height:h.size.height},h.inertia=5,h.swipespeed=u,h.movespeed=1,h.movethreshold=60,h.itemsize=u,h.transition=d,h.unload_distance=1,h.wrap=!1,h.bounceOnWrap=!1,h.alwaysmove=!1,h.nevermove=!1,h.selecteditem=1,h.moveToSelectedItem=!0;var f=h.add(e["new"]("carousel"));f.targetposition={x:0,y:0,z:0},f.pressOffset={x:0,y:0};var g=h.add(e["new"]("item container"));g.targetposition={x:0,y:0,z:0},h.instance=f,h.itemcontainer=g;var m=function(t,e,i){i>100&&(i=100);var r=1;t>e&&(r=-1);var n=-r*i/(16.66*h.inertia)*Math.abs(t-e);return Math.abs(n)<1e-4?t=e:t-=n,1==r&&t>e&&(t=e),-1==r&&e>t&&(t=e),t};return f.setMoving=function(t,e){null==n.getpointerStealer()&&1!=h.nevermove&&(n.stealPointers(h),null!=h.stolePointers&&h.stolePointers(t,e),f.moving=!0)},h.focus=function(t,e){f.moving&&(f.moving=!1,f.targetposition.x=f.position.x,f.targetposition.y=f.position.y),f.pressOffset={x:f.targetposition.x-t*h.movespeed/u*2,y:f.targetposition.y-e*h.movespeed},h.pressStarted={x:t,y:e}},h.focusdrag=function(t,e){var i=f.pressOffset.x+t*h.movespeed/u*2,r=f.pressOffset.y+e*h.movespeed/c*2,n=h.pressStarted.x-t,o=h.pressStarted.y-e;(h.alwaysmove||h.contentsize.width!=h.size.width)&&Math.abs(n)>h.movethreshold&&f.setMoving(n,o),f.moving&&(f.targetposition.x=i,f.targetposition.y=r)},h.defocus=function(){var t=Math.floor(-f.targetposition.x+.5);h.moveToSelectedItem&&(f.targetposition.x=-t),h.selecteditem=t,h.selecteditem<0&&(h.selecteditem=h.wrap?g.children.length+t:0),h.selecteditem>g.children.length-1&&(h.selecteditem=h.wrap?t-g.children.length:g.children.length-1),h.selecteditem=h.selecteditem+1,null!=h.carouselmoved&&h.carouselmoved(h.selecteditem)},h.postDraw=function(){if(h.wrap)for(var t=0;t<g.children.length;t++){var e=g.children[t],i=e.active,r=e.visible,n=e.itemposition;e.itemposition=n+g.children.length,e.stepTree(),e.drawTree(),e.itemposition=n-g.children.length,e.stepTree(),e.drawTree(),e.itemposition=n,e.step(0),e.visible=r,e.active=i}},h.selected=function(){return h.selecteditem},h.getItem=function(t){return g.children[t-1]},h.moveto=function(t,e){f.targetposition.x=-t,e&&(f.position.x=f.targetposition.x),h.selecteditem=t,null!=h.carouselmoved&&h.carouselmoved(t+1)},h.step=function(t){var e=-g.children.length+1,i=-g.children.length+1,r=.75,n=.75;0==h.wrap||h.bounceOnWrap&&f.position.x>e-r&&f.position.x<r?(h.bounceOnWrap&&(r=2*r,n=2*n),f.targetposition.x>r&&(f.targetposition.x=r),f.targetposition.y>n&&(f.targetposition.y=n),f.targetposition.x<e-r&&(f.targetposition.x=e-r),f.targetposition.y<i-n&&(f.targetposition.y=i-n),0==h.focused&&(f.targetposition.x>0&&(f.targetposition.x=m(f.targetposition.x,0,t/2)),f.targetposition.y>0&&(f.targetposition.y=m(f.targetposition.y,0,t/2)),f.targetposition.x<e&&(f.targetposition.x=m(f.targetposition.x,e,t/2)),f.targetposition.y<i&&(f.targetposition.y=m(f.targetposition.y,i,t/2)))):f.targetposition.x>1?(console.log("switch",f.position.x,f.targetposition.x,h.contentsize.width),f.targetposition.x=f.targetposition.x-g.children.length,f.position.x=f.position.x-g.children.length,f.pressOffset.x=f.pressOffset.x-g.children.length):f.targetposition.x<-g.children.length&&(console.log("+++switch2",f.position.x,f.targetposition.x),f.targetposition.x=f.targetposition.x+g.children.length,f.position.x=f.position.x+g.children.length,f.pressOffset.x=f.pressOffset.x+g.children.length);var o=t;o>100&&(o=1),0==h.focused&&(o=t/2),(h.alwaysmove||h.contentsize.width!=h.size.width)&&(f.position.x=m(f.position.x,f.targetposition.x,o)),(h.alwaysmove||h.contentsize.height!=h.size.height)&&(f.position.y=m(f.position.y,f.targetposition.y,o)),0==h.focused&&f.position.x==f.targetposition.x&&f.position.y==f.targetposition.y&&(f.moving=!1),f.moving},h.getDistance=function(){var t=(f.position.x*h.itemsize+this.itemposition*h.itemsize)/u;return t},h.setContentSize=function(){h.contentsize.width=h.itemsize*g.children.length},h.add=function(t,e){var e=g.children.length,r=i["new"]("carousel item container");return r.add(t),r.parent=g,g.children.push(r),g.drawTree=function(){function t(t,e){return Math.abs(t.dist)>Math.abs(e.dist)?-1:1}Math.min(o.timestamp()-this.lastdraw,60);if(this.lastdraw=o.timestamp(),0!=this.visible){if(this.update(),null!=this.preDraw&&this.preDraw(),null!=this.draw&&this.draw(),h.transition.order_draw){for(var e=[],i=0;i<this.children.length;i++)e.push(this.children[i]);e.sort(t);for(var i=0;i<e.length;i++)e[i].drawTree()}else if(this.reverseDrawOrder)for(var i=this.children.length-1;i>=0;i--)this.children[i].drawTree();else for(var i=0;i<this.children.length;i++)this.children[i].drawTree();null!=this.postDraw&&this.postDraw()}},t.carouselobject=r,r.index=e,r.child=t,r.itemposition=e,r.getDistance=h.getDistance,r.step=function(){var t=this.getDistance();if(this.dist=t,t<=-h.unload_distance||t>=h.unload_distance?null!=this.unload_content&&null!=this.content&&this.unload_content():null!=this.load_content&&null==this.content&&this.load_content(),this.active=!0,Math.abs(t)>.2&&(this.active=!1),this.visible=!0,Math.abs(t)>1&&(this.visible=!1),!(this.distance==t||Math.abs(t)>2)){this.distance=t;var e=h.transition;if(g.reverseDrawOrder=e.reverse_draw?!0:!1,t>=0)for(var i=0;i<e.show.length;i++){var r=e.show[i];"position.x"==r.target?this.position.x=r.func(r.startposition,r.endposition,Math.abs(1-t)):"position.y"==r.target?this.position.y=r.func(r.startposition,r.endposition,Math.abs(1-t)):"position.z"==r.target?this.position.z=r.func(r.startposition,r.endposition,Math.abs(1-t)):"scale.x"==r.target?this.scale.x=r.func(r.startposition,r.endposition,Math.abs(1-t)):"scale.y"==r.target?this.scale.y=r.func(r.startposition,r.endposition,Math.abs(1-t)):"rotate.x"==r.target?this.rotate.x=r.func(r.startposition,r.endposition,Math.abs(1-t)):"rotate.y"==r.target?this.rotate.y=r.func(r.startposition,r.endposition,Math.abs(1-t)):"rotate.z"==r.target?this.rotate.z=r.func(r.startposition,r.endposition,Math.abs(1-t)):"alpha"==r.target?this.alpha=r.func(r.startposition,r.endposition,Math.abs(1-t)):"transition_value"==r.target&&(this.transition_value=r.func(r.startposition,r.endposition,Math.abs(1-t)))}else for(var i=0;i<e.hide.length;i++){var n=e.hide[i];"position.x"==n.target?this.position.x=n.func(n.startposition,n.endposition,Math.abs(t)):"position.y"==n.target?this.position.y=n.func(n.startposition,n.endposition,Math.abs(t)):"position.z"==n.target?this.position.z=n.func(n.startposition,n.endposition,Math.abs(t)):"scale.x"==n.target?this.scale.x=n.func(n.startposition,n.endposition,Math.abs(t)):"scale.y"==n.target?this.scale.y=n.func(n.startposition,n.endposition,Math.abs(t)):"rotate.x"==n.target?this.rotate.x=n.func(n.startposition,n.endposition,Math.abs(t)):"rotate.y"==n.target?this.rotate.y=n.func(n.startposition,n.endposition,Math.abs(t)):"rotate.z"==n.target?this.rotate.z=n.func(n.startposition,n.endposition,Math.abs(t)):"alpha"==n.target?this.alpha=n.func(n.startposition,n.endposition,Math.abs(t)):"transition_value"==n.target&&(this.transition_value=n.func(n.startposition,n.endposition,Math.abs(t)))}}},g.itemaddposition=g.itemaddposition+1,h.setContentSize(),r},h}}}();t.module("carousel",e)}(),function(){var t=document.currentScript.curlify,e=t.getModule("animator"),i=t.getModule("carousel"),r=function(){return{"new":function(r,n,o){var a=t.localVars.screenWidth,s=t.localVars.screenHeight,l={name:"move in",show:[],hide:[]};l.show.push({target:"position.y",startposition:s,endposition:0,func:e.outQuad}),l.show.push({target:"alpha",startposition:0,endposition:1,func:e.outExpo}),l.hide.push({target:"position.y",startposition:0,endposition:0,func:e.linear}),l.hide.push({target:"alpha",startposition:1,endposition:0,func:e.inExpo});var u=i["new"](r,n,o);return u.itemsize=s,u.transition=l,u.getDistance=function(){var t=(u.instance.position.y*u.itemsize+this.itemposition*u.itemsize)/s;return t},u.setContentSize=function(){u.contentsize.height=u.itemsize*u.itemcontainer.children.length},u.focus=function(t,e){u.instance.moving&&(u.instance.moving=!1,u.instance.targetposition.x=u.instance.position.x,u.instance.targetposition.y=u.instance.position.y),u.instance.pressOffset={x:u.instance.targetposition.x-t*u.movespeed/a*2,y:u.instance.targetposition.y-e*u.movespeed/s*2},u.pressStarted={x:t,y:e}},u.focusdrag=function(t,e){var i=u.instance.pressOffset.x+t*u.movespeed/a*2,r=u.instance.pressOffset.y+e*u.movespeed/s*2,n=u.pressStarted.x-t,o=u.pressStarted.y-e;(u.alwaysmove||u.contentsize.height!=u.size.height)&&Math.abs(o)>u.movethreshold&&u.instance.setMoving(n,o),u.instance.moving&&(u.instance.targetposition.x=i,u.instance.targetposition.y=r)},u.defocus=function(){var t=Math.floor(-u.instance.targetposition.y+.5);u.moveToSelectedItem&&(u.instance.targetposition.y=-t),u.selecteditem=t,u.selecteditem<0&&(u.selecteditem=u.wrap?u.itemcontainer.children.length+t:0),u.selecteditem>u.itemcontainer.children.length-1&&(u.selecteditem=u.wrap?t-u.itemcontainer.children.length:u.itemcontainer.children.length-1),u.selecteditem=u.selecteditem+1,null!=u.carouselmoved&&u.carouselmoved(u.selecteditem)},u.moveto=function(t,e){u.instance.targetposition.y=-t,e&&(u.instance.position.y=u.instance.targetposition.y),u.selecteditem=t,null!=u.carouselmoved&&u.carouselmoved(t)},u}}}();t.module("carousel_vertical",r)}(),function(){var t=document.currentScript.curlify,e=t.getModule("scene"),i=t.getModule("animator"),r=t.getModule("object"),n=t.getModule("focusable"),o=function(){return{"new":function(o,a,s){var l=t.localVars.screenWidth,u=t.localVars.screenHeight,c=n["new"](o,a,s);c.contentsize={width:c.size.width,height:c.size.height},c.movespeed=1,c.movethreshold=40,c.swipespeed=(l+u)/2*5,c.maxspeed=200,c.inertia=7,c.zeroposition=0,c.loaddistance=u,c.visibledistance=c.loaddistance,c.itempad=0,c.centerslots=!1,c.swipefunc=i.inQuad;var h=c.add(r["new"]("scrollable"));c.instance=h,h.targetposition={x:0,y:0,z:0};var d=function(t,e,i){i>100&&(i=100);var r=1;t>e&&(r=-1);var n=-r*(i/(16.66*c.inertia))*Math.abs(t-e),o=i/16.66*c.maxspeed;return n>o&&(n=o),-o>n&&(n=-o),Math.abs(n)<1e-5?t=e:t-=n,1==r&&t>e&&(t=e),-1==r&&e>t&&(t=e),t};c.focus=function(t,e){h.pressOffset={x:h.position.x-t*c.movespeed,y:h.position.y-e*c.movespeed},h.moving&&(h.resetpress(),h.moving=!1)},c.defocus=function(){e.getpointerStealer()==c&&c.centeronslots(),console.log("DEFOCUS",c.identifier,h.position.y,h.targetposition.y)},c.centeronslots=function(){if(c.centerslots){var t=Math.floor(c.selected()/(l+c.itempad));c.movetox(t*(l+c.itempad)+l/2)}},h.setMoving=function(){0==h.moving&&null==e.getpointerStealer()&&(e.stealPointers(c),h.moving=!0)},c.focusdrag=function(t,e){var i=h.pressOffset.x+t*c.movespeed,r=h.pressOffset.y+e*c.movespeed,n=i-h.targetposition.x,o=r-h.targetposition.y;c.contentsize.width!=c.size.width&&Math.abs(n)>c.movethreshold&&h.setMoving(),c.contentsize.height!=c.size.height&&Math.abs(o)>c.movethreshold&&h.setMoving(),h.moving&&(h.targetposition.x=i,h.targetposition.y=r)},c.step=function(t){var e=-(c.contentsize.width-c.size.width)+c.zeroposition,i=-(c.contentsize.height-c.size.height),r=t;r>66&&(r=66),0!=c.enforcelimits&&(h.targetposition.x>c.size.width/4+c.zeroposition&&(h.targetposition.x=c.size.width/4+c.zeroposition),h.targetposition.y>c.size.height/4&&(h.targetposition.y=c.size.height/4),h.targetposition.x<e-c.size.width/4&&(h.targetposition.x=e-c.size.width/4),h.targetposition.y<i-c.size.height/4&&(h.targetposition.y=i-c.size.height/4),0==c.focused&&(h.targetposition.x>c.zeroposition&&(h.targetposition.x=d(h.targetposition.x,c.zeroposition,t/2)),h.targetposition.y>0&&(h.targetposition.y=d(h.targetposition.y,0,t/2)),h.targetposition.x<e&&(h.targetposition.x=d(h.targetposition.x,e,t/2)),h.targetposition.y<i&&(h.targetposition.y=d(h.targetposition.y,i,t/2)))),0==c.focused&&(r/=2),c.contentsize.width!=c.size.width&&(h.position.x=d(h.position.x,h.targetposition.x,r)),c.contentsize.height!=c.size.height&&(h.position.y=d(h.position.y,h.targetposition.y,r)),0==c.focused&&h.position.x==h.targetposition.x&&h.position.y==h.targetposition.y&&(h.moving=!1)},c.selected=function(){return Math.floor(h.targetposition.x)},c.movetox=function(t,e){e&&(h.position.x=t),h.targetposition.x=t},c.movetoy=function(t,e){e&&(h.position.y=t),h.targetposition.y=t},c.prepare=function(){c.step(0);for(var t=0;t<h.children.length;t++)h.children[t].step(0)};var f=4*l,g=4*u,m=-f,p=f,v=-g,x=g;return c.intersectsScreen=function(t){var e=t.absolutex(),i=t.absolutey(),r=e-t.width()/2,n=e+t.width()/2,o=i-t.height()/2,a=i+t.height()/2;return!(m>n||r>p||v>a||o>x)},c.add=function(t,e){e?e:h.children.length;return t.parent=h,h.children.push(t),t.step=function(){this.xdistance=this.absolutex();var t=Math.sqrt(Math.pow(this.xdistance,2)+Math.pow(this.absolutey(),2));if(t<c.loaddistance)null!=this.load_content&&0==this.loaded&&this.load_content();else{var e=c.unloaddistance;null==e&&(e=c.loaddistance),t>e&&null!=this.load_content&&null!=this.unload_content&&this.loaded&&this.unload_content()}this.visible=t<c.visibledistance?!0:!1,this.distance=t},t},c}}}();t.module("scrollable",o)}(),function(){function initWebGL(t){gl=null;try{gl=t.getContext("webgl")||t.getContext("experimental-webgl")}catch(e){}return gl||(console.log("ERROR: Unable to initialize WebGL in target node"),gl=null),gl}function mousedown(t){if(!scene.isAnimating()&&1!=touch){console.log("mousedown : "+t.clientX+","+t.clientY,layoutOffset.x,layoutOffset.y);var e=t.currentTarget.getBoundingClientRect();touch=!0;var i=scene.getPointerUser();null!=i&&(i.press((t.clientX-e.left-layoutOffset.x)*layoutScale.x,(t.clientY-e.top-layoutOffset.y)*layoutScale.y),i.drag((t.clientX-e.left-layoutOffset.x)*layoutScale.x,(t.clientY-e.top-layoutOffset.y)*layoutScale.y))}}function mouseup(t){if(scene.resetPointerStealer(),!scene.isAnimating()&&0!=touch){console.log("mouseup : "+t.clientX+","+t.clientY);var e=t.currentTarget.getBoundingClientRect();touch=!1;var i=scene.getPointerUser();null!=i&&i.release((t.clientX-e.left-layoutOffset.x)*layoutScale.x,(t.clientY-e.top-layoutOffset.y)*layoutScale.y)}}function mouseout(t){console.log("mouseout : "+t.clientX+","+t.clientY),touch&&mouseup(t)}function mousemove(t){if(!scene.isAnimating()&&0!=touch){var e=t.currentTarget.getBoundingClientRect(),i=scene.getPointerUser();null!=i&&touch&&i.drag((t.clientX-e.left-layoutOffset.x)*layoutScale.x,(t.clientY-e.top-layoutOffset.y)*layoutScale.y)}}function touchstart(t){if(!scene.isAnimating()&&1!=touch){var e=t.currentTarget.getBoundingClientRect();touch=!0;var i=scene.getPointerUser();null!=i&&(i.press((t.touches[0].pageX-e.left-layoutOffset.x)*layoutScale.x,(t.touches[0].pageY-e.top-layoutOffset.y)*layoutScale.y),i.drag((t.touches[0].pageX-e.left-layoutOffset.x)*layoutScale.x,(t.touches[0].pageY-e.top-layoutOffset.y)*layoutScale.y),lasttouch=t)}}function touchend(t){if(scene.resetPointerStealer(),!scene.isAnimating()&&0!=touch){var e=t.currentTarget.getBoundingClientRect();touch=!1;var i=scene.getPointerUser();null!=i&&i.release(lasttouch.touches[0].pageX-e.left-layoutOffset.x,lasttouch.touches[0].pageY-e.top-layoutOffset.y)}}function touchmove(t){if(t.preventDefault(),!scene.isAnimating()&&0!=touch){var e=t.currentTarget.getBoundingClientRect(),i=scene.getPointerUser();null!=i&&(touch&&i.drag((t.touches[0].pageX-e.left-layoutOffset.x)*layoutScale.x,(t.touches[0].pageY-e.top-layoutOffset.y)*layoutScale.y),lasttouch=t)}}function deviceMotionHandler(t){sensors.acceleration=t.acceleration,sensors.rotation=t.rotationRate}function deviceOrientationHandler(t){sensors.orientation=t}function orientationChanged(){console.log("ORIENTATION CHANGED")}function resizeCanvas(){var t=glcanvas.clientWidth,e=glcanvas.clientHeight;if(glcanvas.width!=t||glcanvas.height!=e){layoutWidth=t,layoutHeight=e,layoutScale={x:screenWidth/layoutWidth,y:screenHeight/layoutHeight},viewWidth=screenWidth,viewHeight=screenHeight;var i=Math.max(layoutScale.x,layoutScale.y);aspectratioZoom&&(i=Math.min(layoutScale.x,layoutScale.y),viewWidth=t*i,viewHeight=e*i),layoutScale.x=i,layoutScale.y=i,layoutWidth=Math.floor(screenWidth*(1/i)),layoutHeight=Math.floor(screenHeight*(1/i)),layoutOffset.x=(t-layoutWidth)/2,layoutOffset.y=(e-layoutHeight)/2,glcanvas.width=glcanvas.clientWidth,glcanvas.height=glcanvas.clientHeight,curlify.localVars.layoutWidth=layoutWidth,curlify.localVars.layoutHeight=layoutHeight,curlify.localVars.layoutScale=layoutScale,curlify.localVars.layoutOffset=layoutOffset,curlify.localVars.viewWidth=viewWidth,curlify.localVars.viewHeight=viewHeight,curlify.localVars.screenWidth=screenWidth,curlify.localVars.screenHeight=screenHeight}}function mergeRecursive(t,e){for(var i in e)try{t[i]=e[i].constructor==Object?mergeRecursive(t[i],e[i]):e[i]}catch(r){t[i]=e[i]}return t}function getRandom(t,e){return Math.floor(Math.random()*(e-t)+t)}function spawn(t){return function(){function e(t,e){var o;try{o=i[t](e)}catch(a){return Promise.reject(a)}return o.done?o.value:Promise.resolve(o.value).then(r,n)}var i=t.apply(this,arguments),r=e.bind(e,"next"),n=e.bind(e,"throw");return r()}}function createCORSRequest(t,e){return new Promise(function(i,r){var n=new XMLHttpRequest;if("withCredentials"in n)n.open(t,e,!0);else{if("undefined"==typeof XDomainRequest)return n=null,void r(Error("createCORSRequest failed with 'XMLHttpRequest not supported'"));n=new XDomainRequest,n.open(t,e)}n.onload=function(){200==n.status?i(n.response):r(Error("cors request failed with '"+n.statusText+"'"))},n.onerror=function(){r(Error("cors request failed with 'Network Error'"))},n.send()})}function require(script){var module=curlify.getModule(script);return null!=module?module:new Promise(function(resolve,reject){var scriptid=script,element=document.getElementById(scriptid);if(null==element)if(".zip"==script.slice(-4))JSZipUtils.getBinaryContent(script,function(err,data){if(err)return void reject(Error("require zip load failed for '"+script+"' with '"+err+"'"));zipfile=new JSZip(data),curlify.localVars.zipfile=zipfile;var adscriptfile=zipfile.file("main.js");if(null==adscriptfile)return zipfile=null,curlify.localVars.zipfile=null,void reject(Error("require failed for '"+script+"' with 'main.js not found inside zip'"));var scriptobject=null;try{scriptobject=eval(adscriptfile.asText())}catch(e){return zipfile=null,curlify.localVars.zipfile=null,void reject(Error("require eval failed for zip '"+script+"' with '"+e+"'"))}resolve(scriptobject)});else{if(".js"!=script.slice(-3))return void reject(Error("require failed for '"+script+"' with 'unsupported source'"));element=document.createElement("script"),element.setAttribute("id",scriptid),element.setAttribute("type","script-container"),document.head.appendChild(element),appendedElements.push(scriptid),createCORSRequest("GET",script).then(function(response){try{element.scriptobject=eval(response)}catch(e){return void reject(Error("require eval failed for '"+script+"' with '"+e+"'",response))}resolve(element.scriptobject)},function(t){reject(Error("require load failed for '"+script+"' with '"+t+"'"))})}else resolve(element.scriptobject)})}console.log("inititalize main");var currentScript=document.currentScript,curlify=document.currentScript.curlify,revision="4";eval(curlify.extract(curlify.modules,"curlify.modules")),eval(curlify.extract(curlify.localVars,"curlify.localVars"));var glcanvas,aspectratioZoom=!0,touch=!1,lasttouch=null,imageid=0,running=!1,appendedElements=[],createProjection=function(t,e,i,r){var n=mat4.create();return n[0]=i/t,n[5]=i/e,n[10]=-(r+i)/(r-i),n[11]=-1,n[14]=-2*r*i/(r-i),n},createProjectionAndView=function(t,e,i,r){var n=createProjection(1,e/t,i,r),o=mat4.identity(mat4.create());mat4.translate(o,o,vec3.clone([0,0,-(r-i)/2]));var a=(r-i)/2/i,s={near:i,far:r,width:t,height:e,projectionMatrix:n,viewMatrix:o,translateScale:a};return s};curlify.addImageElement=function(){var t="curlify_image_"+imageid,e=document.createElement("img");return e.setAttribute("id",t),document.body.appendChild(e),appendedElements.push(t),imageid+=1,e},curlify.render=function(){gl.clearColor(0,0,0,0),gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT),gl.disable(gl.DEPTH_TEST),gl.enable(gl.CULL_FACE),gl.cullFace(gl.FRONT),gl.viewport(layoutOffset.x,layoutOffset.y,layoutWidth,layoutHeight),scene.render()},curlify.setRenderInterval=function(t){null!=curlify.intervalId&&window.clearInterval(curlify.intervalId),curlify.intervalId=window.setInterval(curlify.render,t)},curlify.stop=function(){if(console.log("Cleaning up..."),null==glcanvas)return void console.log("ERROR: canvas not set");"ontouchstart"in window?(glcanvas.removeEventListener("touchstart",touchstart,!1),glcanvas.removeEventListener("touchmove",touchmove,!1),glcanvas.removeEventListener("touchend",touchend,!1)):(glcanvas.removeEventListener("mousedown",mousedown,!1),glcanvas.removeEventListener("mousemove",mousemove,!1),glcanvas.removeEventListener("mouseup",mouseup,!1),glcanvas.removeEventListener("mouseout",mouseout,!1)),window.DeviceMotionEvent&&window.removeEventListener("devicemotion",deviceMotionHandler,!1),window.DeviceOrientationEvent&&window.removeEventListener("deviceorientation",deviceOrientationHandler,!1),window.removeEventListener("orientationchange",orientationChanged),scene.removeAllScenes();for(var t=0;t<appendedElements.length;t++){var e=appendedElements[t],i=document.getElementById(e);i.parentNode.removeChild(i),console.log("... removed element "+e)}appendedElements=[],null!=curlify.intervalId&&(console.log("... stopping render interval"),window.clearInterval(curlify.intervalId)),curlify.clearModuleBuffersAndPrograms(),running=!1},curlify.start=function(t){return console.log("curlify.start - revision",revision),running&&curlify.stop(),running=!0,null==t.script?void console.log("ERROR: no script source set"):(screenWidth=t.width?t.width:480,screenHeight=t.height?t.height:852,curlify.localVars.screenWidth=screenWidth,curlify.localVars.screenHeight=screenHeight,console.log("size",screenWidth,screenHeight),glcanvas=t.canvas?document.getElementById(t.canvas):currentScript.parentNode,curlify.localVars.glcanvas=glcanvas,null==glcanvas?void(t.canvas?console.log("ERROR: cannot find canvas to draw on:",t.canvas):console.log("ERROR: no canvas to draw to as parentNode:",glcanvas)):(gl=initWebGL(glcanvas),curlify.localVars.gl=gl,void(null!=gl&&("ontouchstart"in window?(glcanvas.addEventListener("touchstart",touchstart,!1),glcanvas.addEventListener("touchmove",touchmove,!1),glcanvas.addEventListener("touchend",touchend,!1)):(glcanvas.addEventListener("mousedown",mousedown,!1),glcanvas.addEventListener("mousemove",mousemove,!1),glcanvas.addEventListener("mouseup",mouseup,!1),glcanvas.addEventListener("mouseout",mouseout,!1)),resizeCanvas(),camera=createProjectionAndView(screenWidth,screenHeight,3,100),curlify.localVars.camera=camera,window.DeviceMotionEvent?window.addEventListener("devicemotion",deviceMotionHandler,!1):alert("DeviceMotionEvent not supported"),window.DeviceOrientationEvent?window.addEventListener("deviceorientation",deviceOrientationHandler,!1):alert("DeviceOrientationEvent not supported"),window.addEventListener("orientationchange",orientationChanged),require(t.script).then(function(e){scene.openScene(e["new"]()),null!=t.renderInterval&&curlify.setRenderInterval(t.renderInterval)})))))}}();