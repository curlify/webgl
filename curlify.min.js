!function(){console.log("initialize curlify",document.currentScript);var t={};document.currentScript.curlify={module:function(e,i){null!=t[e]&&console.log("WARNING: overwriting module",e),null==i&&console.log("ERROR: setting null code as module '"+e+"'"),t[e]=i},getModule:function(e){return t[e]},clearModuleBuffersAndPrograms:function(){console.log("clearModuleBuffersAndPrograms()");for(var e in t){var i=t[e];console.log("checking",i.id),null!=i.default_program&&(console.log("clearing module program",i.id),i.default_program.glProgram=null),null!=i.buffer&&(console.log("clearing module buffer",i.id),i.buffer=null)}}}}(),function(){var t=document.currentScript.curlify,e=function(){console.log("initialize glutils module");var t=function(t){window.console&&(window.console.error?window.console.error(t):window.console.log&&window.console.log(t))},e=function(e,i,r,n){var o=n||t,a=e.createShader(r);e.shaderSource(a,i),e.compileShader(a);var s=e.getShaderParameter(a,e.COMPILE_STATUS);return s?a:(lastError=e.getShaderInfoLog(a),o("*** Error compiling shader '"+a+"':"+lastError),e.deleteShader(a),null)};return{loadProgram:function(e,i,r,n){for(var o={},a=e.createProgram(),s=0;s<i.length;++s)e.attachShader(a,i[s]);e.linkProgram(a);var l=e.getProgramParameter(a,e.LINK_STATUS);if(!l)return lastError=e.getProgramInfoLog(a),t("Error in program linking:"+lastError),e.deleteProgram(a),null;if(r)for(var s=0;s<r.length;++s){var u=r[s]+"_handle";o[u]=e.getAttribLocation(a,r[s])}if(n)for(var s=0;s<n.length;++s){var u=n[s]+"_handle";o[u]=e.getUniformLocation(a,n[s])}return o.program=a,o},createShader:function(t,i,r,n){var o,a=i.text;if(!r)if("x-shader/x-vertex"==i.type)o=t.VERTEX_SHADER;else if("x-shader/x-fragment"==i.type)o=t.FRAGMENT_SHADER;else if(o!=t.VERTEX_SHADER&&o!=t.FRAGMENT_SHADER)throw"*** Error: unknown shader type";return e(t,a,r?r:o,n)}}}();t.module("glutils",e)}(),function(){var t=document.currentScript.curlify,e=function(){return console.log("initialize sys module"),{timestamp:function(){return(new Date).getTime()},ismobile:{Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return e.ismobile.Android()||e.ismobile.BlackBerry()||e.ismobile.iOS()||e.ismobile.Opera()||e.ismobile.Windows()}}}}();t.module("sys",e)}(),function(){var t=document.currentScript.curlify,e=function(){console.log("initialize fps module");var e=t.getModule("sys"),i=0,r=0;return{updateFps:function(){if(100==i){i=0;var t=e.timestamp(),n=1e5/(t-r);console.log("FPS : "+n),r=t}i+=1}}}();t.module("fps",e)}(),function(){var t=document.currentScript.curlify,e=function(){console.log("initialize animator module");var r=t.getModule("sys"),n={time:!0,ease:!0,start:!0,onComplete:!0};return{"new":function(){return{animations:[],animate:function(i,o){null==o.ease&&(o.ease=e.linear),null==o.start&&(o.start=0);var a={};for(var s in o){{o[s]}null==n[s]&&(t.assert(null!=i[s],"Animated property cannot be initially nil : "+s),a[s]=i[s])}this.animations.push({target:i,start:r.timestamp()+o.start,deadline:r.timestamp()+o.start+o.time,config:o,init:a})},step:function(){var t=[],e=r.timestamp();for(var n in this.animations){var o=this.animations[n],a=(o.deadline,0);1==o.paused&&(e=o.pausetimestamp),e<o.deadline?a=1-(o.deadline-e)/o.config.time:e<o.start?a=0:(a=1,t.push(n)),a=Math.max(a,1e-5);for(var n in o.init)initial=o.init[n],o.target[n]=o.config.ease(initial,o.config[n],a)}for(i=t.length-1;i>=0;i--){var s=this.animations[t[i]].config.onComplete;this.animations.splice(t[i],1),null!=s&&s()}},pause:function(){for(var t in this.animations)this.animations[t].paused=!0,this.animations[t].pausetimestamp=r.timestamp()},resume:function(){for(var t in this.animations)this.animations[t].paused=!1,this.animations[t].deadline=this.animations[t].deadline+(r.timestamp()-self.animations[t].pausetimestamp)},stop:function(){for(var t in this.animations)this.animations[t].init={},this.animations[t].config.onComplete=null;this.animations=[]}}}}}();e.linear=function(t,e,i){return t+(e-t)*i},e.inQuad=function(t,e,i){return t+(e-t)*i*i},e.outQuad=function(t,e,i){return t+-(e-t)*i*(i-2)},e.inOutQuad=function(t,e,i){return.5>i?(i=2*i,t+(e-t)/2*i*i):(i=2*(i-.5),t-(e-t)/2*(i*(i-2)-1))},e.inCubic=function(t,e,i){return t+(e-t)*i*i*i},e.outCubic=function(t,e,i){return i-=1,t+(e-t)*(i*i*i+1)},e.inOutCubic=function(t,e,i){return.5>i?(i=2*i,t+(e-t)/2*i*i*i):(i=2*(i-.5)-1,t+(e-t)/2*(i*i*i+2))},e.inQuart=function(t,e,i){return t+(e-t)*i*i*i*i},e.outQuart=function(t,e,i){return i-=1,t-(e-t)*(i*i*i*i-1)},e.inOutQuart=function(t,e,i){return.5>i?(i=2*i,t+(e-t)/2*i*i*i*i):(i=2*(i-.5)-1,t-(e-t)/2*(i*i*i*i-2))},e.inSine=function(t,e,i){return t+(e-t)*(1-Math.cos(i*Math.pi/2))},e.outSine=function(t,e,i){return t+(e-t)*Math.sin(i*Math.pi/2)},e.inOutSine=function(t,e,i){return t-(e-t)/2*(Math.cos(Math.pi*i)-1)},e.inExpo=function(t,e,i){return i-=1,t+(e-t)*Math.pow(2,10*i)},e.outExpo=function(t,e,i){return t+(e-t)*(1-Math.pow(2,-10*i))},e.inOutExpo=function(t,e,i){return.5>i?(i=2*i-1,t+(e-t)/2*Math.pow(2,10*i)):(i=2*(i-.5),t+(e-t)/2*(2-Math.pow(2,-10*i)))},e.inCirc=function(t,e,i){return t+(e-t)*(1-Math.sqrt(1-i*i))},e.outCirc=function(t,e,i){return i-=1,t+(e-t)*Math.sqrt(1-i*i)},e.inOutCirc=function(t,e,i){return.5>i?(i=2*i,t+(e-t)/2*(1-Math.sqrt(1-i*i))):(i=2*(i-.5)-1,t+(e-t)/2*(1+Math.sqrt(1-i*i)))},e.inElastic=function(t,e,i){return i-=1,t-(e-t)*Math.pow(2,10*i)*Math.sin(6*(i-.0777777)*Math.pi)},e.outElastic=function(t,e,i){return t+(e-t)*(Math.pow(2,-10*i)*Math.sin(6*(i-.0777777)*Math.pi)+1)},t.module("animator",e)}(),function(){var t=document.currentScript.curlify,e=function(){console.log("initialize scene module");var e=t.getModule("animator"),i=[],r=[],n=e["new"](),o=null;return{render:function(){if(n.step(),n.animations.length>0){var t=i[i.length-2];t.stepTree(),t.drawTree()}var e=i[i.length-1];if(null!=e){e.stepTree(),e.drawTree();for(var o=0;o<r.length;o++)!new function(){var t=r[o];t.renderFbo()};r=[]}},openScene:function(t,e,r){var o=i[i.length-1];i.push(t),null!=e&&n.animate(t,e),null!=o&&null!=r&&n.animate(o,r)},closeScene:function(t,e){var r=i[i.length-1],o=i[i.length-2];if(null!=t){var a=t.onComplete,s=function(){null!=a&&a(),i.splice(i.length-1,1),console.log("remove scene from stack",r.identifier,i.length)};t.onComplete=s,n.animate(r,t)}else i.splice(i.length-1,1);null!=o&&null!=e&&n.animate(o,e)},removeAllScenes:function(){i=[],r=[],n.stop(),o=null},isAnimating:function(){return n.animations.length>0?!0:!1},getPointerUser:function(){return o?o:i[i.length-1]},getpointerStealer:function(){return o},stealPointers:function(t){console.log("stealPointers",t);var e=o?o:i[i.length-1];o=t,e.resetpress()},resetPointerStealer:function(){o=null},addFboUpdate:function(t){r.push(t)}}}();t.module("scene",e)}(),function(){var t=document.currentScript.curlify,e=function(){console.log("initialize object module");var e=t.getModule("scene"),i=t.getModule("animator"),r=t.getModule("sys");return{"new":function(n,o,a){var s=t.gl;return{identifier:null==n?"object identifier":n,position:{x:0,y:0,z:0},rotate:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},size:{width:null==o?t.screenWidth:o,height:null==a?t.screenHeight:a},children:[],active:!0,visible:!0,alpha:1,blend:!0,drawbackside:!1,depthtest:!1,projectionMatrix:t.camera.projectionMatrix,viewMatrix:t.camera.viewMatrix,modelMatrix:mat4.identity(mat4.create()),modelViewMatrix:mat4.identity(mat4.create()),translateScale:t.camera.translateScale,identityMatrix:mat4.identity(mat4.create()),anim:i["new"](),timervalue:0,lastdraw:0,laststep:0,add:function(t){return t.parent=this,this.children.push(t),t},updateModelMatrix:function(){var e=this.modelMatrix;if(mat4.copy(e,this.identityMatrix),0!=this.position.x||0!=this.position.y||0!=this.position.z){var i=t.screenWidth/(2*this.translateScale);mat4.translate(e,e,vec3.clone([this.position.x/i,-this.position.y/i,this.position.z/i]))}0!=this.rotate.z&&mat4.rotateZ(e,e,-this.rotate.z),0!=this.rotate.y&&mat4.rotateY(e,e,-this.rotate.y),0!=this.rotate.x&&mat4.rotateX(e,e,-this.rotate.x),(1!=this.scale.x||1!=this.scale.y||1!=this.scale.z)&&mat4.scale(e,e,vec3.clone([this.scale.x,this.scale.y,this.scale.z])),this.modelMatrix=e},update:function(){var t=this.viewMatrix;null!=this.parent&&null!=this.parent.modelViewMatrix&&(t=this.parent.modelViewMatrix),this.viewMatrix=t,this.updateModelMatrix(),this.children.length>0&&(mat4.copy(this.modelViewMatrix,this.viewMatrix),mat4.multiply(this.modelViewMatrix,this.modelViewMatrix,this.modelMatrix)),this.depthtest?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),0==this.blend?s.disable(s.BLEND):(s.enable(s.BLEND),s.blendFunc(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA)),1==this.drawbackside?s.disable(s.CULL_FACE):(s.enable(s.CULL_FACE),s.cullFace(s.FRONT))},stepTree:function(){var t=Math.max(1,Math.min(r.timestamp()-this.laststep,60));this.laststep=r.timestamp(),this.anim.step(),null!=this.preStep&&this.preStep(),null!=this.step&&this.step(t);for(var e=0;e<this.children.length;e++)this.children[e].stepTree();null!=this.postStep&&this.postStep()},drawTree:function(){Math.min(r.timestamp()-this.lastdraw,60);if(this.lastdraw=r.timestamp(),0!=this.visible){if(this.update(),null!=this.preDraw&&this.preDraw(),null!=this.draw&&this.draw(),this.reverseDrawOrder)for(var t=this.children.length-1;t>=0;t--)this.children[t].drawTree();else for(var t=0;t<this.children.length;t++)this.children[t].drawTree();null!=this.postDraw&&this.postDraw()}},press:function(e,i){var r=!1;if(null!=this.relativePress){var n=e-t.screenWidth/2-this.absolutex(),o=i-t.screenHeight/2-this.absolutey();r=this.relativePress(n,o)}null!=this.absolutePress&&(r=this.absolutePress(e,i));for(var a=this.children.length-1;a>=0;a--)this.children[a].active&&(r=this.children[a].press(e,i));return r},drag:function(e,i){var r=!1;if(null!=this.relativeDrag){var n=e-t.screenWidth/2-this.absolutex(),o=i-t.screenHeight/2-this.absolutey();r=this.relativeDrag(n,o)}null!=this.absoluteDrag&&(r=this.absoluteDrag(e,i));for(var a=this.children.length-1;a>=0;a--)this.children[a].active&&(r=this.children[a].drag(e,i));return r},release:function(e,i){var r=!1;if(null!=this.relativeRelease){var n=e-t.screenWidth/2-this.absolutex(),o=i-t.screenHeight/2-this.absolutey();r=this.relativeRelease(n,o)}null!=this.absoluteRelease&&(r=this.absoluteRelease(e,i));for(var a=this.children.length-1;a>=0;a--)this.children[a].active&&(r=this.children[a].release(e,i));return r},resetpress:function(){if(1==this.active){for(var t=this.children.length-1;t>=0;t--)this.children[t].resetpress();this!=e.getpointerStealer()&&null!=this.pointerReset&&this.pointerReset()}},x:function(){return this.position.x},y:function(){return this.position.y},width:function(){return this.size.width*this.scale.x},height:function(){return this.size.height*this.scale.y},top:function(){return this.position.y-this.height()/2},bottom:function(){return this.position.y+this.height()/2},left:function(){return this.position.x-this.width()/2},right:function(){return this.position.x+this.width()/2},absolutex:function(){var t=0;return null!=this.parent&&(t=this.parent.absolutex()),t+this.x()},absolutey:function(){var t=0;return null!=this.parent&&(t=this.parent.absolutey()),t+this.y()},absolutescalex:function(){var t=1;return null!=this.parent&&(t=this.parent.absolutescalex()),t*this.scale.x},absolutescaley:function(){var t=1;return null!=this.parent&&(t=this.parent.absolutescaley()),t*this.scale.y},absolutealpha:function(){var t=1;return null!=this.parent&&(t=this.parent.absolutealpha()),t*this.alpha},activate:function(){this.active=!0,null!=this.postActivate&&this.postActivate()},deactivate:function(){this.active=!1,null!=this.postDeactivate&&this.postDeactivate()}}}}}();t.module("object",e)}(),function(){var t=document.currentScript.curlify,e=function(){console.log("initialize quad module");var i=t.getModule("glutils"),r=t.getModule("object");return{buffer:null,default_program:{glProgram:null,getProgram:function(){return null==this.glProgram&&this.loadProgram(),this.glProgram},loadProgram:function(){var e={text:"              attribute vec2 a_position;              attribute vec2 a_tex_coordinate;                            uniform mat4 u_projection;              uniform mat4 u_view;              uniform mat4 u_model;                            varying vec2 v_tex_coord;                            void main() {                gl_Position = u_projection*u_view*u_model*vec4(a_position, 0.0, 1.0);                v_tex_coord = a_tex_coordinate;              }            ",type:"x-shader/x-vertex"},r={text:"              precision mediump float;                            varying vec2      v_tex_coord;                            uniform sampler2D u_texture;              uniform float     u_alpha;                            void main() {                vec4 color = texture2D(u_texture, v_tex_coord);                gl_FragColor = color * u_alpha;              }            ",type:"x-shader/x-fragment"},n=i.createShader(t.gl,e),o=i.createShader(t.gl,r);this.glProgram=i.loadProgram(t.gl,[n,o],["a_position","a_tex_coordinate"],["u_texture","u_alpha","u_model","u_view","u_projection"])}},"new":function(i,n,o){var a=t.gl;null==this.buffer&&(this.buffer=t.gl.createBuffer(),this.buffer.itemSize=2,this.buffer.numItems=4,a.bindBuffer(a.ARRAY_BUFFER,this.buffer),vertices=[-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1],a.bufferData(a.ARRAY_BUFFER,new Float32Array(vertices),a.STATIC_DRAW));var s=r["new"](i,n,o);return s.glProgram=this.default_program.getProgram(),s.quadModelMatrix=mat4.identity(mat4.create()),s.updateModelMatrix=function(){var e=this.modelMatrix;if(mat4.copy(e,this.identityMatrix),0!=this.position.x||0!=this.position.y||0!=this.position.z){var i=t.screenWidth/(2*this.translateScale);mat4.translate(e,e,vec3.clone([this.position.x/i,-this.position.y/i,this.position.z/i]))}0!=this.rotate.z&&mat4.rotateZ(e,e,-this.rotate.z),0!=this.rotate.y&&mat4.rotateY(e,e,-this.rotate.y),0!=this.rotate.x&&mat4.rotateX(e,e,-this.rotate.x),(1!=this.scale.x||1!=this.scale.y||1!=this.scale.z)&&mat4.scale(e,e,vec3.clone([this.scale.x,this.scale.y,this.scale.z])),this.modelMatrix=e,mat4.copy(this.quadModelMatrix,this.modelMatrix);var r=t.screenWidth/this.translateScale;mat4.scale(this.quadModelMatrix,this.quadModelMatrix,vec3.clone([this.size.width/r,-this.size.height/r,1]))},s.draw=function(){if(null!=s.texture){a.useProgram(this.glProgram.program),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,s.texture),a.uniform1i(this.glProgram.u_texture_handle,0),a.uniform1f(this.glProgram.u_alpha_handle,this.absolutealpha()),a.uniformMatrix4fv(this.glProgram.u_projection_handle,!1,this.projectionMatrix),a.uniformMatrix4fv(this.glProgram.u_view_handle,!1,this.viewMatrix),a.uniformMatrix4fv(this.glProgram.u_model_handle,!1,this.quadModelMatrix);var t=this.buffer?this.buffer:e.buffer;a.bindBuffer(a.ARRAY_BUFFER,t),a.enableVertexAttribArray(this.glProgram.a_position_handle),a.enableVertexAttribArray(this.glProgram.a_tex_coordinate_handle),a.vertexAttribPointer(this.glProgram.a_position_handle,t.itemSize,a.FLOAT,!1,16,0),a.vertexAttribPointer(this.glProgram.a_tex_coordinate_handle,t.itemSize,a.FLOAT,!1,16,8),a.drawArrays(a.TRIANGLE_STRIP,0,t.numItems)}},s}}}();t.module("quad",e)}(),function(){var t=document.currentScript.curlify,e=t.getModule("object"),i=t.getModule("quad"),r=function(){return console.log("initialize plane module"),{"new":function(r,n,o,a,s){for(var l=t.gl,u=e["new"](r,a,s),c=n+1,h=o+1,d=u.size.height/u.size.width,f=[],g=0;h>g;g++)for(var m=(-1+2*g/o)*d,p=g/o,v=0;c>v;v++){var y=-1+2*v/n,x=v/n;f.push(y,m,x,p)}u.buffer=l.createBuffer(),u.buffer.itemSize=2,u.buffer.numItems=4,l.bindBuffer(l.ARRAY_BUFFER,u.buffer),l.bufferData(l.ARRAY_BUFFER,new Float32Array(f),l.STATIC_DRAW);for(var _=[],w=0,b=0;o>b;b++)for(var E=0;n>E;E++)_.push(b*c+E),_.push(b*c+E+1),_.push((b+1)*c+E),_.push(b*c+E+1),_.push((b+1)*c+E+1),_.push((b+1)*c+E),w+=6;return u.indices=l.createBuffer(),u.indices.indexCount=_.length,l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,u.indices),l.bufferData(l.ELEMENT_ARRAY_BUFFER,new Uint16Array(_),l.STATIC_DRAW),u.glProgram=i.default_program.getProgram(),u.quadModelMatrix=mat4.identity(mat4.create()),u.updateModelMatrix=function(){var e=this.modelMatrix;if(mat4.copy(e,this.identityMatrix),0!=this.position.x||0!=this.position.y||0!=this.position.z){var i=t.screenWidth/(2*this.translateScale);mat4.translate(e,e,vec3.clone([this.position.x/i,-this.position.y/i,this.position.z/i]))}0!=this.rotate.z&&mat4.rotateZ(e,e,-this.rotate.z),0!=this.rotate.y&&mat4.rotateY(e,e,-this.rotate.y),0!=this.rotate.x&&mat4.rotateX(e,e,-this.rotate.x),(1!=this.scale.x||1!=this.scale.y||1!=this.scale.z)&&mat4.scale(e,e,vec3.clone([this.scale.x,this.scale.y,this.scale.z])),this.modelMatrix=e,mat4.copy(this.quadModelMatrix,this.modelMatrix);var r=t.screenWidth/this.translateScale;mat4.scale(this.quadModelMatrix,this.quadModelMatrix,vec3.clone([this.size.width/r,-this.size.height/r*1/d,1]))},u.draw=function(){null!=u.texture&&(l.useProgram(this.glProgram.program),l.activeTexture(l.TEXTURE0),l.bindTexture(l.TEXTURE_2D,u.texture),l.uniform1i(this.glProgram.u_texture_handle,0),l.uniform1f(this.glProgram.u_alpha_handle,this.absolutealpha()),l.uniformMatrix4fv(this.glProgram.u_projection_handle,!1,this.projectionMatrix),l.uniformMatrix4fv(this.glProgram.u_view_handle,!1,this.viewMatrix),l.uniformMatrix4fv(this.glProgram.u_model_handle,!1,this.quadModelMatrix),l.bindBuffer(l.ARRAY_BUFFER,this.buffer),l.enableVertexAttribArray(this.glProgram.a_position_handle),l.enableVertexAttribArray(this.glProgram.a_tex_coordinate_handle),l.vertexAttribPointer(this.glProgram.a_position_handle,this.buffer.itemSize,l.FLOAT,!1,16,0),l.vertexAttribPointer(this.glProgram.a_tex_coordinate_handle,this.buffer.itemSize,l.FLOAT,!1,16,8),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,this.indices),l.drawElements(l.TRIANGLES,this.indices.indexCount,l.UNSIGNED_SHORT,0))},u}}}();t.module("plane",r)}(),function(){var t=document.currentScript.curlify,e=function(){var e=t.getModule("quad");return{"new":function(t,i,r){var n=e["new"](t,i,r);return n.focused=!1,n.hit=function(t,e){return t<-this.width()/2||t>this.width()/2||e<-this.height()/2||e>this.height()/2?!1:!0},n.relativePress=function(t,e){return this.hit(t,e)?(null!=this.focus&&this.focus(t,e),this.focused=!0,!0):!1},n.relativeDrag=function(t,e){return 1!=this.focused?!1:(1!=this.hit(t,e)?(null!=this.defocus&&this.defocus(t,e),this.focused=!1):null!=this.focusdrag&&this.focusdrag(t,e),!0)},n.relativeRelease=function(t,e){return 1!=this.focused?!1:(null!=this.click&&this.click(t,e),null!=this.defocus&&this.defocus(t,e),this.focused=!1,!0)},n.pointerReset=function(){null!=this.defocus&&this.defocus(0,0),this.focused=!1},n}}}();t.module("focusable",e)}(),function(){var t=document.currentScript.curlify,e=function(){console.log("initialize rectangle module");var e=t.getModule("glutils"),i=t.getModule("quad");return{default_program:{glProgram:null,getProgram:function(){return null==this.glProgram&&this.loadProgram(),this.glProgram},loadProgram:function(){var i={text:"              attribute vec2 a_position;                            uniform mat4 u_projection;              uniform mat4 u_view;              uniform mat4 u_model;                            void main() {                gl_Position = u_projection*u_view*u_model*vec4(a_position, 0.0, 1.0);              }",type:"x-shader/x-vertex"},r={text:"              precision mediump float;                            uniform float     u_red;              uniform float     u_green;              uniform float     u_blue;              uniform float     u_alpha;                            void main() {                gl_FragColor = vec4( u_red, u_green, u_blue, 1.0 ) * u_alpha;              }",type:"x-shader/x-fragment"},n=e.createShader(t.gl,i),o=e.createShader(t.gl,r);this.glProgram=e.loadProgram(t.gl,[n,o],["a_position"],["u_red","u_green","u_blue","u_alpha","u_model","u_view","u_projection"])}},"new":function(e,r,n){var o=t.gl,a=i["new"]("rectangle",e,r);return a.glProgram=this.default_program.getProgram(),a.color=null==n?{red:0,green:0,blue:0}:n,a.draw=function(){o.useProgram(this.glProgram.program),o.uniform1f(this.glProgram.u_red_handle,this.color.red),o.uniform1f(this.glProgram.u_green_handle,this.color.green),o.uniform1f(this.glProgram.u_blue_handle,this.color.blue),o.uniform1f(this.glProgram.u_alpha_handle,this.absolutealpha()),o.uniformMatrix4fv(this.glProgram.u_projection_handle,!1,this.projectionMatrix),o.uniformMatrix4fv(this.glProgram.u_view_handle,!1,this.viewMatrix),o.uniformMatrix4fv(this.glProgram.u_model_handle,!1,this.quadModelMatrix);var t=this.buffer?this.buffer:i.buffer;o.bindBuffer(o.ARRAY_BUFFER,t),o.enableVertexAttribArray(this.glProgram.a_position_handle),o.vertexAttribPointer(this.glProgram.a_position_handle,t.itemSize,o.FLOAT,!1,16,0),o.drawArrays(o.TRIANGLE_STRIP,0,t.numItems)},a}}}();t.module("rectangle",e)}(),function(){var t=document.currentScript.curlify,e=function(){console.log("initialize image module");var i=t.getModule("quad");return{loadImage:function(e){var i=null;if("string"!=typeof e)return console.log("ERROR: image.loadImage source is not of type string",e),null;if(i=new Image,null!=t.zipfile){console.log("image.source zip",r,e,t.zipfile);var r=t.zipfile.file(e);i.src="data:image/jpg;base64,"+JSZip.base64.encode(r.asBinary())}else i.crossOrigin="anonymous",i.src=e;return i},"new":function(r,n){var o=t.gl,a=n?n:i["new"]("image : "+r);return a.size.width=null,a.size.height=null,r instanceof HTMLElement?(a.texture=o.createTexture(),o.bindTexture(o.TEXTURE_2D,a.texture),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,r),null==a.size.width&&(a.size.width=r.width),null==a.size.height&&(a.size.height=r.height),a.loaded=!0,null!=a.onload&&a.onload()):r instanceof Object?null!=r.texture||null!=r.size?(a.texture=r.texture,a.image=r.image,null==a.size.width&&(a.size.width=r.size.width),null==a.size.height&&(a.size.height=r.size.height),a.loaded=!0,null!=a.onload&&a.onload()):console.log("ERROR: image.new from unknown Object",r):"string"==typeof r?(a.image=e.loadImage(r),a.image.onload=function(){return null==e?void console.log("image == null!"):(a.texture=o.createTexture(),o.bindTexture(o.TEXTURE_2D,a.texture),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,a.image),null==a.size.width&&(a.size.width=a.image.width),null==a.size.height&&(a.size.height=a.image.height),a.loaded=!0,void(null!=a.onload&&a.onload()))},a.image.onerror=function(){console.log("texture load failed",r)}):console.log("ERROR: image.new from unknown object",r),a}}}();t.module("image",e)}(),function(){var t=document.currentScript.curlify,e=t.getModule("glutils"),i=t.getModule("image"),r=t.getModule("quad"),n=function(){return console.log("initialize masked_image module"),{default_program:{program:null,getProgram:function(){return null==this.glProgram&&this.loadProgram(),this.glProgram},loadProgram:function(){var i={text:"            attribute vec2 a_position;             attribute vec2 a_tex_coordinate;                         uniform mat4 u_projection;             uniform mat4 u_view;             uniform mat4 u_model;                         varying vec2 v_tex_coord;                         void main() {               gl_Position = u_projection*u_view*u_model*vec4(a_position, 0.0, 1.0);               v_tex_coord = a_tex_coordinate;             }             ",type:"x-shader/x-vertex"},r={text:"            precision mediump float;                         varying vec2      v_tex_coord;                         uniform sampler2D u_texture;             uniform sampler2D u_mask_texture;             uniform float     u_alpha;                         void main() {                             vec4 color = texture2D(u_texture, v_tex_coord);               vec4 mask_color = texture2D(u_mask_texture, v_tex_coord);                             gl_FragColor = color * mask_color.a * u_alpha;             }             ",type:"x-shader/x-fragment"},n=e.createShader(t.gl,i),o=e.createShader(t.gl,r);this.glProgram=e.loadProgram(t.gl,[n,o],["a_position","a_tex_coordinate"],["u_texture","u_mask_texture","u_alpha","u_model","u_view","u_projection"])}},"new":function(e,n){var o=t.gl,a=i["new"](e);return a.identifier="masked_image : "+e+" : "+n,console.log(a.identifier),a.mask=n,a.glProgram=this.default_program.getProgram(),a.draw=function(){if(1==a.loaded){o.useProgram(this.glProgram.program),o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,a.texture),o.uniform1i(this.glProgram.u_texture_handle,0),o.activeTexture(o.TEXTURE1),o.bindTexture(o.TEXTURE_2D,a.mask.texture),o.uniform1i(this.glProgram.u_mask_texture_handle,1),o.uniform1f(this.glProgram.u_alpha_handle,this.absolutealpha()),o.uniformMatrix4fv(this.glProgram.u_projection_handle,!1,this.projectionMatrix),o.uniformMatrix4fv(this.glProgram.u_view_handle,!1,this.viewMatrix),o.uniformMatrix4fv(this.glProgram.u_model_handle,!1,this.quadModelMatrix);var t=this.buffer?this.buffer:r.buffer;o.bindBuffer(o.ARRAY_BUFFER,t),o.enableVertexAttribArray(this.glProgram.a_position_handle),o.enableVertexAttribArray(this.glProgram.a_tex_coordinate_handle),o.vertexAttribPointer(this.glProgram.a_position_handle,t.itemSize,o.FLOAT,!1,16,0),o.vertexAttribPointer(this.glProgram.a_tex_coordinate_handle,t.itemSize,o.FLOAT,!1,16,8),o.drawArrays(o.TRIANGLE_STRIP,0,t.numItems)}},a}}}();t.module("masked_image",n)}(),function(){var t=document.currentScript.curlify,e=function(){console.log("initialize fbo_object module");var e=t.getModule("glutils"),i=t.getModule("scene"),r=t.getModule("quad"),n=t.getModule("sys");return{default_program:{glProgram:null,getProgram:function(){return null==this.glProgram&&this.loadProgram(),this.glProgram},loadProgram:function(){var i={text:"              attribute vec2 a_position;              attribute vec2 a_tex_coordinate;                            uniform mat4 u_projection;              uniform mat4 u_view;              uniform mat4 u_model;                            varying vec2 v_tex_coord;                            void main() {                gl_Position = u_projection*u_view*u_model*vec4(a_position, 0.0, 1.0);                v_tex_coord = vec2(a_tex_coordinate.x,1.0-a_tex_coordinate.y);              }              ",type:"x-shader/x-vertex"},r={text:"              precision mediump float;                            varying vec2      v_tex_coord;                            uniform sampler2D u_texture;              uniform float     u_alpha;                            void main() {                vec4 color = texture2D(u_texture, v_tex_coord);                gl_FragColor = color * u_alpha;              }            ",type:"x-shader/x-fragment"},n=e.createShader(t.gl,i),o=e.createShader(t.gl,r);this.glProgram=e.loadProgram(t.gl,[n,o],["a_position","a_tex_coordinate"],["u_texture","u_alpha","u_model","u_view","u_projection"])}},"new":function(e,o,a,s){var l=t.gl,u=r["new"]("fbo_object : "+e,o,a);u.glProgram=this.default_program.getProgram(),console.log("fbo_object.new(",u.dentifier,u.size.width,u.size.height,")"),u.dobypassFbo=!1,u.lastUpdated=-99999,u.updateInterval=0,u.framebuffer=l.createFramebuffer(),u.framebuffer.width=u.size.width,u.framebuffer.height=u.size.height,l.bindFramebuffer(l.FRAMEBUFFER,u.framebuffer),u.texture=l.createTexture(),l.bindTexture(l.TEXTURE_2D,u.texture),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.LINEAR),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.LINEAR);var c=s?l.RGB:l.RGBA;return l.texImage2D(l.TEXTURE_2D,0,c,u.framebuffer.width,u.framebuffer.height,0,c,l.UNSIGNED_BYTE,null),l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,u.texture,0),l.bindTexture(l.TEXTURE_2D,null),l.bindFramebuffer(l.FRAMEBUFFER,null),u.preStep=function(){var t=n.timestamp()-this.lastUpdated;this.fboUpdatesDisabled||this.dobypassFbo||t>=this.updateInterval&&u.updateFbo()},u.updateFbo=function(){i.addFboUpdate(u)},u.renderFbo=function(){l.bindTexture(l.TEXTURE_2D,null);var e=l.getParameter(l.FRAMEBUFFER_BINDING),i=t.screenWidth,r=t.screenHeight,o=t.layoutWidth,a=t.layoutHeight,s={x:t.layoutOffset.x,y:t.layoutOffset.y};l.viewport(0,0,u.size.width,u.size.height),l.bindFramebuffer(l.FRAMEBUFFER,u.framebuffer),l.clearColor(0,0,0,0),l.clear(l.COLOR_BUFFER_BIT|l.DEPTH_BUFFER_BIT),t.screenWidth=u.size.width,t.screenHeight=u.size.height,t.layoutWidth=u.size.width,t.layoutHeight=u.size.height,t.layoutOffset={x:0,y:0};for(var c=0;c<u.children.length;c++)u.children[c].parent=null,u.children[c].viewMatrix=t.camera.viewMatrix,u.children[c].drawTree();t.screenWidth=i,t.screenHeight=r,t.layoutWidth=o,t.layoutHeight=a,t.layoutOffset=s,l.viewport(t.layoutOffset.x,t.layoutOffset.y,t.layoutWidth,t.layoutHeight),l.bindFramebuffer(l.FRAMEBUFFER,e),u.lastUpdated=n.timestamp()},u.drawTree=function(){Math.min(n.timestamp()-this.lastdraw,60);if(this.lastdraw=n.timestamp(),0!=this.visible){if(this.update(),this.dobypassFbo)for(var t=0;t<this.children.length;t++)this.children[t].parent=this,this.children[t].viewMatrix=this.modelViewMatrix,this.children[t].drawTree();else null!=this.draw&&this.draw();null!=this.postDraw&&this.postDraw()}},u.draw=function(){l.useProgram(this.glProgram.program),l.activeTexture(l.TEXTURE0),l.bindTexture(l.TEXTURE_2D,u.texture),l.uniform1i(this.glProgram.u_texture_handle,0),l.uniform1f(this.glProgram.u_alpha_handle,this.absolutealpha()),l.uniformMatrix4fv(this.glProgram.u_projection_handle,!1,this.projectionMatrix),l.uniformMatrix4fv(this.glProgram.u_view_handle,!1,this.viewMatrix),l.uniformMatrix4fv(this.glProgram.u_model_handle,!1,this.quadModelMatrix);var t=this.buffer?this.buffer:r.buffer;l.bindBuffer(l.ARRAY_BUFFER,t),l.enableVertexAttribArray(this.glProgram.a_position_handle),l.enableVertexAttribArray(this.glProgram.a_tex_coordinate_handle),l.vertexAttribPointer(this.glProgram.a_position_handle,t.itemSize,l.FLOAT,!1,16,0),l.vertexAttribPointer(this.glProgram.a_tex_coordinate_handle,t.itemSize,l.FLOAT,!1,16,8),l.drawArrays(l.TRIANGLE_STRIP,0,t.numItems)},u}}}();t.module("fbo_object",e)}(),function(){var t=document.currentScript.curlify,e=function(){console.log("initialize button module");{var e=t.getModule("image");t.getModule("focusable")}return{"new":function(t){var i=e["new"](t);return i.focused=!1,i.identifier="button : "+t,i.hit=function(t,e){return t<-this.width()/2||t>this.width()/2||e<-this.height()/2||e>this.height()/2?!1:!0},i.relativePress=function(t,e){return this.hit(t,e)?(null!=this.focus&&this.focus(t,e),this.focused=!0,!0):!1},i.relativeDrag=function(t,e){return 1!=this.focused?!1:(1!=this.hit(t,e)?(null!=this.defocus&&this.defocus(t,e),this.focused=!1):null!=this.focusdrag&&this.focusdrag(t,e),!0)},i.relativeRelease=function(t,e){return 1!=this.focused?!1:(null!=this.click&&this.click(t,e),null!=this.defocus&&this.defocus(t,e),this.focused=!1,!0)},i.pointerReset=function(){null!=this.defocus&&this.defocus(0,0),this.focused=!1},i}}}();t.module("button",e)}(),function(){var t=document.currentScript.curlify,e=t.getModule("object"),i=t.getModule("focusable"),r=t.getModule("image"),n=function(t,e,n,o,a){n=n?n:t.frames.length,o=o?o:0;
for(var s=a?a:i["new"]("spritesheet "+t.name),l=o;o+n>l;l++){var u=s.add(r["new"](t.frames[l]));u.visible=!1,u.active=!1}return s.size.width=t.spritewidth,s.size.height=t.spriteheight,s.frame=s.children[0],s.frametimervalue=0,s.frametime=35,s.restart=function(t){s.frametimervalue=0;var i=s.restart;0==e&&(i=null);var r=s.loopdelay&&!t?s.loopdelay:0;s.anim.animate(s,{frametimervalue:s.children.length,start:r,time:s.frametime*s.children.length,onComplete:i})},s.preStep=function(){s.frame.visible=!1;var t=Math.floor(s.frametimervalue);t>s.children.length-1||(s.frame=s.children[t],s.frame.visible=!0)},s.start=function(){return s.anim.animations.length>0&&s.anim.animations[0].paused?void s.anim.resume():void s.restart()},s.stop=function(){s.anim.pause()},s.unload=function(){s.anim.stop()},0!=e&&s.restart(!0),s},o=function(){return{newSheet:function(t,e,i){var n={spritewidth:0,spriteheight:0,frames:[]};if(t instanceof Array){var o=e,a=i,s=document.createElement("canvas");s.width=o,s.height=a;for(var l=s.getContext("2d"),u=0,c=0;c<t.length;c++)!new function(){var e=r.loadImage(t[c]);e.onload=function(){l.drawImage(e,0,0),n.frames.push(r["new"](s)),l.clearRect(0,0,s.width,s.height),u+=1,u==t.length&&null!=n.onload&&n.onload()}};n.spritewidth=o,n.spriteheight=a,n.name="array "+t.length}else{var h=r.loadImage(t);h.onload=function(){var o=h.width/e,a=h.height/i,s=document.createElement("canvas");s.width=o,s.height=a;for(var l=s.getContext("2d"),u=0;i>u;u++)for(var c=0;e>c;c++)l.drawImage(h,-c*o,-u*a),n.frames.push(r["new"](s)),l.clearRect(0,0,s.width,s.height);n.spritewidth=o,n.spriteheight=a,n.name=t,null!=n.onload&&n.onload()}}return n},newFromSheet:function(t,e,i,r,o){return n(t,e,i,r,o)},"new":function(t,i,r,o,a,s){var l=this.newSheet(t,i,r),u=e["new"]("sprite loader");return u.sheet=l,l.onload=function(){n(l,o,a,s,u),null!=u.onload&&u.onload()},u}}}();t.module("sprite",o)}(),function(){var t=document.currentScript.curlify,e=function(){console.log("initialize carousel module");var e=t.getModule("object"),i=t.getModule("focusable"),r=t.getModule("animator"),n=t.getModule("scene"),o=t.getModule("sys");return{"new":function(a,s,l){var u=i["new"](a,s,l),c={name:"coverflow",show:[],hide:[]};c.show.push({target:"position.x",startposition:1*t.screenWidth,endposition:0,func:r.linear}),c.show.push({target:"rotate.y",startposition:.8*Math.PI,endposition:0,func:r.linear}),c.show.push({target:"scale.x",startposition:.6,endposition:1,func:r.linear}),c.show.push({target:"scale.y",startposition:.6,endposition:1,func:r.linear}),c.hide.push({target:"position.x",startposition:0,endposition:1*-t.screenWidth,func:r.linear}),c.hide.push({target:"rotate.y",startposition:0,endposition:.8*-Math.PI,func:r.linear}),c.hide.push({target:"scale.x",startposition:1,endposition:.6,func:r.linear}),c.hide.push({target:"scale.y",startposition:1,endposition:.6,func:r.linear}),u.contentsize={width:u.size.width,height:u.size.height},u.inertia=5,u.swipespeed=t.screenWidth,u.movespeed=1,u.movethreshold=60,u.itemsize=t.screenWidth,u.transition=c,u.unload_distance=1,u.wrap=!1,u.bounceOnWrap=!1,u.alwaysmove=!1,u.nevermove=!1,u.selecteditem=1,u.moveToSelectedItem=!0;var h=u.add(e["new"]("carousel"));h.targetposition={x:0,y:0,z:0},h.pressOffset={x:0,y:0};var d=u.add(e["new"]("item container"));d.targetposition={x:0,y:0,z:0},u.instance=h,u.itemcontainer=d;var f=function(t,e,i){i>100&&(i=100);var r=1;t>e&&(r=-1);var n=-r*i/(16.66*u.inertia)*Math.abs(t-e);return Math.abs(n)<1e-4?t=e:t-=n,1==r&&t>e&&(t=e),-1==r&&e>t&&(t=e),t};return h.setMoving=function(t,e){null==n.getpointerStealer()&&1!=u.nevermove&&(n.stealPointers(u),null!=u.stolePointers&&u.stolePointers(t,e),h.moving=!0)},u.focus=function(e,i){h.moving&&(h.moving=!1,h.targetposition.x=h.position.x,h.targetposition.y=h.position.y),h.pressOffset={x:h.targetposition.x-e*u.movespeed/t.screenWidth*2,y:h.targetposition.y-i*u.movespeed},u.pressStarted={x:e,y:i}},u.focusdrag=function(e,i){var r=h.pressOffset.x+e*u.movespeed/t.screenWidth*2,n=h.pressOffset.y+i*u.movespeed/t.screenHeight*2,o=u.pressStarted.x-e,a=u.pressStarted.y-i;(u.alwaysmove||u.contentsize.width!=u.size.width)&&Math.abs(o)>u.movethreshold&&h.setMoving(o,a),h.moving&&(h.targetposition.x=r,h.targetposition.y=n)},u.defocus=function(){var t=Math.floor(-h.targetposition.x+.5);u.moveToSelectedItem&&(h.targetposition.x=-t),u.selecteditem=t,u.selecteditem<0&&(u.selecteditem=u.wrap?d.children.length+t:0),u.selecteditem>d.children.length-1&&(u.selecteditem=u.wrap?t-d.children.length:d.children.length-1),u.selecteditem=u.selecteditem+1,null!=u.carouselmoved&&u.carouselmoved(u.selecteditem)},u.postDraw=function(){if(u.wrap)for(var t=0;t<d.children.length;t++){var e=d.children[t],i=e.active,r=e.visible,n=e.itemposition;e.itemposition=n+d.children.length,e.stepTree(),e.drawTree(),e.itemposition=n-d.children.length,e.stepTree(),e.drawTree(),e.itemposition=n,e.step(0),e.visible=r,e.active=i}},u.selected=function(){return u.selecteditem},u.getItem=function(t){return d.children[t-1]},u.moveto=function(t,e){h.targetposition.x=-t,e&&(h.position.x=h.targetposition.x),u.selecteditem=t,null!=u.carouselmoved&&u.carouselmoved(t+1)},u.step=function(t){var e=-d.children.length+1,i=-d.children.length+1,r=.75,n=.75;0==u.wrap||u.bounceOnWrap&&h.position.x>e-r&&h.position.x<r?(u.bounceOnWrap&&(r=2*r,n=2*n),h.targetposition.x>r&&(h.targetposition.x=r),h.targetposition.y>n&&(h.targetposition.y=n),h.targetposition.x<e-r&&(h.targetposition.x=e-r),h.targetposition.y<i-n&&(h.targetposition.y=i-n),0==u.focused&&(h.targetposition.x>0&&(h.targetposition.x=f(h.targetposition.x,0,t/2)),h.targetposition.y>0&&(h.targetposition.y=f(h.targetposition.y,0,t/2)),h.targetposition.x<e&&(h.targetposition.x=f(h.targetposition.x,e,t/2)),h.targetposition.y<i&&(h.targetposition.y=f(h.targetposition.y,i,t/2)))):h.targetposition.x>1?(console.log("switch",h.position.x,h.targetposition.x,u.contentsize.width),h.targetposition.x=h.targetposition.x-d.children.length,h.position.x=h.position.x-d.children.length,h.pressOffset.x=h.pressOffset.x-d.children.length):h.targetposition.x<-d.children.length&&(console.log("+++switch2",h.position.x,h.targetposition.x),h.targetposition.x=h.targetposition.x+d.children.length,h.position.x=h.position.x+d.children.length,h.pressOffset.x=h.pressOffset.x+d.children.length);var o=t;o>100&&(o=1),0==u.focused&&(o=t/2),(u.alwaysmove||u.contentsize.width!=u.size.width)&&(h.position.x=f(h.position.x,h.targetposition.x,o)),(u.alwaysmove||u.contentsize.height!=u.size.height)&&(h.position.y=f(h.position.y,h.targetposition.y,o)),0==u.focused&&h.position.x==h.targetposition.x&&h.position.y==h.targetposition.y&&(h.moving=!1),h.moving},u.getDistance=function(){var e=(h.position.x*u.itemsize+this.itemposition*u.itemsize)/t.screenWidth;return e},u.setContentSize=function(){u.contentsize.width=u.itemsize*d.children.length},u.add=function(t,e){var e=d.children.length,r=i["new"]("carousel item container");return r.add(t),r.parent=d,d.children.push(r),d.drawTree=function(){function t(t,e){return Math.abs(t.dist)>Math.abs(e.dist)?-1:1}Math.min(o.timestamp()-this.lastdraw,60);if(this.lastdraw=o.timestamp(),0!=this.visible){if(this.update(),null!=this.preDraw&&this.preDraw(),null!=this.draw&&this.draw(),u.transition.order_draw){for(var e=[],i=0;i<this.children.length;i++)e.push(this.children[i]);e.sort(t);for(var i=0;i<e.length;i++)e[i].drawTree()}else if(this.reverseDrawOrder)for(var i=this.children.length-1;i>=0;i--)this.children[i].drawTree();else for(var i=0;i<this.children.length;i++)this.children[i].drawTree();null!=this.postDraw&&this.postDraw()}},t.carouselobject=r,r.index=e,r.child=t,r.itemposition=e,r.getDistance=u.getDistance,r.step=function(){var t=this.getDistance();if(this.dist=t,t<=-u.unload_distance||t>=u.unload_distance?null!=this.unload_content&&null!=this.content&&this.unload_content():null!=this.load_content&&null==this.content&&this.load_content(),this.active=!0,Math.abs(t)>.2&&(this.active=!1),this.visible=!0,Math.abs(t)>1&&(this.visible=!1),!(this.distance==t||Math.abs(t)>2)){this.distance=t;var e=u.transition;if(d.reverseDrawOrder=e.reverse_draw?!0:!1,t>=0)for(var i=0;i<e.show.length;i++){var r=e.show[i];"position.x"==r.target?this.position.x=r.func(r.startposition,r.endposition,Math.abs(1-t)):"position.y"==r.target?this.position.y=r.func(r.startposition,r.endposition,Math.abs(1-t)):"position.z"==r.target?this.position.z=r.func(r.startposition,r.endposition,Math.abs(1-t)):"scale.x"==r.target?this.scale.x=r.func(r.startposition,r.endposition,Math.abs(1-t)):"scale.y"==r.target?this.scale.y=r.func(r.startposition,r.endposition,Math.abs(1-t)):"rotate.x"==r.target?this.rotate.x=r.func(r.startposition,r.endposition,Math.abs(1-t)):"rotate.y"==r.target?this.rotate.y=r.func(r.startposition,r.endposition,Math.abs(1-t)):"rotate.z"==r.target?this.rotate.z=r.func(r.startposition,r.endposition,Math.abs(1-t)):"alpha"==r.target?this.alpha=r.func(r.startposition,r.endposition,Math.abs(1-t)):"transition_value"==r.target&&(this.transition_value=r.func(r.startposition,r.endposition,Math.abs(1-t)))}else for(var i=0;i<e.hide.length;i++){var n=e.hide[i];"position.x"==n.target?this.position.x=n.func(n.startposition,n.endposition,Math.abs(t)):"position.y"==n.target?this.position.y=n.func(n.startposition,n.endposition,Math.abs(t)):"position.z"==n.target?this.position.z=n.func(n.startposition,n.endposition,Math.abs(t)):"scale.x"==n.target?this.scale.x=n.func(n.startposition,n.endposition,Math.abs(t)):"scale.y"==n.target?this.scale.y=n.func(n.startposition,n.endposition,Math.abs(t)):"rotate.x"==n.target?this.rotate.x=n.func(n.startposition,n.endposition,Math.abs(t)):"rotate.y"==n.target?this.rotate.y=n.func(n.startposition,n.endposition,Math.abs(t)):"rotate.z"==n.target?this.rotate.z=n.func(n.startposition,n.endposition,Math.abs(t)):"alpha"==n.target?this.alpha=n.func(n.startposition,n.endposition,Math.abs(t)):"transition_value"==n.target&&(this.transition_value=n.func(n.startposition,n.endposition,Math.abs(t)))}}},d.itemaddposition=d.itemaddposition+1,u.setContentSize(),r},u}}}();t.module("carousel",e)}(),function(){var t=document.currentScript.curlify,e=t.getModule("animator"),i=t.getModule("carousel"),r=function(){return{"new":function(r,n,o){var a={name:"move in",show:[],hide:[]};a.show.push({target:"position.y",startposition:t.screenHeight,endposition:0,func:e.outQuad}),a.show.push({target:"alpha",startposition:0,endposition:1,func:e.outExpo}),a.hide.push({target:"position.y",startposition:0,endposition:0,func:e.linear}),a.hide.push({target:"alpha",startposition:1,endposition:0,func:e.inExpo});var s=i["new"](r,n,o);return s.itemsize=t.screenHeight,s.transition=a,s.getDistance=function(){var e=(s.instance.position.y*s.itemsize+this.itemposition*s.itemsize)/t.screenHeight;return e},s.setContentSize=function(){s.contentsize.height=s.itemsize*s.itemcontainer.children.length},s.focus=function(e,i){s.instance.moving&&(s.instance.moving=!1,s.instance.targetposition.x=s.instance.position.x,s.instance.targetposition.y=s.instance.position.y),s.instance.pressOffset={x:s.instance.targetposition.x-e*s.movespeed/t.screenWidth*2,y:s.instance.targetposition.y-i*s.movespeed/t.screenHeight*2},s.pressStarted={x:e,y:i}},s.focusdrag=function(e,i){var r=s.instance.pressOffset.x+e*s.movespeed/t.screenWidth*2,n=s.instance.pressOffset.y+i*s.movespeed/t.screenHeight*2,o=s.pressStarted.x-e,a=s.pressStarted.y-i;(s.alwaysmove||s.contentsize.height!=s.size.height)&&Math.abs(a)>s.movethreshold&&s.instance.setMoving(o,a),s.instance.moving&&(s.instance.targetposition.x=r,s.instance.targetposition.y=n)},s.defocus=function(){var t=Math.floor(-s.instance.targetposition.y+.5);s.moveToSelectedItem&&(s.instance.targetposition.y=-t),s.selecteditem=t,s.selecteditem<0&&(s.selecteditem=s.wrap?s.itemcontainer.children.length+t:0),s.selecteditem>s.itemcontainer.children.length-1&&(s.selecteditem=s.wrap?t-s.itemcontainer.children.length:s.itemcontainer.children.length-1),s.selecteditem=s.selecteditem+1,null!=s.carouselmoved&&s.carouselmoved(s.selecteditem)},s.moveto=function(t,e){s.instance.targetposition.y=-t,e&&(s.instance.position.y=s.instance.targetposition.y),s.selecteditem=t,null!=s.carouselmoved&&s.carouselmoved(t)},s}}}();t.module("carousel_vertical",r)}(),function(){var t=document.currentScript.curlify,e=t.getModule("scene"),i=t.getModule("animator"),r=t.getModule("object"),n=t.getModule("focusable"),o=function(){return{"new":function(o,a,s){var l=n["new"](o,a,s);l.contentsize={width:l.size.width,height:l.size.height},l.movespeed=1,l.movethreshold=40,l.swipespeed=(t.screenWidth+t.screenHeight)/2*5,l.maxspeed=200,l.inertia=7,l.zeroposition=0,l.loaddistance=t.screenHeight,l.visibledistance=l.loaddistance,l.itempad=0,l.centerslots=!1,l.swipefunc=i.inQuad;var u=l.add(r["new"]("scrollable"));l.instance=u,u.targetposition={x:0,y:0,z:0};var c=function(t,e,i){i>100&&(i=100);var r=1;t>e&&(r=-1);var n=-r*(i/(16.66*l.inertia))*Math.abs(t-e),o=i/16.66*l.maxspeed;return n>o&&(n=o),-o>n&&(n=-o),Math.abs(n)<1e-5?t=e:t-=n,1==r&&t>e&&(t=e),-1==r&&e>t&&(t=e),t};l.focus=function(t,e){u.pressOffset={x:u.position.x-t*l.movespeed,y:u.position.y-e*l.movespeed},u.moving&&(u.resetpress(),u.moving=!1)},l.defocus=function(){e.getpointerStealer()==l&&l.centeronslots(),console.log("DEFOCUS",l.identifier,u.position.y,u.targetposition.y)},l.centeronslots=function(){if(l.centerslots){var e=Math.floor(l.selected()/(t.screenWidth+l.itempad));l.movetox(e*(t.screenWidth+l.itempad)+t.screenWidth/2)}},u.setMoving=function(){0==u.moving&&null==e.getpointerStealer()&&(e.stealPointers(l),u.moving=!0)},l.focusdrag=function(t,e){var i=u.pressOffset.x+t*l.movespeed,r=u.pressOffset.y+e*l.movespeed,n=i-u.targetposition.x,o=r-u.targetposition.y;l.contentsize.width!=l.size.width&&Math.abs(n)>l.movethreshold&&u.setMoving(),l.contentsize.height!=l.size.height&&Math.abs(o)>l.movethreshold&&u.setMoving(),u.moving&&(u.targetposition.x=i,u.targetposition.y=r)},l.step=function(t){var e=-(l.contentsize.width-l.size.width)+l.zeroposition,i=-(l.contentsize.height-l.size.height),r=t;r>66&&(r=66),0!=l.enforcelimits&&(u.targetposition.x>l.size.width/4+l.zeroposition&&(u.targetposition.x=l.size.width/4+l.zeroposition),u.targetposition.y>l.size.height/4&&(u.targetposition.y=l.size.height/4),u.targetposition.x<e-l.size.width/4&&(u.targetposition.x=e-l.size.width/4),u.targetposition.y<i-l.size.height/4&&(u.targetposition.y=i-l.size.height/4),0==l.focused&&(u.targetposition.x>l.zeroposition&&(u.targetposition.x=c(u.targetposition.x,l.zeroposition,t/2)),u.targetposition.y>0&&(u.targetposition.y=c(u.targetposition.y,0,t/2)),u.targetposition.x<e&&(u.targetposition.x=c(u.targetposition.x,e,t/2)),u.targetposition.y<i&&(u.targetposition.y=c(u.targetposition.y,i,t/2)))),0==l.focused&&(r/=2),l.contentsize.width!=l.size.width&&(u.position.x=c(u.position.x,u.targetposition.x,r)),l.contentsize.height!=l.size.height&&(u.position.y=c(u.position.y,u.targetposition.y,r)),0==l.focused&&u.position.x==u.targetposition.x&&u.position.y==u.targetposition.y&&(u.moving=!1)},l.selected=function(){return Math.floor(u.targetposition.x)},l.movetox=function(t,e){e&&(u.position.x=t),u.targetposition.x=t},l.movetoy=function(t,e){e&&(u.position.y=t),u.targetposition.y=t},l.prepare=function(){l.step(0);for(var t=0;t<u.children.length;t++)u.children[t].step(0)};var h=4*t.screenWidth,d=4*t.screenHeight,f=-h,g=h,m=-d,p=d;return l.intersectsScreen=function(t){var e=t.absolutex(),i=t.absolutey(),r=e-t.width()/2,n=e+t.width()/2,o=i-t.height()/2,a=i+t.height()/2;return!(f>n||r>g||m>a||o>p)},l.add=function(t,e){e?e:u.children.length;return t.parent=u,u.children.push(t),t.step=function(){this.xdistance=this.absolutex();var t=Math.sqrt(Math.pow(this.xdistance,2)+Math.pow(this.absolutey(),2));if(t<l.loaddistance)null!=this.load_content&&0==this.loaded&&this.load_content();else{var e=l.unloaddistance;null==e&&(e=l.loaddistance),t>e&&null!=this.load_content&&null!=this.unload_content&&this.loaded&&this.unload_content()}this.visible=t<l.visibledistance?!0:!1,this.distance=t},t},l}}}();t.module("scrollable",o)}(),function(){function initWebGL(t){curlify.gl=null;try{curlify.gl=t.getContext("webgl")||t.getContext("experimental-webgl")}catch(e){}return curlify.gl||(alert("Unable to initialize WebGL. Your browser may not support it."),curlify.gl=null),curlify.gl}function mousedown(t){if(!scene.isAnimating()&&1!=touch){console.log("mousedown : "+t.clientX+","+t.clientY,curlify.layoutOffset.x,curlify.layoutOffset.y);var e=t.currentTarget.getBoundingClientRect();touch=!0;var i=scene.getPointerUser();null!=i&&(i.press((t.clientX-e.left-curlify.layoutOffset.x)*curlify.layoutScale.x,(t.clientY-e.top-curlify.layoutOffset.y)*curlify.layoutScale.y),i.drag((t.clientX-e.left-curlify.layoutOffset.x)*curlify.layoutScale.x,(t.clientY-e.top-curlify.layoutOffset.y)*curlify.layoutScale.y))}}function mouseup(t){if(scene.resetPointerStealer(),!scene.isAnimating()&&0!=touch){console.log("mouseup : "+t.clientX+","+t.clientY);var e=t.currentTarget.getBoundingClientRect();touch=!1;var i=scene.getPointerUser();null!=i&&i.release((t.clientX-e.left-curlify.layoutOffset.x)*curlify.layoutScale.x,(t.clientY-e.top-curlify.layoutOffset.y)*curlify.layoutScale.y)}}function mouseout(t){touch&&mouseup(t)}function mousemove(t){if(!scene.isAnimating()&&0!=touch){var e=t.currentTarget.getBoundingClientRect(),i=scene.getPointerUser();null!=i&&touch&&i.drag((t.clientX-e.left-curlify.layoutOffset.x)*curlify.layoutScale.x,(t.clientY-e.top-curlify.layoutOffset.y)*curlify.layoutScale.y)}}function touchstart(t){if(!scene.isAnimating()&&1!=touch){var e=t.currentTarget.getBoundingClientRect();touch=!0;var i=scene.getPointerUser();null!=i&&(i.press((t.touches[0].pageX-e.left-curlify.layoutOffset.x)*curlify.layoutScale.x,(t.touches[0].pageY-e.top-curlify.layoutOffset.y)*curlify.layoutScale.y),i.drag((t.touches[0].pageX-e.left-curlify.layoutOffset.x)*curlify.layoutScale.x,(t.touches[0].pageY-e.top-curlify.layoutOffset.y)*curlify.layoutScale.y),lasttouch=t)}}function touchend(t){if(scene.resetPointerStealer(),!scene.isAnimating()&&0!=touch){var e=t.currentTarget.getBoundingClientRect();touch=!1;var i=scene.getPointerUser();null!=i&&i.release(lasttouch.touches[0].pageX-e.left-curlify.layoutOffset.x,lasttouch.touches[0].pageY-e.top-curlify.layoutOffset.y)}}function touchmove(t){if(t.preventDefault(),!scene.isAnimating()&&0!=touch){var e=t.currentTarget.getBoundingClientRect(),i=scene.getPointerUser();null!=i&&(touch&&i.drag((t.touches[0].pageX-e.left-curlify.layoutOffset.x)*curlify.layoutScale.x,(t.touches[0].pageY-e.top-curlify.layoutOffset.y)*curlify.layoutScale.y),lasttouch=t)}}function deviceMotionHandler(t){curlify.sensors.acceleration=t.acceleration,curlify.sensors.rotation=t.rotationRate}function deviceOrientationHandler(t){curlify.sensors.orientation=t}function orientationChanged(){console.log("ORIENTATION CHANGED")}function resizeCanvas(){var t=glcanvas.clientWidth,e=glcanvas.clientHeight;if(glcanvas.width!=t||glcanvas.height!=e){curlify.layoutWidth=t,curlify.layoutHeight=e,curlify.layoutScale={x:curlify.screenWidth/curlify.layoutWidth,y:curlify.screenHeight/curlify.layoutHeight},curlify.viewWidth=curlify.screenWidth,curlify.viewHeight=curlify.screenHeight;var i=Math.max(curlify.layoutScale.x,curlify.layoutScale.y);aspectratioZoom&&(i=Math.min(curlify.layoutScale.x,curlify.layoutScale.y),curlify.viewWidth=t*i,curlify.viewHeight=e*i),curlify.layoutScale.x=i,curlify.layoutScale.y=i,curlify.layoutWidth=Math.floor(curlify.screenWidth*(1/i)),curlify.layoutHeight=Math.floor(curlify.screenHeight*(1/i)),curlify.layoutOffset.x=(t-curlify.layoutWidth)/2,curlify.layoutOffset.y=(e-curlify.layoutHeight)/2,glcanvas.width=glcanvas.clientWidth,glcanvas.height=glcanvas.clientHeight}}function mergeRecursive(t,e){for(var i in e)try{t[i]=e[i].constructor==Object?mergeRecursive(t[i],e[i]):e[i]}catch(r){t[i]=e[i]}return t}console.log("inititalize main");var curlify=document.currentScript.curlify,revision="3",scene=curlify.getModule("scene"),glcanvas,aspectratioZoom=!0,touch=!1,lasttouch=null,imageid=0,running=!1,appendedElements=[];curlify.sensors={acceleration:null,rotation:null,orientation:null},curlify.zipfile=null,curlify.layoutWidth=null,curlify.layoutHeight=null,curlify.layoutOffset={x:0,y:0},curlify.layoutScale={x:1,y:1},curlify.gl=null,curlify.camera=null,curlify.viewWidth=null,curlify.viewHeight=null,curlify.screenWidth=null,curlify.screenHeight=null;var createProjection=function(t,e,i,r){var n=mat4.create();return n[0]=i/t,n[5]=i/e,n[10]=-(r+i)/(r-i),n[11]=-1,n[14]=-2*r*i/(r-i),n},createProjectionAndView=function(t,e,i,r){var n=createProjection(1,e/t,i,r),o=mat4.identity(mat4.create());mat4.translate(o,o,vec3.clone([0,0,-(r-i)/2]));var a=(r-i)/2/i,s={near:i,far:r,width:t,height:e,projectionMatrix:n,viewMatrix:o,translateScale:a};return s};curlify.assert=function(t,e){if(!t)throw e||"Assertion failed"},curlify.spawn=function(t){return function(){function e(t,e){var o;try{o=i[t](e)}catch(a){return Promise.reject(a)}return o.done?o.value:Promise.resolve(o.value).then(r,n)}var i=t.apply(this,arguments),r=e.bind(e,"next"),n=e.bind(e,"throw");return r()}},curlify.require=function(script){var module=curlify.getModule(script);return null!=module?module:new Promise(function(resolve,reject){var scriptid=script,element=document.getElementById(scriptid);if(null==element)if(".zip"==script.slice(-4))JSZipUtils.getBinaryContent(script,function(err,data){if(err)return void reject(Error("require zip load failed for '"+script+"' with '"+err+"'"));curlify.zipfile=new JSZip(data);var adscriptfile=curlify.zipfile.file("main.js");if(null==adscriptfile)return curlify.zipfile=null,void reject(Error("require failed for '"+script+"' with 'main.js not found inside zip'"));var scriptobject=null;try{scriptobject=eval(adscriptfile.asText())}catch(e){return curlify.zipfile=null,void reject(Error("require eval failed for zip '"+script+"' with '"+e+"'"))}resolve(scriptobject)});else{if(".js"!=script.slice(-3))return void reject(Error("require failed for '"+script+"' with 'unsupported source'"));element=document.createElement("script"),element.setAttribute("id",scriptid),element.setAttribute("type","script-container"),document.head.appendChild(element),appendedElements.push(scriptid),curlify.createCORSRequest("GET",script).then(function(response){try{element.scriptobject=eval(response)}catch(e){return void reject(Error("require eval failed for '"+script+"' with '"+e+"'"))}resolve(element.scriptobject)},function(t){reject(Error("require load failed for '"+script+"' with '"+t+"'"))})}else resolve(element.scriptobject)})},curlify.addImageElement=function(){var t="curlify_image_"+imageid,e=document.createElement("img");return e.setAttribute("id",t),document.body.appendChild(e),appendedElements.push(t),imageid+=1,e},curlify.createCORSRequest=function(t,e){return new Promise(function(i,r){var n=new XMLHttpRequest;if("withCredentials"in n)n.open(t,e,!0);else{if("undefined"==typeof XDomainRequest)return n=null,void r(Error("createCORSRequest failed with 'XMLHttpRequest not supported'"));n=new XDomainRequest,n.open(t,e)}n.onload=function(){200==n.status?i(n.response):r(Error("cors request failed with '"+n.statusText+"'"))},n.onerror=function(){r(Error("cors request failed with 'Network Error'"))},n.send()})},curlify.getRandom=function(t,e){return Math.floor(Math.random()*(e-t)+t)},curlify.render=function(){var t=curlify.gl;t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.disable(t.DEPTH_TEST),t.enable(t.CULL_FACE),t.cullFace(t.FRONT),t.viewport(curlify.layoutOffset.x,curlify.layoutOffset.y,curlify.layoutWidth,curlify.layoutHeight),scene.render()},curlify.setRenderInterval=function(t){null!=curlify.intervalId&&window.clearInterval(curlify.intervalId),curlify.intervalId=window.setInterval(curlify.render,t)},curlify.stop=function(){if(console.log("Cleaning up..."),null==glcanvas)return void console.log("ERROR: canvas not set");"ontouchstart"in window?(glcanvas.removeEventListener("touchstart",touchstart,!1),glcanvas.removeEventListener("touchmove",touchmove,!1),glcanvas.removeEventListener("touchend",touchend,!1)):(glcanvas.removeEventListener("mousedown",mousedown,!1),glcanvas.removeEventListener("mousemove",mousemove,!1),glcanvas.removeEventListener("mouseup",mouseup,!1)),window.DeviceMotionEvent&&window.removeEventListener("devicemotion",deviceMotionHandler,!1),window.DeviceOrientationEvent&&window.removeEventListener("deviceorientation",deviceOrientationHandler,!1),window.removeEventListener("orientationchange",orientationChanged),scene.removeAllScenes();for(var t=0;t<appendedElements.length;t++){var e=appendedElements[t],i=document.getElementById(e);i.parentNode.removeChild(i),console.log("... removed element "+e)}appendedElements=[],null!=curlify.intervalId&&(console.log("... stopping render interval"),window.clearInterval(curlify.intervalId)),curlify.clearModuleBuffersAndPrograms(),running=!1},curlify.start=function(t){console.log("curlify.start - revision",revision),running&&curlify.stop(),running=!0,curlify.assert(null!=t.canvas),curlify.assert(null!=t.script);var e=t.canvas,i=t.script,r=t.width,n=t.height;curlify.screenWidth=r?r:480,curlify.screenHeight=n?n:852,glcanvas=document.getElementById(e),curlify.gl=initWebGL(glcanvas),"ontouchstart"in window?(glcanvas.addEventListener("touchstart",touchstart,!1),glcanvas.addEventListener("touchmove",touchmove,!1),glcanvas.addEventListener("touchend",touchend,!1)):(glcanvas.addEventListener("mousedown",mousedown,!1),glcanvas.addEventListener("mousemove",mousemove,!1),glcanvas.addEventListener("mouseup",mouseup,!1)),resizeCanvas(),curlify.camera=createProjectionAndView(curlify.screenWidth,curlify.screenHeight,3,100),curlify.gl&&(window.DeviceMotionEvent?window.addEventListener("devicemotion",deviceMotionHandler,!1):alert("DeviceMotionEvent not supported"),window.DeviceOrientationEvent?window.addEventListener("deviceorientation",deviceOrientationHandler,!1):alert("DeviceOrientationEvent not supported"),window.addEventListener("orientationchange",orientationChanged),curlify.require(i).then(function(e){scene.openScene(e["new"]()),null!=t.renderInterval&&curlify.setRenderInterval(t.renderInterval)}))}}();