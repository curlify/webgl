var curlify=function(){console.log("initialize curlify");var t={};return{module:function(e,i){null!=t[e]&&console.log("WARNING: overwriting module",e),null==i&&console.log("ERROR: setting null code as module '"+e+"'"),t[e]=i},getModule:function(e){return t[e]},clearModuleBuffersAndPrograms:function(){console.log("clearModuleBuffersAndPrograms()");for(var e in t){var i=t[e];console.log("checking",i.id),null!=i.default_program&&(console.log("clearing module program",i.id),i.default_program.glProgram=null),null!=i.buffer&&(console.log("clearing module buffer",i.id),i.buffer=null)}}}}();!function(){var t=function(){console.log("initialize glutils module");var t=function(t){window.console&&(window.console.error?window.console.error(t):window.console.log&&window.console.log(t))},e=function(e,i,r,n){var o=n||t,a=e.createShader(r);e.shaderSource(a,i),e.compileShader(a);var s=e.getShaderParameter(a,e.COMPILE_STATUS);return s?a:(lastError=e.getShaderInfoLog(a),o("*** Error compiling shader '"+a+"':"+lastError),e.deleteShader(a),null)};return{loadProgram:function(e,i,r,n){for(var o={},a=e.createProgram(),s=0;s<i.length;++s)e.attachShader(a,i[s]);e.linkProgram(a);var l=e.getProgramParameter(a,e.LINK_STATUS);if(!l)return lastError=e.getProgramInfoLog(a),t("Error in program linking:"+lastError),e.deleteProgram(a),null;if(r)for(var s=0;s<r.length;++s){var u=r[s]+"_handle";o[u]=e.getAttribLocation(a,r[s])}if(n)for(var s=0;s<n.length;++s){var u=n[s]+"_handle";o[u]=e.getUniformLocation(a,n[s])}return o.program=a,o},createShader:function(t,i,r,n){var o,a=i.text;if(!r)if("x-shader/x-vertex"==i.type)o=t.VERTEX_SHADER;else if("x-shader/x-fragment"==i.type)o=t.FRAGMENT_SHADER;else if(o!=t.VERTEX_SHADER&&o!=t.FRAGMENT_SHADER)throw"*** Error: unknown shader type";return e(t,a,r?r:o,n)}}}();curlify.module("glutils",t)}(),function(){var t=function(){return console.log("initialize sys module"),{timestamp:function(){return(new Date).getTime()},ismobile:{Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return t.ismobile.Android()||t.ismobile.BlackBerry()||t.ismobile.iOS()||t.ismobile.Opera()||t.ismobile.Windows()}}}}();curlify.module("sys",t)}(),function(){var t=function(){console.log("initialize fps module");var t=curlify.getModule("sys"),e=0,i=0;return{updateFps:function(){if(100==e){e=0;var r=t.timestamp(),n=1e5/(r-i);console.log("FPS : "+n),i=r}e+=1}}}();curlify.module("fps",t)}(),function(){var t=function(){console.log("initialize animator module");var e=curlify.getModule("sys"),r={time:!0,ease:!0,start:!0,onComplete:!0};return{"new":function(){return{animations:[],animate:function(i,n){null==n.ease&&(n.ease=t.linear),null==n.start&&(n.start=0);var o={};for(var a in n){{n[a]}null==r[a]&&(curlify.assert(null!=i[a],"Animated property cannot be initially nil : "+a),o[a]=i[a])}this.animations.push({target:i,start:e.timestamp()+n.start,deadline:e.timestamp()+n.start+n.time,config:n,init:o})},step:function(){var t=[],r=e.timestamp();for(var n in this.animations){var o=this.animations[n],a=(o.deadline,0);1==o.paused&&(r=o.pausetimestamp),r<o.deadline?a=1-(o.deadline-r)/o.config.time:r<o.start?a=0:(a=1,t.push(n)),a=Math.max(a,1e-5);for(var n in o.init)initial=o.init[n],o.target[n]=o.config.ease(initial,o.config[n],a)}for(i=t.length-1;i>=0;i--){var s=this.animations[t[i]].config.onComplete;this.animations.splice(t[i],1),null!=s&&s()}},pause:function(){for(var t in this.animations)this.animations[t].paused=!0,this.animations[t].pausetimestamp=e.timestamp()},resume:function(){for(var t in this.animations)this.animations[t].paused=!1,this.animations[t].deadline=this.animations[t].deadline+(e.timestamp()-self.animations[t].pausetimestamp)},stop:function(){for(var t in this.animations)this.animations[t].init={},this.animations[t].config.onComplete=null;this.animations=[]}}}}}();t.linear=function(t,e,i){return t+(e-t)*i},t.inQuad=function(t,e,i){return t+(e-t)*i*i},t.outQuad=function(t,e,i){return t+-(e-t)*i*(i-2)},t.inOutQuad=function(t,e,i){return.5>i?(i=2*i,t+(e-t)/2*i*i):(i=2*(i-.5),t-(e-t)/2*(i*(i-2)-1))},t.inCubic=function(t,e,i){return t+(e-t)*i*i*i},t.outCubic=function(t,e,i){return i-=1,t+(e-t)*(i*i*i+1)},t.inOutCubic=function(t,e,i){return.5>i?(i=2*i,t+(e-t)/2*i*i*i):(i=2*(i-.5)-1,t+(e-t)/2*(i*i*i+2))},t.inQuart=function(t,e,i){return t+(e-t)*i*i*i*i},t.outQuart=function(t,e,i){return i-=1,t-(e-t)*(i*i*i*i-1)},t.inOutQuart=function(t,e,i){return.5>i?(i=2*i,t+(e-t)/2*i*i*i*i):(i=2*(i-.5)-1,t-(e-t)/2*(i*i*i*i-2))},t.inSine=function(t,e,i){return t+(e-t)*(1-Math.cos(i*Math.pi/2))},t.outSine=function(t,e,i){return t+(e-t)*Math.sin(i*Math.pi/2)},t.inOutSine=function(t,e,i){return t-(e-t)/2*(Math.cos(Math.pi*i)-1)},t.inExpo=function(t,e,i){return i-=1,t+(e-t)*Math.pow(2,10*i)},t.outExpo=function(t,e,i){return t+(e-t)*(1-Math.pow(2,-10*i))},t.inOutExpo=function(t,e,i){return.5>i?(i=2*i-1,t+(e-t)/2*Math.pow(2,10*i)):(i=2*(i-.5),t+(e-t)/2*(2-Math.pow(2,-10*i)))},t.inCirc=function(t,e,i){return t+(e-t)*(1-Math.sqrt(1-i*i))},t.outCirc=function(t,e,i){return i-=1,t+(e-t)*Math.sqrt(1-i*i)},t.inOutCirc=function(t,e,i){return.5>i?(i=2*i,t+(e-t)/2*(1-Math.sqrt(1-i*i))):(i=2*(i-.5)-1,t+(e-t)/2*(1+Math.sqrt(1-i*i)))},t.inElastic=function(t,e,i){return i-=1,t-(e-t)*Math.pow(2,10*i)*Math.sin(6*(i-.0777777)*Math.pi)},t.outElastic=function(t,e,i){return t+(e-t)*(Math.pow(2,-10*i)*Math.sin(6*(i-.0777777)*Math.pi)+1)},curlify.module("animator",t)}(),function(){var t=function(){console.log("initialize scene module");var t=curlify.getModule("animator"),e=[],i=[],r=t["new"](),n=null;return{render:function(){if(r.step(),r.animations.length>0){var t=e[e.length-2];t.stepTree(),t.drawTree()}var n=e[e.length-1];if(null!=n){n.stepTree(),n.drawTree();for(var o=0;o<i.length;o++)!new function(){var t=i[o];t.renderFbo()};i=[]}},openScene:function(t,i,n){var o=e[e.length-1];e.push(t),null!=i&&r.animate(t,i),null!=o&&null!=n&&r.animate(o,n)},closeScene:function(t,i){var n=e[e.length-1],o=e[e.length-2];if(null!=t){var a=t.onComplete,s=function(){null!=a&&a(),e.splice(e.length-1,1),console.log("remove scene from stack",n.identifier,e.length)};t.onComplete=s,r.animate(n,t)}else e.splice(e.length-1,1);null!=o&&null!=i&&r.animate(o,i)},removeAllScenes:function(){e=[],i=[],r.stop(),n=null},isAnimating:function(){return r.animations.length>0?!0:!1},getPointerUser:function(){return n?n:e[e.length-1]},getpointerStealer:function(){return n},stealPointers:function(t){console.log("stealPointers",t);var i=n?n:e[e.length-1];n=t,i.resetpress()},resetPointerStealer:function(){n=null},addFboUpdate:function(t){i.push(t)}}}();curlify.module("scene",t)}(),function(){var t=function(){console.log("initialize object module");var t=curlify.getModule("scene"),e=curlify.getModule("animator"),i=curlify.getModule("sys");return{"new":function(r,n,o){var a=curlify.gl;return{identifier:null==r?"object identifier":r,position:{x:0,y:0,z:0},rotate:{x:0,y:0,z:0},scale:{x:1,y:1,z:1},size:{width:null==n?curlify.screenWidth:n,height:null==o?curlify.screenHeight:o},children:[],active:!0,visible:!0,alpha:1,blend:!0,drawbackside:!1,depthtest:!1,projectionMatrix:curlify.camera.projectionMatrix,viewMatrix:curlify.camera.viewMatrix,modelMatrix:mat4.identity(mat4.create()),modelViewMatrix:mat4.identity(mat4.create()),translateScale:curlify.camera.translateScale,identityMatrix:mat4.identity(mat4.create()),anim:e["new"](),timervalue:0,lastdraw:0,laststep:0,add:function(t){return t.parent=this,this.children.push(t),t},updateModelMatrix:function(){var t=this.modelMatrix;if(mat4.copy(t,this.identityMatrix),0!=this.position.x||0!=this.position.y||0!=this.position.z){var e=curlify.screenWidth/(2*this.translateScale);mat4.translate(t,t,vec3.clone([this.position.x/e,-this.position.y/e,this.position.z/e]))}0!=this.rotate.z&&mat4.rotateZ(t,t,-this.rotate.z),0!=this.rotate.y&&mat4.rotateY(t,t,-this.rotate.y),0!=this.rotate.x&&mat4.rotateX(t,t,-this.rotate.x),(1!=this.scale.x||1!=this.scale.y||1!=this.scale.z)&&mat4.scale(t,t,vec3.clone([this.scale.x,this.scale.y,this.scale.z])),this.modelMatrix=t},update:function(){var t=this.viewMatrix;null!=this.parent&&null!=this.parent.modelViewMatrix&&(t=this.parent.modelViewMatrix),this.viewMatrix=t,this.updateModelMatrix(),this.children.length>0&&(mat4.copy(this.modelViewMatrix,this.viewMatrix),mat4.multiply(this.modelViewMatrix,this.modelViewMatrix,this.modelMatrix)),this.depthtest?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),0==this.blend?a.disable(a.BLEND):(a.enable(a.BLEND),a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA)),1==this.drawbackside?a.disable(a.CULL_FACE):(a.enable(a.CULL_FACE),a.cullFace(a.FRONT))},stepTree:function(){var t=Math.max(1,Math.min(i.timestamp()-this.laststep,60));this.laststep=i.timestamp(),this.anim.step(),null!=this.preStep&&this.preStep(),null!=this.step&&this.step(t);for(var e=0;e<this.children.length;e++)this.children[e].stepTree();null!=this.postStep&&this.postStep()},drawTree:function(){Math.min(i.timestamp()-this.lastdraw,60);if(this.lastdraw=i.timestamp(),0!=this.visible){if(this.update(),null!=this.preDraw&&this.preDraw(),null!=this.draw&&this.draw(),this.reverseDrawOrder)for(var t=this.children.length-1;t>=0;t--)this.children[t].drawTree();else for(var t=0;t<this.children.length;t++)this.children[t].drawTree();null!=this.postDraw&&this.postDraw()}},press:function(t,e){var i=!1;if(null!=this.relativePress){var r=t-curlify.screenWidth/2-this.absolutex(),n=e-curlify.screenHeight/2-this.absolutey();i=this.relativePress(r,n)}null!=this.absolutePress&&(i=this.absolutePress(t,e));for(var o=this.children.length-1;o>=0;o--)this.children[o].active&&(i=this.children[o].press(t,e));return i},drag:function(t,e){var i=!1;if(null!=this.relativeDrag){var r=t-curlify.screenWidth/2-this.absolutex(),n=e-curlify.screenHeight/2-this.absolutey();i=this.relativeDrag(r,n)}null!=this.absoluteDrag&&(i=this.absoluteDrag(t,e));for(var o=this.children.length-1;o>=0;o--)this.children[o].active&&(i=this.children[o].drag(t,e));return i},release:function(t,e){var i=!1;if(null!=this.relativeRelease){var r=t-curlify.screenWidth/2-this.absolutex(),n=e-curlify.screenHeight/2-this.absolutey();i=this.relativeRelease(r,n)}null!=this.absoluteRelease&&(i=this.absoluteRelease(t,e));for(var o=this.children.length-1;o>=0;o--)this.children[o].active&&(i=this.children[o].release(t,e));return i},resetpress:function(){if(1==this.active){for(var e=this.children.length-1;e>=0;e--)this.children[e].resetpress();this!=t.getpointerStealer()&&null!=this.pointerReset&&this.pointerReset()}},x:function(){return this.position.x},y:function(){return this.position.y},width:function(){return this.size.width*this.scale.x},height:function(){return this.size.height*this.scale.y},top:function(){return this.position.y-this.height()/2},bottom:function(){return this.position.y+this.height()/2},left:function(){return this.position.x-this.width()/2},right:function(){return this.position.x+this.width()/2},absolutex:function(){var t=0;return null!=this.parent&&(t=this.parent.absolutex()),t+this.x()},absolutey:function(){var t=0;return null!=this.parent&&(t=this.parent.absolutey()),t+this.y()},absolutescalex:function(){var t=1;return null!=this.parent&&(t=this.parent.absolutescalex()),t*this.scale.x},absolutescaley:function(){var t=1;return null!=this.parent&&(t=this.parent.absolutescaley()),t*this.scale.y},absolutealpha:function(){var t=1;return null!=this.parent&&(t=this.parent.absolutealpha()),t*this.alpha},activate:function(){this.active=!0,null!=this.postActivate&&this.postActivate()},deactivate:function(){this.active=!1,null!=this.postDeactivate&&this.postDeactivate()}}}}}();curlify.module("object",t)}(),function(){var t=function(){console.log("initialize quad module");var e=curlify.getModule("glutils"),i=curlify.getModule("object");return{buffer:null,default_program:{glProgram:null,getProgram:function(){return null==this.glProgram&&this.loadProgram(),this.glProgram},loadProgram:function(){var t={text:"              attribute vec2 a_position;              attribute vec2 a_tex_coordinate;                            uniform mat4 u_projection;              uniform mat4 u_view;              uniform mat4 u_model;                            varying vec2 v_tex_coord;                            void main() {                gl_Position = u_projection*u_view*u_model*vec4(a_position, 0.0, 1.0);                v_tex_coord = a_tex_coordinate;              }            ",type:"x-shader/x-vertex"},i={text:"              precision mediump float;                            varying vec2      v_tex_coord;                            uniform sampler2D u_texture;              uniform float     u_alpha;                            void main() {                vec4 color = texture2D(u_texture, v_tex_coord);                gl_FragColor = color * u_alpha;              }            ",type:"x-shader/x-fragment"},r=e.createShader(curlify.gl,t),n=e.createShader(curlify.gl,i);this.glProgram=e.loadProgram(curlify.gl,[r,n],["a_position","a_tex_coordinate"],["u_texture","u_alpha","u_model","u_view","u_projection"])}},"new":function(e,r,n){var o=curlify.gl;null==this.buffer&&(this.buffer=curlify.gl.createBuffer(),this.buffer.itemSize=2,this.buffer.numItems=4,o.bindBuffer(o.ARRAY_BUFFER,this.buffer),vertices=[-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1],o.bufferData(o.ARRAY_BUFFER,new Float32Array(vertices),o.STATIC_DRAW));var a=i["new"](e,r,n);return a.glProgram=this.default_program.getProgram(),a.quadModelMatrix=mat4.identity(mat4.create()),a.updateModelMatrix=function(){var t=this.modelMatrix;if(mat4.copy(t,this.identityMatrix),0!=this.position.x||0!=this.position.y||0!=this.position.z){var e=curlify.screenWidth/(2*this.translateScale);mat4.translate(t,t,vec3.clone([this.position.x/e,-this.position.y/e,this.position.z/e]))}0!=this.rotate.z&&mat4.rotateZ(t,t,-this.rotate.z),0!=this.rotate.y&&mat4.rotateY(t,t,-this.rotate.y),0!=this.rotate.x&&mat4.rotateX(t,t,-this.rotate.x),(1!=this.scale.x||1!=this.scale.y||1!=this.scale.z)&&mat4.scale(t,t,vec3.clone([this.scale.x,this.scale.y,this.scale.z])),this.modelMatrix=t,mat4.copy(this.quadModelMatrix,this.modelMatrix);var i=curlify.screenWidth/this.translateScale;mat4.scale(this.quadModelMatrix,this.quadModelMatrix,vec3.clone([this.size.width/i,-this.size.height/i,1]))},a.draw=function(){if(null!=a.texture){o.useProgram(this.glProgram.program),o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,a.texture),o.uniform1i(this.glProgram.u_texture_handle,0),o.uniform1f(this.glProgram.u_alpha_handle,this.absolutealpha()),o.uniformMatrix4fv(this.glProgram.u_projection_handle,!1,this.projectionMatrix),o.uniformMatrix4fv(this.glProgram.u_view_handle,!1,this.viewMatrix),o.uniformMatrix4fv(this.glProgram.u_model_handle,!1,this.quadModelMatrix);var e=this.buffer?this.buffer:t.buffer;o.bindBuffer(o.ARRAY_BUFFER,e),o.enableVertexAttribArray(this.glProgram.a_position_handle),o.enableVertexAttribArray(this.glProgram.a_tex_coordinate_handle),o.vertexAttribPointer(this.glProgram.a_position_handle,e.itemSize,o.FLOAT,!1,16,0),o.vertexAttribPointer(this.glProgram.a_tex_coordinate_handle,e.itemSize,o.FLOAT,!1,16,8),o.drawArrays(o.TRIANGLE_STRIP,0,e.numItems)}},a}}}();curlify.module("quad",t)}(),function(){var t=curlify.getModule("object"),e=curlify.getModule("quad"),i=function(){return console.log("initialize plane module"),{"new":function(i,r,n,o,a){for(var s=curlify.gl,l=t["new"](i,o,a),u=r+1,c=n+1,h=l.size.height/l.size.width,d=[],f=0;c>f;f++)for(var g=(-1+2*f/n)*h,m=f/n,p=0;u>p;p++){var v=-1+2*p/r,y=p/r;d.push(v,g,y,m)}l.buffer=s.createBuffer(),l.buffer.itemSize=2,l.buffer.numItems=4,s.bindBuffer(s.ARRAY_BUFFER,l.buffer),s.bufferData(s.ARRAY_BUFFER,new Float32Array(d),s.STATIC_DRAW);for(var x=[],_=0,w=0;n>w;w++)for(var b=0;r>b;b++)x.push(w*u+b),x.push(w*u+b+1),x.push((w+1)*u+b),x.push(w*u+b+1),x.push((w+1)*u+b+1),x.push((w+1)*u+b),_+=6;return l.indices=s.createBuffer(),l.indices.indexCount=x.length,s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,l.indices),s.bufferData(s.ELEMENT_ARRAY_BUFFER,new Uint16Array(x),s.STATIC_DRAW),l.glProgram=e.default_program.getProgram(),l.quadModelMatrix=mat4.identity(mat4.create()),l.updateModelMatrix=function(){var t=this.modelMatrix;if(mat4.copy(t,this.identityMatrix),0!=this.position.x||0!=this.position.y||0!=this.position.z){var e=curlify.screenWidth/(2*this.translateScale);mat4.translate(t,t,vec3.clone([this.position.x/e,-this.position.y/e,this.position.z/e]))}0!=this.rotate.z&&mat4.rotateZ(t,t,-this.rotate.z),0!=this.rotate.y&&mat4.rotateY(t,t,-this.rotate.y),0!=this.rotate.x&&mat4.rotateX(t,t,-this.rotate.x),(1!=this.scale.x||1!=this.scale.y||1!=this.scale.z)&&mat4.scale(t,t,vec3.clone([this.scale.x,this.scale.y,this.scale.z])),this.modelMatrix=t,mat4.copy(this.quadModelMatrix,this.modelMatrix);var i=curlify.screenWidth/this.translateScale;mat4.scale(this.quadModelMatrix,this.quadModelMatrix,vec3.clone([this.size.width/i,-this.size.height/i*1/h,1]))},l.draw=function(){null!=l.texture&&(s.useProgram(this.glProgram.program),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,l.texture),s.uniform1i(this.glProgram.u_texture_handle,0),s.uniform1f(this.glProgram.u_alpha_handle,this.absolutealpha()),s.uniformMatrix4fv(this.glProgram.u_projection_handle,!1,this.projectionMatrix),s.uniformMatrix4fv(this.glProgram.u_view_handle,!1,this.viewMatrix),s.uniformMatrix4fv(this.glProgram.u_model_handle,!1,this.quadModelMatrix),s.bindBuffer(s.ARRAY_BUFFER,this.buffer),s.enableVertexAttribArray(this.glProgram.a_position_handle),s.enableVertexAttribArray(this.glProgram.a_tex_coordinate_handle),s.vertexAttribPointer(this.glProgram.a_position_handle,this.buffer.itemSize,s.FLOAT,!1,16,0),s.vertexAttribPointer(this.glProgram.a_tex_coordinate_handle,this.buffer.itemSize,s.FLOAT,!1,16,8),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,this.indices),s.drawElements(s.TRIANGLES,this.indices.indexCount,s.UNSIGNED_SHORT,0))},l}}}();curlify.module("plane",i)}(),function(){var t=function(){var t=curlify.getModule("quad");return{"new":function(e,i,r){var n=t["new"](e,i,r);return n.focused=!1,n.hit=function(t,e){return t<-this.width()/2||t>this.width()/2||e<-this.height()/2||e>this.height()/2?!1:!0},n.relativePress=function(t,e){return this.hit(t,e)?(null!=this.focus&&this.focus(t,e),this.focused=!0,!0):!1},n.relativeDrag=function(t,e){return 1!=this.focused?!1:(1!=this.hit(t,e)?(null!=this.defocus&&this.defocus(t,e),this.focused=!1):null!=this.focusdrag&&this.focusdrag(t,e),!0)},n.relativeRelease=function(t,e){return 1!=this.focused?!1:(null!=this.click&&this.click(t,e),null!=this.defocus&&this.defocus(t,e),this.focused=!1,!0)},n.pointerReset=function(){null!=this.defocus&&this.defocus(0,0),this.focused=!1},n}}}();curlify.module("focusable",t)}(),function(){var t=function(){console.log("initialize rectangle module");var t=curlify.getModule("glutils"),e=curlify.getModule("quad");return{default_program:{glProgram:null,getProgram:function(){return null==this.glProgram&&this.loadProgram(),this.glProgram},loadProgram:function(){var e={text:"              attribute vec2 a_position;                            uniform mat4 u_projection;              uniform mat4 u_view;              uniform mat4 u_model;                            void main() {                gl_Position = u_projection*u_view*u_model*vec4(a_position, 0.0, 1.0);              }",type:"x-shader/x-vertex"},i={text:"              precision mediump float;                            uniform float     u_red;              uniform float     u_green;              uniform float     u_blue;              uniform float     u_alpha;                            void main() {                gl_FragColor = vec4( u_red, u_green, u_blue, 1.0 ) * u_alpha;              }",type:"x-shader/x-fragment"},r=t.createShader(curlify.gl,e),n=t.createShader(curlify.gl,i);this.glProgram=t.loadProgram(curlify.gl,[r,n],["a_position"],["u_red","u_green","u_blue","u_alpha","u_model","u_view","u_projection"])}},"new":function(t,i,r){var n=curlify.gl,o=e["new"]("rectangle",t,i);return o.glProgram=this.default_program.getProgram(),o.color=null==r?{red:0,green:0,blue:0}:r,o.draw=function(){n.useProgram(this.glProgram.program),n.uniform1f(this.glProgram.u_red_handle,this.color.red),n.uniform1f(this.glProgram.u_green_handle,this.color.green),n.uniform1f(this.glProgram.u_blue_handle,this.color.blue),n.uniform1f(this.glProgram.u_alpha_handle,this.absolutealpha()),n.uniformMatrix4fv(this.glProgram.u_projection_handle,!1,this.projectionMatrix),n.uniformMatrix4fv(this.glProgram.u_view_handle,!1,this.viewMatrix),n.uniformMatrix4fv(this.glProgram.u_model_handle,!1,this.quadModelMatrix);var t=this.buffer?this.buffer:e.buffer;n.bindBuffer(n.ARRAY_BUFFER,t),n.enableVertexAttribArray(this.glProgram.a_position_handle),n.vertexAttribPointer(this.glProgram.a_position_handle,t.itemSize,n.FLOAT,!1,16,0),n.drawArrays(n.TRIANGLE_STRIP,0,t.numItems)},o}}}();curlify.module("rectangle",t)}(),function(){var t=function(){console.log("initialize image module");var e=curlify.getModule("quad");return{loadImage:function(t){var e=null;if("string"!=typeof t)return console.log("ERROR: image.loadImage source is not of type string",t),null;if(e=new Image,null!=curlify.zipfile){console.log("image.source zip",i,t,curlify.zipfile);var i=curlify.zipfile.file(t);e.src="data:image/jpg;base64,"+JSZip.base64.encode(i.asBinary())}else e.crossOrigin="anonymous",e.src=t;return e},"new":function(i,r){var n=curlify.gl,o=r?r:e["new"]("image : "+i);return o.size.width=null,o.size.height=null,i instanceof HTMLElement?(o.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,o.texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,i),null==o.size.width&&(o.size.width=i.width),null==o.size.height&&(o.size.height=i.height),o.loaded=!0,null!=o.onload&&o.onload()):i instanceof Object?null!=i.texture||null!=i.size?(o.texture=i.texture,o.image=i.image,null==o.size.width&&(o.size.width=i.size.width),null==o.size.height&&(o.size.height=i.size.height),o.loaded=!0,null!=o.onload&&o.onload()):console.log("ERROR: image.new from unknown Object",i):"string"==typeof i?(o.image=t.loadImage(i),o.image.onload=function(){return null==t?void console.log("image == null!"):(o.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,o.texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,o.image),null==o.size.width&&(o.size.width=o.image.width),null==o.size.height&&(o.size.height=o.image.height),o.loaded=!0,void(null!=o.onload&&o.onload()))},o.image.onerror=function(){console.log("texture load failed",i)}):console.log("ERROR: image.new from unknown object",i),o}}}();curlify.module("image",t)}(),function(){var t=curlify.getModule("glutils"),e=curlify.getModule("image"),i=curlify.getModule("quad"),r=function(){return console.log("initialize masked_image module"),{default_program:{program:null,getProgram:function(){return null==this.glProgram&&this.loadProgram(),this.glProgram},loadProgram:function(){var e={text:"            attribute vec2 a_position;             attribute vec2 a_tex_coordinate;                         uniform mat4 u_projection;             uniform mat4 u_view;             uniform mat4 u_model;                         varying vec2 v_tex_coord;                         void main() {               gl_Position = u_projection*u_view*u_model*vec4(a_position, 0.0, 1.0);               v_tex_coord = a_tex_coordinate;             }             ",type:"x-shader/x-vertex"},i={text:"            precision mediump float;                         varying vec2      v_tex_coord;                         uniform sampler2D u_texture;             uniform sampler2D u_mask_texture;             uniform float     u_alpha;                         void main() {                             vec4 color = texture2D(u_texture, v_tex_coord);               vec4 mask_color = texture2D(u_mask_texture, v_tex_coord);                             gl_FragColor = color * mask_color.a * u_alpha;             }             ",type:"x-shader/x-fragment"},r=t.createShader(curlify.gl,e),n=t.createShader(curlify.gl,i);this.glProgram=t.loadProgram(curlify.gl,[r,n],["a_position","a_tex_coordinate"],["u_texture","u_mask_texture","u_alpha","u_model","u_view","u_projection"])}},"new":function(t,r){var n=curlify.gl,o=e["new"](t);return o.identifier="masked_image : "+t+" : "+r,console.log(o.identifier),o.mask=r,o.glProgram=this.default_program.getProgram(),o.draw=function(){if(1==o.loaded){n.useProgram(this.glProgram.program),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,o.texture),n.uniform1i(this.glProgram.u_texture_handle,0),n.activeTexture(n.TEXTURE1),n.bindTexture(n.TEXTURE_2D,o.mask.texture),n.uniform1i(this.glProgram.u_mask_texture_handle,1),n.uniform1f(this.glProgram.u_alpha_handle,this.absolutealpha()),n.uniformMatrix4fv(this.glProgram.u_projection_handle,!1,this.projectionMatrix),n.uniformMatrix4fv(this.glProgram.u_view_handle,!1,this.viewMatrix),n.uniformMatrix4fv(this.glProgram.u_model_handle,!1,this.quadModelMatrix);var t=this.buffer?this.buffer:i.buffer;n.bindBuffer(n.ARRAY_BUFFER,t),n.enableVertexAttribArray(this.glProgram.a_position_handle),n.enableVertexAttribArray(this.glProgram.a_tex_coordinate_handle),n.vertexAttribPointer(this.glProgram.a_position_handle,t.itemSize,n.FLOAT,!1,16,0),n.vertexAttribPointer(this.glProgram.a_tex_coordinate_handle,t.itemSize,n.FLOAT,!1,16,8),n.drawArrays(n.TRIANGLE_STRIP,0,t.numItems)}},o}}}();curlify.module("masked_image",r)}(),function(){var t=function(){console.log("initialize fbo_object module");var t=curlify.getModule("glutils"),e=curlify.getModule("scene"),i=curlify.getModule("quad"),r=curlify.getModule("sys");return{default_program:{glProgram:null,getProgram:function(){return null==this.glProgram&&this.loadProgram(),this.glProgram},loadProgram:function(){var e={text:"              attribute vec2 a_position;              attribute vec2 a_tex_coordinate;                            uniform mat4 u_projection;              uniform mat4 u_view;              uniform mat4 u_model;                            varying vec2 v_tex_coord;                            void main() {                gl_Position = u_projection*u_view*u_model*vec4(a_position, 0.0, 1.0);                v_tex_coord = vec2(a_tex_coordinate.x,1.0-a_tex_coordinate.y);              }              ",type:"x-shader/x-vertex"},i={text:"              precision mediump float;                            varying vec2      v_tex_coord;                            uniform sampler2D u_texture;              uniform float     u_alpha;                            void main() {                vec4 color = texture2D(u_texture, v_tex_coord);                gl_FragColor = color * u_alpha;              }            ",type:"x-shader/x-fragment"},r=t.createShader(curlify.gl,e),n=t.createShader(curlify.gl,i);this.glProgram=t.loadProgram(curlify.gl,[r,n],["a_position","a_tex_coordinate"],["u_texture","u_alpha","u_model","u_view","u_projection"])}},"new":function(t,n,o,a){var s=curlify.gl,l=i["new"]("fbo_object : "+t,n,o);l.glProgram=this.default_program.getProgram(),console.log("fbo_object.new(",l.dentifier,l.size.width,l.size.height,")"),l.dobypassFbo=!1,l.lastUpdated=-99999,l.updateInterval=0,l.framebuffer=s.createFramebuffer(),l.framebuffer.width=l.size.width,l.framebuffer.height=l.size.height,s.bindFramebuffer(s.FRAMEBUFFER,l.framebuffer),l.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,l.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR);var u=a?s.RGB:s.RGBA;return s.texImage2D(s.TEXTURE_2D,0,u,l.framebuffer.width,l.framebuffer.height,0,u,s.UNSIGNED_BYTE,null),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,l.texture,0),s.bindTexture(s.TEXTURE_2D,null),s.bindFramebuffer(s.FRAMEBUFFER,null),l.preStep=function(){var t=r.timestamp()-this.lastUpdated;this.fboUpdatesDisabled||this.dobypassFbo||t>=this.updateInterval&&l.updateFbo()},l.updateFbo=function(){e.addFboUpdate(l)},l.renderFbo=function(){s.bindTexture(s.TEXTURE_2D,null);var t=s.getParameter(s.FRAMEBUFFER_BINDING),e=curlify.screenWidth,i=curlify.screenHeight,n=curlify.layoutWidth,o=curlify.layoutHeight,a={x:curlify.layoutOffset.x,y:curlify.layoutOffset.y};s.viewport(0,0,l.size.width,l.size.height),s.bindFramebuffer(s.FRAMEBUFFER,l.framebuffer),s.clearColor(0,0,0,0),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),curlify.screenWidth=l.size.width,curlify.screenHeight=l.size.height,curlify.layoutWidth=l.size.width,curlify.layoutHeight=l.size.height,curlify.layoutOffset={x:0,y:0};for(var u=0;u<l.children.length;u++)l.children[u].parent=null,l.children[u].viewMatrix=curlify.camera.viewMatrix,l.children[u].drawTree();curlify.screenWidth=e,curlify.screenHeight=i,curlify.layoutWidth=n,curlify.layoutHeight=o,curlify.layoutOffset=a,s.viewport(curlify.layoutOffset.x,curlify.layoutOffset.y,curlify.layoutWidth,curlify.layoutHeight),s.bindFramebuffer(s.FRAMEBUFFER,t),l.lastUpdated=r.timestamp()},l.drawTree=function(){Math.min(r.timestamp()-this.lastdraw,60);if(this.lastdraw=r.timestamp(),0!=this.visible){if(this.update(),this.dobypassFbo)for(var t=0;t<this.children.length;t++)this.children[t].parent=this,this.children[t].viewMatrix=this.modelViewMatrix,this.children[t].drawTree();else null!=this.draw&&this.draw();null!=this.postDraw&&this.postDraw()}},l.draw=function(){s.useProgram(this.glProgram.program),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,l.texture),s.uniform1i(this.glProgram.u_texture_handle,0),s.uniform1f(this.glProgram.u_alpha_handle,this.absolutealpha()),s.uniformMatrix4fv(this.glProgram.u_projection_handle,!1,this.projectionMatrix),s.uniformMatrix4fv(this.glProgram.u_view_handle,!1,this.viewMatrix),s.uniformMatrix4fv(this.glProgram.u_model_handle,!1,this.quadModelMatrix);var t=this.buffer?this.buffer:i.buffer;s.bindBuffer(s.ARRAY_BUFFER,t),s.enableVertexAttribArray(this.glProgram.a_position_handle),s.enableVertexAttribArray(this.glProgram.a_tex_coordinate_handle),s.vertexAttribPointer(this.glProgram.a_position_handle,t.itemSize,s.FLOAT,!1,16,0),s.vertexAttribPointer(this.glProgram.a_tex_coordinate_handle,t.itemSize,s.FLOAT,!1,16,8),s.drawArrays(s.TRIANGLE_STRIP,0,t.numItems)},l}}}();curlify.module("fbo_object",t)}(),function(){var t=function(){console.log("initialize button module");{var t=curlify.getModule("image");curlify.getModule("focusable")}return{"new":function(e){var i=t["new"](e);return i.focused=!1,i.identifier="button : "+e,i.hit=function(t,e){return t<-this.width()/2||t>this.width()/2||e<-this.height()/2||e>this.height()/2?!1:!0},i.relativePress=function(t,e){return this.hit(t,e)?(null!=this.focus&&this.focus(t,e),this.focused=!0,!0):!1},i.relativeDrag=function(t,e){return 1!=this.focused?!1:(1!=this.hit(t,e)?(null!=this.defocus&&this.defocus(t,e),this.focused=!1):null!=this.focusdrag&&this.focusdrag(t,e),!0)},i.relativeRelease=function(t,e){return 1!=this.focused?!1:(null!=this.click&&this.click(t,e),null!=this.defocus&&this.defocus(t,e),this.focused=!1,!0)},i.pointerReset=function(){null!=this.defocus&&this.defocus(0,0),this.focused=!1},i}}}();curlify.module("button",t)}(),function(){var t=curlify.getModule("object"),e=curlify.getModule("focusable"),i=curlify.getModule("image"),r=function(t,r,n,o,a){n=n?n:t.frames.length,o=o?o:0;
for(var s=a?a:e["new"]("spritesheet "+t.name),l=o;o+n>l;l++){var u=s.add(i["new"](t.frames[l]));u.visible=!1,u.active=!1}return s.size.width=t.spritewidth,s.size.height=t.spriteheight,s.frame=s.children[0],s.frametimervalue=0,s.frametime=35,s.restart=function(t){s.frametimervalue=0;var e=s.restart;0==r&&(e=null);var i=s.loopdelay&&!t?s.loopdelay:0;s.anim.animate(s,{frametimervalue:s.children.length,start:i,time:s.frametime*s.children.length,onComplete:e})},s.preStep=function(){s.frame.visible=!1;var t=Math.floor(s.frametimervalue);t>s.children.length-1||(s.frame=s.children[t],s.frame.visible=!0)},s.start=function(){return s.anim.animations.length>0&&s.anim.animations[0].paused?void s.anim.resume():void s.restart()},s.stop=function(){s.anim.pause()},s.unload=function(){s.anim.stop()},0!=r&&s.restart(!0),s},n=function(){return{newSheet:function(t,e,r){var n={spritewidth:0,spriteheight:0,frames:[]};if(t instanceof Array){var o=e,a=r,s=document.createElement("canvas");s.width=o,s.height=a;for(var l=s.getContext("2d"),u=0,c=0;c<t.length;c++)!new function(){var e=i.loadImage(t[c]);e.onload=function(){l.drawImage(e,0,0),n.frames.push(i["new"](s)),l.clearRect(0,0,s.width,s.height),u+=1,u==t.length&&null!=n.onload&&n.onload()}};n.spritewidth=o,n.spriteheight=a,n.name="array "+t.length}else{var h=i.loadImage(t);h.onload=function(){var o=h.width/e,a=h.height/r,s=document.createElement("canvas");s.width=o,s.height=a;for(var l=s.getContext("2d"),u=0;r>u;u++)for(var c=0;e>c;c++)l.drawImage(h,-c*o,-u*a),n.frames.push(i["new"](s)),l.clearRect(0,0,s.width,s.height);n.spritewidth=o,n.spriteheight=a,n.name=t,null!=n.onload&&n.onload()}}return n},newFromSheet:function(t,e,i,n,o){return r(t,e,i,n,o)},"new":function(e,i,n,o,a,s){var l=this.newSheet(e,i,n),u=t["new"]("sprite loader");return u.sheet=l,l.onload=function(){r(l,o,a,s,u),null!=u.onload&&u.onload()},u}}}();curlify.module("sprite",n)}(),function(){var t=function(){console.log("initialize carousel module");var t=curlify.getModule("object"),e=curlify.getModule("focusable"),i=curlify.getModule("animator"),r=curlify.getModule("scene"),n=curlify.getModule("sys");return{"new":function(o,a,s){var l=e["new"](o,a,s),u={name:"coverflow",show:[],hide:[]};u.show.push({target:"position.x",startposition:1*curlify.screenWidth,endposition:0,func:i.linear}),u.show.push({target:"rotate.y",startposition:.8*Math.PI,endposition:0,func:i.linear}),u.show.push({target:"scale.x",startposition:.6,endposition:1,func:i.linear}),u.show.push({target:"scale.y",startposition:.6,endposition:1,func:i.linear}),u.hide.push({target:"position.x",startposition:0,endposition:1*-curlify.screenWidth,func:i.linear}),u.hide.push({target:"rotate.y",startposition:0,endposition:.8*-Math.PI,func:i.linear}),u.hide.push({target:"scale.x",startposition:1,endposition:.6,func:i.linear}),u.hide.push({target:"scale.y",startposition:1,endposition:.6,func:i.linear}),l.contentsize={width:l.size.width,height:l.size.height},l.inertia=5,l.swipespeed=curlify.screenWidth,l.movespeed=1,l.movethreshold=60,l.itemsize=curlify.screenWidth,l.transition=u,l.unload_distance=1,l.wrap=!1,l.bounceOnWrap=!1,l.alwaysmove=!1,l.nevermove=!1,l.selecteditem=1,l.moveToSelectedItem=!0;var c=l.add(t["new"]("carousel"));c.targetposition={x:0,y:0,z:0},c.pressOffset={x:0,y:0};var h=l.add(t["new"]("item container"));h.targetposition={x:0,y:0,z:0},l.instance=c,l.itemcontainer=h;var d=function(t,e,i){i>100&&(i=100);var r=1;t>e&&(r=-1);var n=-r*i/(16.66*l.inertia)*Math.abs(t-e);return Math.abs(n)<1e-4?t=e:t-=n,1==r&&t>e&&(t=e),-1==r&&e>t&&(t=e),t};return c.setMoving=function(t,e){null==r.getpointerStealer()&&1!=l.nevermove&&(r.stealPointers(l),null!=l.stolePointers&&l.stolePointers(t,e),c.moving=!0)},l.focus=function(t,e){c.moving&&(c.moving=!1,c.targetposition.x=c.position.x,c.targetposition.y=c.position.y),c.pressOffset={x:c.targetposition.x-t*l.movespeed/curlify.screenWidth*2,y:c.targetposition.y-e*l.movespeed},l.pressStarted={x:t,y:e}},l.focusdrag=function(t,e){var i=c.pressOffset.x+t*l.movespeed/curlify.screenWidth*2,r=c.pressOffset.y+e*l.movespeed/curlify.screenHeight*2,n=l.pressStarted.x-t,o=l.pressStarted.y-e;(l.alwaysmove||l.contentsize.width!=l.size.width)&&Math.abs(n)>l.movethreshold&&c.setMoving(n,o),c.moving&&(c.targetposition.x=i,c.targetposition.y=r)},l.defocus=function(){var t=Math.floor(-c.targetposition.x+.5);l.moveToSelectedItem&&(c.targetposition.x=-t),l.selecteditem=t,l.selecteditem<0&&(l.selecteditem=l.wrap?h.children.length+t:0),l.selecteditem>h.children.length-1&&(l.selecteditem=l.wrap?t-h.children.length:h.children.length-1),l.selecteditem=l.selecteditem+1,null!=l.carouselmoved&&l.carouselmoved(l.selecteditem)},l.postDraw=function(){if(l.wrap)for(var t=0;t<h.children.length;t++){var e=h.children[t],i=e.active,r=e.visible,n=e.itemposition;e.itemposition=n+h.children.length,e.stepTree(),e.drawTree(),e.itemposition=n-h.children.length,e.stepTree(),e.drawTree(),e.itemposition=n,e.step(0),e.visible=r,e.active=i}},l.selected=function(){return l.selecteditem},l.getItem=function(t){return h.children[t-1]},l.moveto=function(t,e){c.targetposition.x=-t,e&&(c.position.x=c.targetposition.x),l.selecteditem=t,null!=l.carouselmoved&&l.carouselmoved(t+1)},l.step=function(t){var e=-h.children.length+1,i=-h.children.length+1,r=.75,n=.75;0==l.wrap||l.bounceOnWrap&&c.position.x>e-r&&c.position.x<r?(l.bounceOnWrap&&(r=2*r,n=2*n),c.targetposition.x>r&&(c.targetposition.x=r),c.targetposition.y>n&&(c.targetposition.y=n),c.targetposition.x<e-r&&(c.targetposition.x=e-r),c.targetposition.y<i-n&&(c.targetposition.y=i-n),0==l.focused&&(c.targetposition.x>0&&(c.targetposition.x=d(c.targetposition.x,0,t/2)),c.targetposition.y>0&&(c.targetposition.y=d(c.targetposition.y,0,t/2)),c.targetposition.x<e&&(c.targetposition.x=d(c.targetposition.x,e,t/2)),c.targetposition.y<i&&(c.targetposition.y=d(c.targetposition.y,i,t/2)))):c.targetposition.x>1?(console.log("switch",c.position.x,c.targetposition.x,l.contentsize.width),c.targetposition.x=c.targetposition.x-h.children.length,c.position.x=c.position.x-h.children.length,c.pressOffset.x=c.pressOffset.x-h.children.length):c.targetposition.x<-h.children.length&&(console.log("+++switch2",c.position.x,c.targetposition.x),c.targetposition.x=c.targetposition.x+h.children.length,c.position.x=c.position.x+h.children.length,c.pressOffset.x=c.pressOffset.x+h.children.length);var o=t;o>100&&(o=1),0==l.focused&&(o=t/2),(l.alwaysmove||l.contentsize.width!=l.size.width)&&(c.position.x=d(c.position.x,c.targetposition.x,o)),(l.alwaysmove||l.contentsize.height!=l.size.height)&&(c.position.y=d(c.position.y,c.targetposition.y,o)),0==l.focused&&c.position.x==c.targetposition.x&&c.position.y==c.targetposition.y&&(c.moving=!1),c.moving},l.getDistance=function(){var t=(c.position.x*l.itemsize+this.itemposition*l.itemsize)/curlify.screenWidth;return t},l.setContentSize=function(){l.contentsize.width=l.itemsize*h.children.length},l.add=function(t,i){var i=h.children.length,r=e["new"]("carousel item container");return r.add(t),r.parent=h,h.children.push(r),h.drawTree=function(){function t(t,e){return Math.abs(t.dist)>Math.abs(e.dist)?-1:1}Math.min(n.timestamp()-this.lastdraw,60);if(this.lastdraw=n.timestamp(),0!=this.visible){if(this.update(),null!=this.preDraw&&this.preDraw(),null!=this.draw&&this.draw(),l.transition.order_draw){for(var e=[],i=0;i<this.children.length;i++)e.push(this.children[i]);e.sort(t);for(var i=0;i<e.length;i++)e[i].drawTree()}else if(this.reverseDrawOrder)for(var i=this.children.length-1;i>=0;i--)this.children[i].drawTree();else for(var i=0;i<this.children.length;i++)this.children[i].drawTree();null!=this.postDraw&&this.postDraw()}},t.carouselobject=r,r.index=i,r.child=t,r.itemposition=i,r.getDistance=l.getDistance,r.step=function(){var t=this.getDistance();if(this.dist=t,t<=-l.unload_distance||t>=l.unload_distance?null!=this.unload_content&&null!=this.content&&this.unload_content():null!=this.load_content&&null==this.content&&this.load_content(),this.active=!0,Math.abs(t)>.2&&(this.active=!1),this.visible=!0,Math.abs(t)>1&&(this.visible=!1),!(this.distance==t||Math.abs(t)>2)){this.distance=t;var e=l.transition;if(h.reverseDrawOrder=e.reverse_draw?!0:!1,t>=0)for(var i=0;i<e.show.length;i++){var r=e.show[i];"position.x"==r.target?this.position.x=r.func(r.startposition,r.endposition,Math.abs(1-t)):"position.y"==r.target?this.position.y=r.func(r.startposition,r.endposition,Math.abs(1-t)):"position.z"==r.target?this.position.z=r.func(r.startposition,r.endposition,Math.abs(1-t)):"scale.x"==r.target?this.scale.x=r.func(r.startposition,r.endposition,Math.abs(1-t)):"scale.y"==r.target?this.scale.y=r.func(r.startposition,r.endposition,Math.abs(1-t)):"rotate.x"==r.target?this.rotate.x=r.func(r.startposition,r.endposition,Math.abs(1-t)):"rotate.y"==r.target?this.rotate.y=r.func(r.startposition,r.endposition,Math.abs(1-t)):"rotate.z"==r.target?this.rotate.z=r.func(r.startposition,r.endposition,Math.abs(1-t)):"alpha"==r.target?this.alpha=r.func(r.startposition,r.endposition,Math.abs(1-t)):"transition_value"==r.target&&(this.transition_value=r.func(r.startposition,r.endposition,Math.abs(1-t)))}else for(var i=0;i<e.hide.length;i++){var n=e.hide[i];"position.x"==n.target?this.position.x=n.func(n.startposition,n.endposition,Math.abs(t)):"position.y"==n.target?this.position.y=n.func(n.startposition,n.endposition,Math.abs(t)):"position.z"==n.target?this.position.z=n.func(n.startposition,n.endposition,Math.abs(t)):"scale.x"==n.target?this.scale.x=n.func(n.startposition,n.endposition,Math.abs(t)):"scale.y"==n.target?this.scale.y=n.func(n.startposition,n.endposition,Math.abs(t)):"rotate.x"==n.target?this.rotate.x=n.func(n.startposition,n.endposition,Math.abs(t)):"rotate.y"==n.target?this.rotate.y=n.func(n.startposition,n.endposition,Math.abs(t)):"rotate.z"==n.target?this.rotate.z=n.func(n.startposition,n.endposition,Math.abs(t)):"alpha"==n.target?this.alpha=n.func(n.startposition,n.endposition,Math.abs(t)):"transition_value"==n.target&&(this.transition_value=n.func(n.startposition,n.endposition,Math.abs(t)))}}},h.itemaddposition=h.itemaddposition+1,l.setContentSize(),r},l}}}();curlify.module("carousel",t)}(),function(){var t=curlify.getModule("animator"),e=curlify.getModule("carousel"),i=function(){return{"new":function(i,r,n){var o={name:"move in",show:[],hide:[]};o.show.push({target:"position.y",startposition:curlify.screenHeight,endposition:0,func:t.outQuad}),o.show.push({target:"alpha",startposition:0,endposition:1,func:t.outExpo}),o.hide.push({target:"position.y",startposition:0,endposition:0,func:t.linear}),o.hide.push({target:"alpha",startposition:1,endposition:0,func:t.inExpo});var a=e["new"](i,r,n);return a.itemsize=curlify.screenHeight,a.transition=o,a.getDistance=function(){var t=(a.instance.position.y*a.itemsize+this.itemposition*a.itemsize)/curlify.screenHeight;return t},a.setContentSize=function(){a.contentsize.height=a.itemsize*a.itemcontainer.children.length},a.focus=function(t,e){a.instance.moving&&(a.instance.moving=!1,a.instance.targetposition.x=a.instance.position.x,a.instance.targetposition.y=a.instance.position.y),a.instance.pressOffset={x:a.instance.targetposition.x-t*a.movespeed/curlify.screenWidth*2,y:a.instance.targetposition.y-e*a.movespeed/curlify.screenHeight*2},a.pressStarted={x:t,y:e}},a.focusdrag=function(t,e){var i=a.instance.pressOffset.x+t*a.movespeed/curlify.screenWidth*2,r=a.instance.pressOffset.y+e*a.movespeed/curlify.screenHeight*2,n=a.pressStarted.x-t,o=a.pressStarted.y-e;(a.alwaysmove||a.contentsize.height!=a.size.height)&&Math.abs(o)>a.movethreshold&&a.instance.setMoving(n,o),a.instance.moving&&(a.instance.targetposition.x=i,a.instance.targetposition.y=r)},a.defocus=function(){var t=Math.floor(-a.instance.targetposition.y+.5);a.moveToSelectedItem&&(a.instance.targetposition.y=-t),a.selecteditem=t,a.selecteditem<0&&(a.selecteditem=a.wrap?a.itemcontainer.children.length+t:0),a.selecteditem>a.itemcontainer.children.length-1&&(a.selecteditem=a.wrap?t-a.itemcontainer.children.length:a.itemcontainer.children.length-1),a.selecteditem=a.selecteditem+1,null!=a.carouselmoved&&a.carouselmoved(a.selecteditem)},a.moveto=function(t,e){a.instance.targetposition.y=-t,e&&(a.instance.position.y=a.instance.targetposition.y),a.selecteditem=t,null!=a.carouselmoved&&a.carouselmoved(t)},a}}}();curlify.module("carousel_vertical",i)}(),function(){var t=curlify.getModule("scene"),e=curlify.getModule("animator"),i=curlify.getModule("object"),r=curlify.getModule("focusable"),n=function(){return{"new":function(n,o,a){var s=r["new"](n,o,a);s.contentsize={width:s.size.width,height:s.size.height},s.movespeed=1,s.movethreshold=40,s.swipespeed=(curlify.screenWidth+curlify.screenHeight)/2*5,s.maxspeed=200,s.inertia=7,s.zeroposition=0,s.loaddistance=curlify.screenHeight,s.visibledistance=s.loaddistance,s.itempad=0,s.centerslots=!1,s.swipefunc=e.inQuad;var l=s.add(i["new"]("scrollable"));s.instance=l,l.targetposition={x:0,y:0,z:0};var u=function(t,e,i){i>100&&(i=100);var r=1;t>e&&(r=-1);var n=-r*(i/(16.66*s.inertia))*Math.abs(t-e),o=i/16.66*s.maxspeed;return n>o&&(n=o),-o>n&&(n=-o),Math.abs(n)<1e-5?t=e:t-=n,1==r&&t>e&&(t=e),-1==r&&e>t&&(t=e),t};s.focus=function(t,e){l.pressOffset={x:l.position.x-t*s.movespeed,y:l.position.y-e*s.movespeed},l.moving&&(l.resetpress(),l.moving=!1)},s.defocus=function(){t.getpointerStealer()==s&&s.centeronslots(),console.log("DEFOCUS",s.identifier,l.position.y,l.targetposition.y)},s.centeronslots=function(){if(s.centerslots){var t=Math.floor(s.selected()/(curlify.screenWidth+s.itempad));s.movetox(t*(curlify.screenWidth+s.itempad)+curlify.screenWidth/2)}},l.setMoving=function(){0==l.moving&&null==t.getpointerStealer()&&(t.stealPointers(s),l.moving=!0)},s.focusdrag=function(t,e){var i=l.pressOffset.x+t*s.movespeed,r=l.pressOffset.y+e*s.movespeed,n=i-l.targetposition.x,o=r-l.targetposition.y;s.contentsize.width!=s.size.width&&Math.abs(n)>s.movethreshold&&l.setMoving(),s.contentsize.height!=s.size.height&&Math.abs(o)>s.movethreshold&&l.setMoving(),l.moving&&(l.targetposition.x=i,l.targetposition.y=r)},s.step=function(t){var e=-(s.contentsize.width-s.size.width)+s.zeroposition,i=-(s.contentsize.height-s.size.height),r=t;r>66&&(r=66),0!=s.enforcelimits&&(l.targetposition.x>s.size.width/4+s.zeroposition&&(l.targetposition.x=s.size.width/4+s.zeroposition),l.targetposition.y>s.size.height/4&&(l.targetposition.y=s.size.height/4),l.targetposition.x<e-s.size.width/4&&(l.targetposition.x=e-s.size.width/4),l.targetposition.y<i-s.size.height/4&&(l.targetposition.y=i-s.size.height/4),0==s.focused&&(l.targetposition.x>s.zeroposition&&(l.targetposition.x=u(l.targetposition.x,s.zeroposition,t/2)),l.targetposition.y>0&&(l.targetposition.y=u(l.targetposition.y,0,t/2)),l.targetposition.x<e&&(l.targetposition.x=u(l.targetposition.x,e,t/2)),l.targetposition.y<i&&(l.targetposition.y=u(l.targetposition.y,i,t/2)))),0==s.focused&&(r/=2),s.contentsize.width!=s.size.width&&(l.position.x=u(l.position.x,l.targetposition.x,r)),s.contentsize.height!=s.size.height&&(l.position.y=u(l.position.y,l.targetposition.y,r)),0==s.focused&&l.position.x==l.targetposition.x&&l.position.y==l.targetposition.y&&(l.moving=!1)},s.selected=function(){return Math.floor(l.targetposition.x)},s.movetox=function(t,e){e&&(l.position.x=t),l.targetposition.x=t},s.movetoy=function(t,e){e&&(l.position.y=t),l.targetposition.y=t},s.prepare=function(){s.step(0);for(var t=0;t<l.children.length;t++)l.children[t].step(0)};var c=4*curlify.screenWidth,h=4*curlify.screenHeight,d=-c,f=c,g=-h,m=h;return s.intersectsScreen=function(t){var e=t.absolutex(),i=t.absolutey(),r=e-t.width()/2,n=e+t.width()/2,o=i-t.height()/2,a=i+t.height()/2;return!(d>n||r>f||g>a||o>m)},s.add=function(t,e){e?e:l.children.length;return t.parent=l,l.children.push(t),t.step=function(){this.xdistance=this.absolutex();var t=Math.sqrt(Math.pow(this.xdistance,2)+Math.pow(this.absolutey(),2));if(t<s.loaddistance)null!=this.load_content&&0==this.loaded&&this.load_content();else{var e=s.unloaddistance;null==e&&(e=s.loaddistance),t>e&&null!=this.load_content&&null!=this.unload_content&&this.loaded&&this.unload_content()}this.visible=t<s.visibledistance?!0:!1,this.distance=t},t},s}}}();curlify.module("scrollable",n)}(),function(){function initWebGL(t){curlify.gl=null;try{curlify.gl=t.getContext("webgl")||t.getContext("experimental-webgl")}catch(e){}return curlify.gl||(alert("Unable to initialize WebGL. Your browser may not support it."),curlify.gl=null),curlify.gl}function mousedown(t){if(!scene.isAnimating()&&1!=touch){console.log("mousedown : "+t.clientX+","+t.clientY,curlify.layoutOffset.x,curlify.layoutOffset.y);var e=t.currentTarget.getBoundingClientRect();touch=!0;var i=scene.getPointerUser();null!=i&&(i.press((t.clientX-e.left-curlify.layoutOffset.x)*curlify.layoutScale.x,(t.clientY-e.top-curlify.layoutOffset.y)*curlify.layoutScale.y),i.drag((t.clientX-e.left-curlify.layoutOffset.x)*curlify.layoutScale.x,(t.clientY-e.top-curlify.layoutOffset.y)*curlify.layoutScale.y))}}function mouseup(t){if(scene.resetPointerStealer(),!scene.isAnimating()&&0!=touch){console.log("mouseup : "+t.clientX+","+t.clientY);var e=t.currentTarget.getBoundingClientRect();touch=!1;var i=scene.getPointerUser();null!=i&&i.release((t.clientX-e.left-curlify.layoutOffset.x)*curlify.layoutScale.x,(t.clientY-e.top-curlify.layoutOffset.y)*curlify.layoutScale.y)}}function mouseout(t){touch&&mouseup(t)}function mousemove(t){if(!scene.isAnimating()&&0!=touch){var e=t.currentTarget.getBoundingClientRect(),i=scene.getPointerUser();null!=i&&touch&&i.drag((t.clientX-e.left-curlify.layoutOffset.x)*curlify.layoutScale.x,(t.clientY-e.top-curlify.layoutOffset.y)*curlify.layoutScale.y)}}function touchstart(t){if(!scene.isAnimating()&&1!=touch){var e=t.currentTarget.getBoundingClientRect();touch=!0;var i=scene.getPointerUser();null!=i&&(i.press((t.touches[0].pageX-e.left-curlify.layoutOffset.x)*curlify.layoutScale.x,(t.touches[0].pageY-e.top-curlify.layoutOffset.y)*curlify.layoutScale.y),i.drag((t.touches[0].pageX-e.left-curlify.layoutOffset.x)*curlify.layoutScale.x,(t.touches[0].pageY-e.top-curlify.layoutOffset.y)*curlify.layoutScale.y),lasttouch=t)}}function touchend(t){if(scene.resetPointerStealer(),!scene.isAnimating()&&0!=touch){var e=t.currentTarget.getBoundingClientRect();touch=!1;var i=scene.getPointerUser();null!=i&&i.release(lasttouch.touches[0].pageX-e.left-curlify.layoutOffset.x,lasttouch.touches[0].pageY-e.top-curlify.layoutOffset.y)}}function touchmove(t){if(t.preventDefault(),!scene.isAnimating()&&0!=touch){var e=t.currentTarget.getBoundingClientRect(),i=scene.getPointerUser();null!=i&&(touch&&i.drag((t.touches[0].pageX-e.left-curlify.layoutOffset.x)*curlify.layoutScale.x,(t.touches[0].pageY-e.top-curlify.layoutOffset.y)*curlify.layoutScale.y),lasttouch=t)}}function deviceMotionHandler(t){curlify.sensors.acceleration=t.acceleration,curlify.sensors.rotation=t.rotationRate}function deviceOrientationHandler(t){curlify.sensors.orientation=t}function orientationChanged(){console.log("ORIENTATION CHANGED")}function resizeCanvas(){var t=glcanvas.clientWidth,e=glcanvas.clientHeight;if(glcanvas.width!=t||glcanvas.height!=e){curlify.layoutWidth=t,curlify.layoutHeight=e,curlify.layoutScale={x:curlify.screenWidth/curlify.layoutWidth,y:curlify.screenHeight/curlify.layoutHeight},curlify.viewWidth=curlify.screenWidth,curlify.viewHeight=curlify.screenHeight;var i=Math.max(curlify.layoutScale.x,curlify.layoutScale.y);aspectratioZoom&&(i=Math.min(curlify.layoutScale.x,curlify.layoutScale.y),curlify.viewWidth=t*i,curlify.viewHeight=e*i),curlify.layoutScale.x=i,curlify.layoutScale.y=i,curlify.layoutWidth=Math.floor(curlify.screenWidth*(1/i)),curlify.layoutHeight=Math.floor(curlify.screenHeight*(1/i)),curlify.layoutOffset.x=(t-curlify.layoutWidth)/2,curlify.layoutOffset.y=(e-curlify.layoutHeight)/2,glcanvas.width=glcanvas.clientWidth,glcanvas.height=glcanvas.clientHeight}}function mergeRecursive(t,e){for(var i in e)try{t[i]=e[i].constructor==Object?mergeRecursive(t[i],e[i]):e[i]}catch(r){t[i]=e[i]}return t}console.log("inititalize main");var revision="3",scene=curlify.getModule("scene"),glcanvas,aspectratioZoom=!0,touch=!1,lasttouch=null,imageid=0,running=!1,appendedElements=[];curlify.sensors={acceleration:null,rotation:null,orientation:null},curlify.zipfile=null,curlify.layoutWidth=null,curlify.layoutHeight=null,curlify.layoutOffset={x:0,y:0},curlify.layoutScale={x:1,y:1},curlify.gl=null,curlify.camera=null,curlify.viewWidth=null,curlify.viewHeight=null,curlify.screenWidth=null,curlify.screenHeight=null;var createProjection=function(t,e,i,r){var n=mat4.create();return n[0]=i/t,n[5]=i/e,n[10]=-(r+i)/(r-i),n[11]=-1,n[14]=-2*r*i/(r-i),n},createProjectionAndView=function(t,e,i,r){var n=createProjection(1,e/t,i,r),o=mat4.identity(mat4.create());mat4.translate(o,o,vec3.clone([0,0,-(r-i)/2]));var a=(r-i)/2/i,s={near:i,far:r,width:t,height:e,projectionMatrix:n,viewMatrix:o,translateScale:a};return s};curlify.assert=function(t,e){if(!t)throw e||"Assertion failed"},curlify.spawn=function(t){return function(){function e(t,e){var o;try{o=i[t](e)}catch(a){return Promise.reject(a)}return o.done?o.value:Promise.resolve(o.value).then(r,n)}var i=t.apply(this,arguments),r=e.bind(e,"next"),n=e.bind(e,"throw");return r()}},curlify.require=function(script){var module=curlify.getModule(script);return null!=module?module:new Promise(function(resolve,reject){var scriptid=script,element=document.getElementById(scriptid);if(null==element)if(".zip"==script.slice(-4))JSZipUtils.getBinaryContent(script,function(err,data){if(err)return void reject(Error("require zip load failed for '"+script+"' with '"+err+"'"));curlify.zipfile=new JSZip(data);var adscriptfile=curlify.zipfile.file("main.js");if(null==adscriptfile)return curlify.zipfile=null,void reject(Error("require failed for '"+script+"' with 'main.js not found inside zip'"));var scriptobject=null;try{scriptobject=eval(adscriptfile.asText())}catch(e){return curlify.zipfile=null,void reject(Error("require eval failed for zip '"+script+"' with '"+e+"'"))}resolve(scriptobject)});else{if(".js"!=script.slice(-3))return void reject(Error("require failed for '"+script+"' with 'unsupported source'"));element=document.createElement("script"),element.setAttribute("id",scriptid),element.setAttribute("type","script-container"),document.head.appendChild(element),appendedElements.push(scriptid),curlify.createCORSRequest("GET",script).then(function(response){try{element.scriptobject=eval(response)}catch(e){return void reject(Error("require eval failed for '"+script+"' with '"+e+"'"))}resolve(element.scriptobject)},function(t){reject(Error("require load failed for '"+script+"' with '"+t+"'"))})}else resolve(element.scriptobject)})},curlify.addImageElement=function(){var t="curlify_image_"+imageid,e=document.createElement("img");return e.setAttribute("id",t),document.body.appendChild(e),appendedElements.push(t),imageid+=1,e},curlify.createCORSRequest=function(t,e){return new Promise(function(i,r){var n=new XMLHttpRequest;if("withCredentials"in n)n.open(t,e,!0);else{if("undefined"==typeof XDomainRequest)return n=null,void r(Error("createCORSRequest failed with 'XMLHttpRequest not supported'"));n=new XDomainRequest,n.open(t,e)}n.onload=function(){200==n.status?i(n.response):r(Error("cors request failed with '"+n.statusText+"'"))},n.onerror=function(){r(Error("cors request failed with 'Network Error'"))},n.send()})},curlify.getRandom=function(t,e){return Math.floor(Math.random()*(e-t)+t)},curlify.render=function(){var t=curlify.gl;t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.disable(t.DEPTH_TEST),t.enable(t.CULL_FACE),t.cullFace(t.FRONT),t.viewport(curlify.layoutOffset.x,curlify.layoutOffset.y,curlify.layoutWidth,curlify.layoutHeight),scene.render()},curlify.setRenderInterval=function(t){null!=curlify.intervalId&&window.clearInterval(curlify.intervalId),curlify.intervalId=window.setInterval(curlify.render,t)},curlify.stop=function(){if(console.log("Cleaning up..."),null==glcanvas)return void console.log("ERROR: canvas not set");"ontouchstart"in window?(glcanvas.removeEventListener("touchstart",touchstart,!1),glcanvas.removeEventListener("touchmove",touchmove,!1),glcanvas.removeEventListener("touchend",touchend,!1)):(glcanvas.removeEventListener("mousedown",mousedown,!1),glcanvas.removeEventListener("mousemove",mousemove,!1),glcanvas.removeEventListener("mouseup",mouseup,!1)),window.DeviceMotionEvent&&window.removeEventListener("devicemotion",deviceMotionHandler,!1),window.DeviceOrientationEvent&&window.removeEventListener("deviceorientation",deviceOrientationHandler,!1),window.removeEventListener("orientationchange",orientationChanged),scene.removeAllScenes();for(var t=0;t<appendedElements.length;t++){var e=appendedElements[t],i=document.getElementById(e);i.parentNode.removeChild(i),console.log("... removed element "+e)}appendedElements=[],null!=curlify.intervalId&&(console.log("... stopping render interval"),window.clearInterval(curlify.intervalId)),curlify.clearModuleBuffersAndPrograms(),running=!1},curlify.start=function(t){console.log("curlify.start - revision",revision),running&&curlify.stop(),running=!0,curlify.assert(null!=t.canvas),curlify.assert(null!=t.script);var e=t.canvas,i=t.script,r=t.width,n=t.height;curlify.screenWidth=r?r:480,curlify.screenHeight=n?n:852,glcanvas=document.getElementById(e),curlify.gl=initWebGL(glcanvas),"ontouchstart"in window?(glcanvas.addEventListener("touchstart",touchstart,!1),glcanvas.addEventListener("touchmove",touchmove,!1),glcanvas.addEventListener("touchend",touchend,!1)):(glcanvas.addEventListener("mousedown",mousedown,!1),glcanvas.addEventListener("mousemove",mousemove,!1),glcanvas.addEventListener("mouseup",mouseup,!1)),resizeCanvas(),curlify.camera=createProjectionAndView(curlify.screenWidth,curlify.screenHeight,3,100),curlify.gl&&(window.DeviceMotionEvent?window.addEventListener("devicemotion",deviceMotionHandler,!1):alert("DeviceMotionEvent not supported"),window.DeviceOrientationEvent?window.addEventListener("deviceorientation",deviceOrientationHandler,!1):alert("DeviceOrientationEvent not supported"),window.addEventListener("orientationchange",orientationChanged),curlify.require(i).then(function(e){scene.openScene(e["new"]()),null!=t.renderInterval&&curlify.setRenderInterval(t.renderInterval)}))}}();